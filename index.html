<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>ADHD íŠ¹ìˆ˜êµì‚¬ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ Pro v2.2</title>
  <script>
    // Force cache refresh - Version 2.2
    (function() {
      const CURRENT_VERSION = '2.2.0';
      const LAST_VERSION = localStorage.getItem('app_version');

      console.log('Current Version:', CURRENT_VERSION);
      console.log('Last Loaded Version:', LAST_VERSION);

      if (LAST_VERSION !== CURRENT_VERSION) {
        console.log('ğŸ”„ New version detected! Clearing cache...');
        localStorage.setItem('app_version', CURRENT_VERSION);

        // Clear all cache storages
        if ('caches' in window) {
          caches.keys().then(function(names) {
            for (let name of names) {
              caches.delete(name);
            }
          });
        }

        // Force reload from server
        if (LAST_VERSION) {
          console.log('ğŸ“¥ Forcing reload from server...');
          window.location.reload(true);
        }
      } else {
        console.log('âœ“ Already on latest version');
      }
    })();
  </script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script>
    // Check if external libraries are loading
    window.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded');
      setTimeout(function() {
        console.log('React:', typeof React !== 'undefined' ? 'âœ“' : 'âœ—');
        console.log('ReactDOM:', typeof ReactDOM !== 'undefined' ? 'âœ“' : 'âœ—');
        console.log('Babel:', typeof Babel !== 'undefined' ? 'âœ“' : 'âœ—');

        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined' || typeof Babel === 'undefined') {
          document.getElementById('root').innerHTML = '<div style="padding: 40px; color: white;"><h1>âŒ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹¤íŒ¨</h1><p>React, ReactDOM, ë˜ëŠ” Babelì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p></div>';
        }
      }, 2000);
    });
  </script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body { 
      margin: 0; 
      padding: 0; 
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0a0e27 100%);
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      color: #e2e8f0;
      min-height: 100vh;
    }

    .app-container {
      width: min(100%, 1680px);
      margin: 0 auto;
      padding: clamp(14px, 2vw, 28px);
      min-height: 100vh;
    }

    .app-title {
      font-size: clamp(22px, 2.8vw, 36px);
    }

    .section-title {
      font-size: clamp(18px, 2vw, 24px);
      flex-wrap: wrap;
    }
    
    .scrollable {
      -webkit-overflow-scrolling: touch;
      overflow-y: auto;
    }
    
    button, input[type="checkbox"] {
      min-height: 44px;
      min-width: 44px;
    }
    
    #root {
      min-height: 100vh;
      min-height: -webkit-fill-available;
    }

    .editable-input {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      color: white;
      font-size: inherit;
      font-weight: inherit;
      width: 100%;
      outline: none;
      padding: 4px 8px;
      border-radius: 6px;
      transition: all 0.2s;
      font-family: inherit;
    }
    
    .editable-input:focus {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
    }

    .draggable-task {
      cursor: move;
      transition: transform 0.2s, opacity 0.2s;
    }

    .draggable-task:active {
      opacity: 0.5;
      cursor: grabbing;
    }

    .stat-card {
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }

    /* ì ‘ê¸°/í¼ì¹˜ê¸° ì• ë‹ˆë©”ì´ì…˜ */
    .collapsible {
      overflow: hidden;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
    }

    .collapsed {
      max-height: 0 !important;
      opacity: 0;
    }

    .collapse-toggle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      background: rgba(139, 92, 246, 0.2);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 8px;
      color: #a78bfa;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .collapse-toggle:hover {
      background: rgba(139, 92, 246, 0.3);
      transform: scale(1.05);
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideInUp 0.4s ease-out;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      max-width: 900px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 24px;
      animation: slideInUp 0.3s;
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring-circle {
      transition: stroke-dashoffset 0.5s;
    }

    input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: rgba(255,255,255,0.1);
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3b82f6;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3b82f6;
      cursor: pointer;
      border: none;
    }

    .token-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2));
      border: 1px solid rgba(251, 191, 36, 0.3);
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      color: #fbbf24;
    }

    .level-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.2));
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      color: #a78bfa;
    }

    /* ì‹œê°„í‘œ ìŠ¤íƒ€ì¼ */
    .timetable {
      display: grid;
      grid-template-columns: 80px repeat(5, 1fr);
      gap: 2px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .timetable-cell {
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      min-height: 100px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .timetable-cell:hover {
      background: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.3);
      transform: scale(1.02);
    }

    .timetable-header {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(99, 102, 241, 0.3));
      border: 1px solid rgba(59, 130, 246, 0.4);
      font-weight: 900;
      text-align: center;
      padding: 14px;
      font-size: 14px;
      color: #60a5fa;
    }

    .lesson-card {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(168, 85, 247, 0.3));
      border: 1px solid rgba(139, 92, 246, 0.4);
      border-radius: 8px;
      padding: 10px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 6px;
    }

    .lesson-card:hover {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.4), rgba(168, 85, 247, 0.4));
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .lesson-card-title {
      font-weight: 700;
      color: #c4b5fd;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .lesson-card-subtitle {
      font-size: 10px;
      color: rgba(255,255,255,0.7);
    }

    /* í•™ìƒ í‰ê°€ ê·¸ë¦¬ë“œ */
    .student-eval-grid {
      display: grid;
      grid-template-columns: 120px repeat(6, 1fr);
      gap: 8px;
      margin-top: 16px;
    }

    .eval-cell {
      padding: 12px 8px;
      background: rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
      font-weight: 600;
    }

    .eval-cell:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .eval-cell.selected {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.3);
      border-width: 2px;
      font-weight: 900;
    }

    .eval-score-0 { 
      background: linear-gradient(135deg, rgba(107, 114, 128, 0.3), rgba(75, 85, 99, 0.3)); 
      border-color: rgba(107, 114, 128, 0.5);
    }
    .eval-score-0.selected { background: rgba(107, 114, 128, 0.5); }
    
    .eval-score-1 { 
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.3)); 
      border-color: rgba(239, 68, 68, 0.5);
    }
    .eval-score-1.selected { background: rgba(239, 68, 68, 0.5); }
    
    .eval-score-2 { 
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3)); 
      border-color: rgba(251, 191, 36, 0.5);
    }
    .eval-score-2.selected { background: rgba(251, 191, 36, 0.5); }
    
    .eval-score-3 { 
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.3)); 
      border-color: rgba(59, 130, 246, 0.5);
    }
    .eval-score-3.selected { background: rgba(59, 130, 246, 0.5); }
    
    .eval-score-4 { 
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.3)); 
      border-color: rgba(34, 197, 94, 0.5);
    }
    .eval-score-4.selected { background: rgba(34, 197, 94, 0.5); }
    
    .eval-score-5 { 
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.3)); 
      border-color: rgba(16, 185, 129, 0.5);
    }
    .eval-score-5.selected { background: rgba(16, 185, 129, 0.5); }

    /* íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .file-input-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border: none;
      border-radius: 10px;
      color: white;
      fontSize: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .file-input-label:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    input[type="file"] {
      display: none;
    }

    /* ì•Œë¦¼ ë°°ë„ˆ */
    .alert-banner {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 12px;
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);
      z-index: 2000;
      animation: slideInRight 0.3s, pulse 1s infinite;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
    .chart-container {
      position: relative;
      height: clamp(240px, 30vw, 360px);
      margin: 20px 0;
      padding: 20px;
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    .chart-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .chart-actions .form-select {
      min-width: 140px;
      flex: 1 1 160px;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
    }

    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    .chart-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .chart-actions .form-select {
      min-width: 140px;
      flex: 1 1 160px;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
    }

    /* ì§„í–‰ë¥  ìë™ í‘œì‹œ */
    .auto-progress-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.2));
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      color: #10b981;
    }

    /* ë°˜ì‘í˜• ë””ìì¸ - ëª¨ë°”ì¼ ìµœì í™” */

    /* í–„ë²„ê±° ë©”ë‰´ */
    .hamburger-menu {
      display: none;
      flex-direction: column;
      gap: 4px;
      padding: 10px;
      background: rgba(99, 102, 241, 0.3);
      border: 1px solid rgba(99, 102, 241, 0.5);
      border-radius: 8px;
      cursor: pointer;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1001;
      min-height: 44px;
      min-width: 44px;
    }

    .hamburger-line {
      width: 25px;
      height: 3px;
      background: white;
      border-radius: 2px;
      transition: all 0.3s;
    }

    .mobile-nav-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      padding: 80px 20px calc(20px + env(safe-area-inset-bottom));
      overflow-y: auto;
    }

    .mobile-nav-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 32px;
      color: white;
      cursor: pointer;
      padding: 10px;
      min-height: 44px;
      min-width: 44px;
    }

    /* ê²€ìƒ‰ë°” ìŠ¤íƒ€ì¼ */
    .search-container {
      position: sticky;
      top: 0;
      z-index: 999;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .search-input {
      width: 100%;
      padding: 12px 40px 12px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      font-size: 14px;
      outline: none;
      transition: all 0.3s;
    }

    .search-input:focus {
      background: rgba(255, 255, 255, 0.15);
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 20px;
      right: 20px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      margin-top: 8px;
      max-height: 400px;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .search-result-item {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: all 0.2s;
    }

    .search-result-item:hover {
      background: rgba(59, 130, 246, 0.2);
    }

    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (ëª¨ë°”ì¼) */
    .bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 8px 8px calc(8px + env(safe-area-inset-bottom));
      z-index: 100;
      box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.4);
    }

    .bottom-nav-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 4px;
    }

    .bottom-nav-btn {
      padding: 8px;
      min-height: 52px;
      min-width: 60px;
      background: transparent;
      border: none;
      border-radius: 8px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: all 0.2s;
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
    }

    .form-control,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 16px;
      line-height: 1.4;
    }

    .form-textarea {
      resize: vertical;
      min-height: 120px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 4px;
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
    }

    .form-control,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 16px;
      line-height: 1.4;
    }

    .form-textarea {
      resize: vertical;
      min-height: 120px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 4px;
    }

    .bottom-nav-btn.active {
      background: rgba(99, 102, 241, 0.3);
      color: white;
    }

    .bottom-nav-btn span {
      font-size: 20px;
    }

    /* íƒœë¸”ë¦¿ (768px - 1024px) */
    @media (max-width: 1024px) and (min-width: 768px) {
      .timetable {
        grid-template-columns: 70px repeat(5, 1fr);
        font-size: 12px;
      }

      .student-eval-grid {
        grid-template-columns: 100px repeat(6, 1fr);
        gap: 6px;
        font-size: 12px;
      }

      .modal-content {
        max-width: 700px;
        padding: 20px;
      }
    }

    /* ëª¨ë°”ì¼ (<768px) */
    @media (max-width: 768px) {
      body {
        padding-bottom: 70px;
      }

      .app-container {
        padding: 16px 12px 80px;
      }

      .hamburger-menu {
        display: flex;
        top: 12px;
        right: 12px;
      }

      .bottom-nav {
        display: block;
      }

      .timetable {
        grid-template-columns: 50px repeat(5, 1fr);
        font-size: 10px;
        gap: 1px;
      }

      .student-eval-grid {
        grid-template-columns: 70px repeat(6, 1fr);
        gap: 3px;
        font-size: 10px;
      }

      .timetable-cell {
        min-height: 70px;
        padding: 6px;
      }

      .lesson-card {
        padding: 6px;
        font-size: 10px;
        margin-bottom: 4px;
      }

      .modal-content {
        max-width: 100%;
        width: 100%;
        max-height: 100vh;
        border-radius: 0;
        padding: 16px;
      }

      .chart-container {
        height: 240px;
        padding: 12px;
      }

      /* ì¹´ë“œ ë·°ë¡œ ë³€í™˜ */
      .mobile-card-view {
        display: block !important;
      }

      .mobile-card-item {
        padding: 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        margin-bottom: 12px;
      }

      /* ë„¤ë¹„ê²Œì´ì…˜ ìˆ¨ê¹€ (í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ì‚¬ìš©) */
      .desktop-nav {
        display: none !important;
      }

      /* ê²€ìƒ‰ë°” ëª¨ë°”ì¼ ìµœì í™” */
      .search-container {
        padding: 10px 15px;
      }

      .search-input {
        font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .calendar-grid {
        gap: 2px;
      }
    }

    /* ê°€ë¡œ ëª¨ë“œ */
    @media (max-width: 768px) and (orientation: landscape) {
      .bottom-nav {
        padding: 4px;
      }

      .bottom-nav-btn {
        padding: 6px;
        font-size: 10px;
      }

      .bottom-nav-btn span {
        font-size: 16px;
      }
    }

    /* ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì§€ì› */
    .swipeable {
      touch-action: pan-y;
      user-select: none;
    }

    .calendar-swipe {
      touch-action: pan-y;
    }

    .calendar-swipe {
      touch-action: pan-y;
    }

    /* í„°ì¹˜ í”¼ë“œë°± */
    @media (hover: none) and (pointer: coarse) {
      button:active, .clickable:active {
        transform: scale(0.95);
        opacity: 0.8;
      }
    }

    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #4f46e5, #4338ca);
    }
  </style>
</head>
<body>
  <div id="root">
    <div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0a0e27 100%); color: white; font-family: sans-serif;">
      <div style="text-align: center;">
        <h1 style="font-size: 36px; margin-bottom: 20px;">â³ ë¡œë”© ì¤‘...</h1>
        <p style="color: rgba(255,255,255,0.7);">ì‹œìŠ¤í…œì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.</p>
      </div>
    </div>
  </div>
<script type="text/babel">
    console.log('========================================');
    console.log('ğŸš€ Babel script execution started');
    console.log('Time:', new Date().toLocaleTimeString());
    console.log('========================================');

    if (typeof React === 'undefined') {
      throw new Error('React is not loaded!');
    }
    if (typeof ReactDOM === 'undefined') {
      throw new Error('ReactDOM is not loaded!');
    }

    console.log('âœ“ React libraries confirmed loaded');

    const { useEffect, useMemo, useRef, useState, useCallback } = React;
    console.log('âœ“ React hooks destructured successfully');

    const LS_KEY = "adhd_pro_manager_v2_upgraded";

    function nowMs() { return Date.now(); }
    function uuid() {
      return Math.random().toString(16).slice(2) + "-" + Math.random().toString(16).slice(2);
    }

    function toLocalDatetimeValue(ts) {
      if (!ts) return "";
      const d = new Date(ts);
      const pad = (n) => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function fromLocalDatetimeValue(v) {
      if (!v) return null;
      const t = new Date(v).getTime();
      return Number.isFinite(t) ? t : null;
    }

    function toLocalDateValue(ts) {
      if (!ts) return "";
      const d = new Date(ts);
      const pad = (n) => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
    }

    function clamp01(x) { return Math.min(1, Math.max(0, x)); }

    function formatDateTime(timestamp) {
      if (!timestamp) return '';
      const date = new Date(timestamp);
      return date.toLocaleString('ko-KR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });
    }

    function startOfWeek(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = (day === 0 ? -6 : 1) - day;
      d.setDate(d.getDate() + diff);
      d.setHours(0, 0, 0, 0);
      return d;
    }

    function addDays(date, days) {
      const d = new Date(date);
      d.setDate(d.getDate() + days);
      return d;
    }

    function isSameDay(a, b) {
      if (!a || !b) return false;
      const da = new Date(a);
      const db = new Date(b);
      return da.getFullYear() === db.getFullYear() &&
        da.getMonth() === db.getMonth() &&
        da.getDate() === db.getDate();
    }

    function getDayLabel(date) {
      const day = new Date(date).getDay();
      if (day === 0) return 'ì¼';
      if (day === 6) return 'í† ';
      return DAYS_OF_WEEK[day - 1];
    }

    // ì£¼ê°„ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ëª©ìš”ì¼ ê¸°ì¤€ 0ì›” 0ì£¼ì°¨)
    function getWeekLabel(weekStartDate) {
      // í•´ë‹¹ ì£¼ì˜ ëª©ìš”ì¼ ì°¾ê¸° (ì›”ìš”ì¼ ê¸°ì¤€ ì‹œì‘ì´ë¯€ë¡œ +3ì¼)
      const thursday = addDays(weekStartDate, 3);
      const month = thursday.getMonth() + 1; // 0-basedì´ë¯€ë¡œ +1

      // ê·¸ ë‹¬ì˜ ì²« ë²ˆì§¸ ëª©ìš”ì¼ ì°¾ê¸°
      const firstDayOfMonth = new Date(thursday.getFullYear(), thursday.getMonth(), 1);
      let firstThursday = new Date(firstDayOfMonth);
      const dayOfWeek = firstDayOfMonth.getDay();
      // ëª©ìš”ì¼ì€ 4 (ì¼=0, ì›”=1, ... ëª©=4)
      const daysUntilThursday = (4 - dayOfWeek + 7) % 7;
      firstThursday.setDate(1 + daysUntilThursday);

      // ì£¼ì°¨ ê³„ì‚°
      const weekNumber = Math.floor((thursday.getDate() - firstThursday.getDate()) / 7) + 1;

      return `${month}ì›” ${weekNumber}ì£¼ì°¨`;
    }

    // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
    function requestNotificationPermission() {
      if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission();
      }
    }

    // ì•Œë¦¼ í‘œì‹œ (ì†Œë¦¬ + ì§„ë™ + ì‹œê°ì  ì•Œë¦¼)
    function showNotification(title, body, options = {}) {
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(title, {
          body,
          icon: 'ğŸš—',
          badge: 'â°',
          vibrate: [200, 100, 200, 100, 200],
          requireInteraction: true,
          tag: options.tag || 'default',
          ...options
        });
      }
      
      // ì•Œë¦¼ìŒ ì¬ìƒ
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
      } catch (e) {
        console.log('Audio notification failed:', e);
      }
    }

    const CATEGORIES = {
      IEP: { label: 'IEP í‰ê°€', icon: 'ğŸ“‹', color: '#3b82f6' },
      PBS: { label: 'PBS ì‘ì—…', icon: 'ğŸ¯', color: '#8b5cf6' },
      SUPERVISION: { label: 'ìˆ˜í¼ë¹„ì „', icon: 'ğŸ‘¥', color: '#ec4899' },
      PLATFORM: { label: 'í”Œë«í¼ ê°œë°œ', icon: 'ğŸ’»', color: '#10b981' },
      BEHAVIOR: { label: 'í–‰ë™ì¤‘ì¬', icon: 'ğŸ“Š', color: '#f59e0b' },
      ADMIN: { label: 'í–‰ì •ì—…ë¬´', icon: 'ğŸ“', color: '#6366f1' },
      STUDENT: { label: 'í•™ìƒ ì§€ì›', icon: 'ğŸ“', color: '#06b6d4' },
      RESEARCH: { label: 'ì—°êµ¬/ìë£Œ', icon: 'ğŸ”¬', color: '#84cc16' },
      TEACHING: { label: 'ìˆ˜ì—… ì¤€ë¹„', icon: 'ğŸ‘¨â€ğŸ«', color: '#f43f5e' },
      LECTURE: { label: 'ê°•ì˜ í™œë™', icon: 'ğŸ¤', color: '#14b8a6' },
      PERSONAL: { label: 'ê°œì¸ ìƒí™œ', icon: 'ğŸ ', color: '#a855f7' },
    };

    const PRIORITIES = {
      URGENT: { label: 'ê¸´ê¸‰', icon: 'ğŸ”´', value: 4 },
      HIGH: { label: 'ë†’ìŒ', icon: 'ğŸŸ ', value: 3 },
      MEDIUM: { label: 'ë³´í†µ', icon: 'ğŸŸ¡', value: 2 },
      LOW: { label: 'ë‚®ìŒ', icon: 'ğŸŸ¢', value: 1 },
    };

    const DAYS_OF_WEEK = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
    const PERIODS = ['1êµì‹œ', '2êµì‹œ', '3êµì‹œ', '4êµì‹œ', '5êµì‹œ', '6êµì‹œ', '7êµì‹œ'];

    // ê³¼ëª© ëª©ë¡ ë° ìƒ‰ìƒ
    const SUBJECTS = {
      'ì˜ì‚¬ì†Œí†µ': { color: '#ef4444', label: 'ì˜ì‚¬ì†Œí†µ' },
      'ìë¦½ìƒí™œ': { color: '#f97316', label: 'ìë¦½ìƒí™œ' },
      'ì‹ ì²´í™œë™': { color: '#f59e0b', label: 'ì‹ ì²´í™œë™' },
      'ì—¬ê°€í™œë™': { color: '#eab308', label: 'ì—¬ê°€í™œë™' },
      'ììœ¨': { color: '#84cc16', label: 'ììœ¨' },
      'ë™ì•„ë¦¬': { color: '#22c55e', label: 'ë™ì•„ë¦¬' },
      'ë´‰ì‚¬': { color: '#10b981', label: 'ë´‰ì‚¬' },
      'ì§„ë¡œ': { color: '#14b8a6', label: 'ì§„ë¡œ' },
      'ë°”ë¥¸ìƒí™œ': { color: '#06b6d4', label: 'ë°”ë¥¸ìƒí™œ' },
      'ìŠ¬ê¸°ë¡œìš´ìƒí™œ': { color: '#0ea5e9', label: 'ìŠ¬ê¸°ë¡œìš´ìƒí™œ' },
      'ì¦ê±°ìš´ ìƒí™œ': { color: '#3b82f6', label: 'ì¦ê±°ìš´ ìƒí™œ' },
      'ì‹¤ê³¼': { color: '#6366f1', label: 'ì‹¤ê³¼' },
      'êµ­ì–´': { color: '#8b5cf6', label: 'êµ­ì–´' },
      'ì‚¬íšŒ': { color: '#a855f7', label: 'ì‚¬íšŒ' },
      'ìˆ˜í•™': { color: '#c026d3', label: 'ìˆ˜í•™' },
      'ê³¼í•™': { color: '#d946ef', label: 'ê³¼í•™' },
      'ì§„ì§': { color: '#e879f9', label: 'ì§„ì§' },
      'ì²´ìœ¡': { color: '#ec4899', label: 'ì²´ìœ¡' },
      'ìŒì•…': { color: '#f43f5e', label: 'ìŒì•…' },
      'ë¯¸ìˆ ': { color: '#fb7185', label: 'ë¯¸ìˆ ' },
      'ì¬í™œ': { color: '#f87171', label: 'ì¬í™œ' },
      'ì—¬ê°€': { color: '#fbbf24', label: 'ì—¬ê°€' },
      'ì •ë³´': { color: '#facc15', label: 'ì •ë³´' },
      'ìƒí™œì˜ì–´': { color: '#a3e635', label: 'ìƒí™œì˜ì–´' },
      'ë³´ê±´': { color: '#4ade80', label: 'ë³´ê±´' },
      'ìŠ¤í¬ì¸ ': { color: '#34d399', label: 'ìŠ¤í¬ì¸ ' },
      'ì£¼ì œì„ íƒ': { color: '#2dd4bf', label: 'ì£¼ì œì„ íƒ' },
      'ì§„ë¡œíƒìƒ‰': { color: '#22d3ee', label: 'ì§„ë¡œíƒìƒ‰' },
      'ì˜ˆìˆ ì²´ìœ¡': { color: '#38bdf8', label: 'ì˜ˆìˆ ì²´ìœ¡' },
      'ì§ì—…': { color: '#60a5fa', label: 'ì§ì—…' },
      'ê¸°ì´ˆì‘ì—…': { color: '#818cf8', label: 'ê¸°ì´ˆì‘ì—…' },
      'ì§ì—…ì¤€ë¹„': { color: '#a78bfa', label: 'ì§ì—…ì¤€ë¹„' },
      'ì‚¬ë¬´ì§€ì›': { color: '#c4b5fd', label: 'ì‚¬ë¬´ì§€ì›' },
      'ì™¸ì‹ì„œë¹„ìŠ¤': { color: '#d8b4fe', label: 'ì™¸ì‹ì„œë¹„ìŠ¤' },
      'ëŒ€ì¸ì„œë¹„ìŠ¤': { color: '#e9d5ff', label: 'ëŒ€ì¸ì„œë¹„ìŠ¤' },
      'ì •ë³´ì²˜ë¦¬': { color: '#f0abfc', label: 'ì •ë³´ì²˜ë¦¬' },
      'ë°©ê³¼í›„': { color: '#f9a8d4', label: 'ë°©ê³¼í›„' },
    };

    const EVAL_SCORES = {
      0: { label: 'ê²°ì„', color: '#6b7280', description: 'ìˆ˜ì—… ë¶ˆì°¸' },
      1: { label: 'ë¯¸ì°¸ì—¬', color: '#ef4444', description: 'ìˆ˜ì—… ì°¸ì—¬í•˜ì§€ ì•ŠìŒ' },
      2: { label: 'ë¯¸ë„ë‹¬', color: '#fbbf24', description: 'ëª©í‘œ ë¯¸ë‹¬ì„±' },
      3: { label: 'ìµœëŒ€ì´‰êµ¬', color: '#3b82f6', description: 'ì „ì ì¸ ë„ì›€ í•„ìš”' },
      4: { label: 'ì¼ë¶€ì´‰êµ¬', color: '#22c55e', description: 'ë¶€ë¶„ì  ë„ì›€ í•„ìš”' },
      5: { label: 'ëª©í‘œë‹¬ì„±', color: '#10b981', description: 'ë…ë¦½ì  ìˆ˜í–‰' },
    };

    // í–‰ë™ ìœ í˜• (PBS/í–‰ë™ì§€ì›)
    const BEHAVIOR_TYPES = {
      TARGET: { label: 'í‘œì í–‰ë™', color: '#ef4444', icon: 'ğŸ¯' },
      REPLACEMENT: { label: 'ëŒ€ì²´í–‰ë™', color: '#10b981', icon: 'âœ¨' },
      POSITIVE: { label: 'ê¸ì •í–‰ë™', color: '#3b82f6', icon: 'ğŸ‘' },
    };

    // ì¼ë°˜ì ì¸ í–‰ë™ ëª©ë¡ (ë¹ ë¥¸ ì¶”ê°€ìš©)
    const COMMON_BEHAVIORS = [
      'ì†Œë¦¬ì§€ë¥´ê¸°', 'ìë¦¬ì´íƒˆ', 'ë¬¼ê±´ë˜ì§€ê¸°', 'ìí•´í–‰ë™', 'ê³µê²©í–‰ë™',
      'ê³¼ì œê±°ë¶€', 'ì£¼ì˜ì§‘ì¤‘', 'ê¸ì •ì  ìƒí˜¸ì‘ìš©', 'ì§€ì‹œë”°ë¥´ê¸°', 'ìê¸°ì¡°ì ˆ'
    ];

    // ì¼ë°˜ì ì¸ ì„ í–‰ì‚¬ê±´
    const COMMON_ANTECEDENTS = [
      'ê³¼ì œì œì‹œ', 'ë˜ë˜ìƒí˜¸ì‘ìš©', 'ì „í™˜ìƒí™©', 'ìš”êµ¬ê±°ë¶€', 'ê°ê°ìê·¹',
      'ê´€ì‹¬ìš”êµ¬', 'íšŒí”¼', 'ì˜ˆì¸¡ë¶ˆê°€ëŠ¥í•œ ìƒí™©'
    ];

    // ì¼ë°˜ì ì¸ í›„ì†ê²°ê³¼
    const COMMON_CONSEQUENCES = [
      'ê´€ì‹¬ì œê³µ', 'ê³¼ì œì¤‘ë‹¨', 'í† í°ì œê³µ', 'êµ¬ë‘ì¹­ì°¬', 'ë¬´ì‹œ',
      'ì§„ì •ì‹œê°„', 'ì„ íƒê¶Œì œê³µ', 'ëŒ€ì²´í–‰ë™ì´‰êµ¬'
    ];

    const DEFAULT_STATE = {
      points: 0,
      level: 1,
      tasks: [],
      focus: {
        running: false,
        paused: false,
        durationSec: 120,
        startedTs: null,
        pausedAt: null,
        elapsedBeforePause: 0,
        taskId: null,
        note: "",
      },
      schedules: [],
      filters: {
        category: 'ALL',
        priority: 'ALL',
        searchText: '',
      },
      completedSprints: [],
      focusHistory: [], // ì§‘ì¤‘ ì„¸ì…˜ ì´ë ¥ (ì €ì¥/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥)
      scheduleHistory: [], // ì¼ì • ì´ë ¥ (ì €ì¥/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥)
      behaviorLog: [],
      lessons: [], // ìˆ˜ì—… ë°ì´í„°
      studentEvals: {}, // í•™ìƒë³„ í‰ê°€ ë°ì´í„° { lessonId: { studentId: score } }
      collapsedItems: {},
      alertedSchedules: {},
      recentSearches: [], // ìµœê·¼ ê²€ìƒ‰ ê¸°ë¡ (ìµœëŒ€ 10ê°œ)
      taskSortBy: 'deadline', // ê³¼ì œ ì •ë ¬ ê¸°ì¤€ (deadline, priority, name, createdAt)
    };

    function loadState() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return DEFAULT_STATE;
        const parsed = JSON.parse(raw);
        if (!parsed || typeof parsed !== "object") return DEFAULT_STATE;
        
        return {
          ...DEFAULT_STATE,
          ...parsed,
          tasks: Array.isArray(parsed.tasks) ? parsed.tasks : DEFAULT_STATE.tasks,
          focus: { ...DEFAULT_STATE.focus, ...(parsed.focus || {}) },
          schedules: Array.isArray(parsed.schedules) ? parsed.schedules : DEFAULT_STATE.schedules,
          filters: { ...DEFAULT_STATE.filters, ...(parsed.filters || {}) },
          completedSprints: Array.isArray(parsed.completedSprints) ? parsed.completedSprints : [],
          focusHistory: Array.isArray(parsed.focusHistory) ? parsed.focusHistory : [],
          scheduleHistory: Array.isArray(parsed.scheduleHistory) ? parsed.scheduleHistory : [],
          behaviorLog: Array.isArray(parsed.behaviorLog) ? parsed.behaviorLog : [],
          lessons: Array.isArray(parsed.lessons) ? parsed.lessons : [],
          studentEvals: parsed.studentEvals || {},
          collapsedItems: parsed.collapsedItems || {},
          alertedSchedules: parsed.alertedSchedules || {},
          recentSearches: Array.isArray(parsed.recentSearches) ? parsed.recentSearches : [],
          taskSortBy: parsed.taskSortBy || DEFAULT_STATE.taskSortBy,
        };
      } catch {
        return DEFAULT_STATE;
      }
    }

    function saveState(st) {
      localStorage.setItem(LS_KEY, JSON.stringify(st));
    }

    // CSV ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
    function exportToCSV(data, filename) {
      const csvContent = data.map(row => row.map(cell => {
        const cellStr = String(cell || '');
        return cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')
          ? `"${cellStr.replace(/"/g, '""')}"`
          : cellStr;
      }).join(',')).join('\n');

      const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }

    function parseCSV(text) {
      // ì…ë ¥ ê²€ì¦
      if (!text || typeof text !== 'string') {
        throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ CSV í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.');
      }

      // BOM (Byte Order Mark) ì œê±°
      if (text.charCodeAt(0) === 0xFEFF) {
        text = text.slice(1);
      }

      // ë¹ˆ í…ìŠ¤íŠ¸ ì²˜ë¦¬
      if (text.trim().length === 0) {
        return [];
      }

      const rows = [];
      let currentRow = [];
      let currentCell = '';
      let inQuotes = false;
      let quoteStarted = false; // ì…€ì´ ë”°ì˜´í‘œë¡œ ì‹œì‘í–ˆëŠ”ì§€ ì¶”ì 

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const nextChar = text[i + 1];

        if (char === '"') {
          if (!inQuotes && currentCell === '') {
            // ì…€ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ë”°ì˜´í‘œ ë°œê²¬
            inQuotes = true;
            quoteStarted = true;
          } else if (inQuotes && nextChar === '"') {
            // ì´ìŠ¤ì¼€ì´í”„ëœ ë”°ì˜´í‘œ ("" -> ")
            currentCell += '"';
            i++;
          } else if (inQuotes) {
            // ë”°ì˜´í‘œ ì¢…ë£Œ
            inQuotes = false;
          } else {
            // ë”°ì˜´í‘œë¡œ ì‹œì‘í•˜ì§€ ì•Šì€ ì…€ ë‚´ë¶€ì˜ ë”°ì˜´í‘œëŠ” ë¦¬í„°ëŸ´ë¡œ ì²˜ë¦¬
            currentCell += char;
          }
        } else if (char === ',' && !inQuotes) {
          // í•„ë“œ êµ¬ë¶„ì
          currentRow.push(currentCell);
          currentCell = '';
          quoteStarted = false;
        } else if ((char === '\n' || char === '\r') && !inQuotes) {
          // í–‰ ì¢…ë£Œ
          currentRow.push(currentCell);

          // ë¹ˆ í–‰ì´ ì•„ë‹Œ ê²½ìš°ë§Œ ì¶”ê°€ (ëª¨ë“  ì…€ì´ ë¹„ì–´ìˆì§€ ì•Šì€ ê²½ìš°)
          if (currentRow.some(cell => cell.trim() !== '')) {
            rows.push(currentRow);
          }

          currentRow = [];
          currentCell = '';
          quoteStarted = false;

          // CRLF ì²˜ë¦¬
          if (char === '\r' && nextChar === '\n') {
            i++;
          }
        } else {
          currentCell += char;
        }
      }

      // ë§ˆì§€ë§‰ ì…€ê³¼ í–‰ ì²˜ë¦¬
      if (currentCell || currentRow.length > 0) {
        currentRow.push(currentCell);
        // ë¹ˆ í–‰ì´ ì•„ë‹Œ ê²½ìš°ë§Œ ì¶”ê°€
        if (currentRow.some(cell => cell.trim() !== '')) {
          rows.push(currentRow);
        }
      }

      // ë”°ì˜´í‘œê°€ ì œëŒ€ë¡œ ë‹«íˆì§€ ì•Šì€ ê²½ìš° ê²½ê³ 
      if (inQuotes) {
        console.warn('CSV íŒŒì‹± ê²½ê³ : ë‹«íˆì§€ ì•Šì€ ë”°ì˜´í‘œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }

      // í–‰ ê¸¸ì´ ì •ê·œí™” (ê°€ì¥ ê¸´ í–‰ì„ ê¸°ì¤€ìœ¼ë¡œ ë¹ˆ ì…€ ì¶”ê°€)
      const maxLength = Math.max(...rows.map(row => row.length));
      rows.forEach(row => {
        while (row.length < maxLength) {
          row.push('');
        }
      });

      return rows;
    }

    // ì§„í–‰ë¥  ìë™ ê³„ì‚° (ì„¸ë¶€ ë‹¨ê³„ ê¸°ë°˜)
    function calculateAutoProgress(task) {
      if (!task.steps || task.steps.length === 0) return task.progress || 0;
      const completed = task.steps.filter(s => s.done).length;
      return Math.round((completed / task.steps.length) * 100);
    }

    // í–‰ë™ ë¡œê·¸ CSV ë‚´ë³´ë‚´ê¸°
    function exportBehaviorLogCSV(behaviorLog) {
      const headers = ['ID', 'ë‚ ì§œì‹œê°„', 'í•™ìƒì´ë¦„', 'í–‰ë™ìœ í˜•', 'ì„ í–‰ì‚¬ê±´', 'í–‰ë™', 'í›„ì†ê²°ê³¼', 'ë¹ˆë„', 'ê°•ë„', 'ì§€ì†ì‹œê°„(ë¶„)', 'ì¤‘ì¬ë…¸íŠ¸'];
      const rows = [headers];

      behaviorLog.forEach(log => {
        rows.push([
          log.id,
          new Date(log.timestamp).toLocaleString('ko-KR'),
          log.studentName || '',
          BEHAVIOR_TYPES[log.behaviorType]?.label || log.behaviorType,
          log.antecedent || '',
          log.behavior || '',
          log.consequence || '',
          log.frequency || 1,
          log.intensity || 1,
          log.duration || 0,
          log.interventionNote || ''
        ]);
      });

      exportToCSV(rows, `í–‰ë™ë¡œê·¸_${new Date().toISOString().slice(0,10)}.csv`);
    }

    // ì°¨íŠ¸ë¥¼ PNGë¡œ ë‚´ë³´ë‚´ê¸°
    function exportChartAsPNG(chartId, filename) {
      const canvas = document.getElementById(chartId);
      if (canvas) {
        const link = document.createElement('a');
        link.download = filename;
        link.href = canvas.toDataURL('image/png');
        link.click();
      }
    }

    // ì›í˜• íƒ€ì´ë¨¸ ì»´í¬ë„ŒíŠ¸
    function CircularTimer({ remainingMs, totalMs, size = 200 }) {
      const progress = totalMs > 0 ? clamp01(remainingMs / totalMs) : 1;
      const radius = (size - 20) / 2;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference * (1 - progress);
      
      const minutes = Math.floor(remainingMs / 60000);
      const seconds = Math.floor((remainingMs % 60000) / 1000);

      return (
        <div style={{ position: 'relative', width: size, height: size, margin: '0 auto' }}>
          <svg width={size} height={size} style={{ transform: 'rotate(-90deg)' }}>
            <circle
              cx={size / 2}
              cy={size / 2}
              r={radius}
              fill="none"
              stroke="rgba(255,255,255,0.1)"
              strokeWidth="10"
            />
            <circle
              cx={size / 2}
              cy={size / 2}
              r={radius}
              fill="none"
              stroke={progress > 0.5 ? '#10b981' : progress > 0.2 ? '#f59e0b' : '#ef4444'}
              strokeWidth="10"
              strokeDasharray={circumference}
              strokeDashoffset={offset}
              style={{ transition: 'stroke-dashoffset 0.3s linear, stroke 0.3s' }}
            />
          </svg>
          <div style={{
            position: 'absolute',
            top: '50%',
            left: '50%',
            transform: 'translate(-50%, -50%)',
            textAlign: 'center',
          }}>
            <div style={{ fontSize: 48, fontWeight: 900, color: 'white' }}>
              {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
            </div>
            <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.7)', marginTop: 8 }}>
              {progress > 0.5 ? 'ì§‘ì¤‘ ì¤‘!' : progress > 0.2 ? 'ì¡°ê¸ˆë§Œ ë”!' : 'ê±°ì˜ ë‹¤ ì™”ì–´ìš”!'}
            </div>
          </div>
        </div>
      );
    }

    // ì¶œë°œ ì•ŒëŒ ì¹´ìš´íŠ¸ë‹¤ìš´ ë°” (ìˆ˜ì •: ì•ŒëŒ ê¸°ëŠ¥ ê°•í™”)
    function CountdownBar({ schedule, now, onAlert }) {
      if (!schedule.arrivalTs) return null;

      const departTs = schedule.arrivalTs - schedule.departBeforeMin * 60 * 1000;
      const remaining = departTs - now;
      const totalTime = schedule.departBeforeMin * 60 * 1000;
      const progress = Math.max(0, Math.min(1, remaining / totalTime));

      const isPast = remaining < 0;
      const isUrgent = remaining > 0 && remaining < 15 * 60 * 1000;
      const isDepartTime = remaining <= 0 && remaining > -2000; // ì•ŒëŒ ìœˆë„ìš°: ì¶œë°œ ì‹œê°„ ì „í›„ 2ì´ˆ

      useEffect(() => {
        if (isDepartTime && onAlert) {
          onAlert(schedule.id);
        }
      }, [isDepartTime, schedule.id, onAlert]);

      const hrs = Math.floor(Math.abs(remaining) / (1000 * 60 * 60));
      const mins = Math.floor((Math.abs(remaining) % (1000 * 60 * 60)) / (1000 * 60));

      return (
        <div style={{
          padding: 16,
          borderRadius: 12,
          background: isPast ? 'rgba(239, 68, 68, 0.2)' : isUrgent ? 'rgba(251, 191, 36, 0.2)' : 'rgba(16, 185, 129, 0.2)',
          border: `2px solid ${isPast ? '#ef4444' : isUrgent ? '#fbbf24' : '#10b981'}`,
          marginBottom: 12,
          animation: isUrgent ? 'pulse 1s infinite' : 'none',
        }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>
            <div style={{ fontSize: 16, fontWeight: 700, color: 'white' }}>
              {schedule.name}
            </div>
            <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.8)' }}>
              {new Date(schedule.arrivalTs).toLocaleString('ko-KR', { 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit' 
              })}
            </div>
          </div>

          <div style={{
            height: 10,
            borderRadius: 5,
            background: 'rgba(0,0,0,0.3)',
            overflow: 'hidden',
            marginBottom: 10,
          }}>
            <div style={{
              height: '100%',
              width: `${progress * 100}%`,
              background: isPast ? 'linear-gradient(90deg, #ef4444, #dc2626)' : 
                         isUrgent ? 'linear-gradient(90deg, #fbbf24, #f59e0b)' : 
                         'linear-gradient(90deg, #10b981, #059669)',
              transition: 'width 1s linear',
            }} />
          </div>

          <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.95)', fontWeight: 700 }}>
            {isPast ? (
              <span>âš ï¸ ì¶œë°œ ì‹œê°„ {hrs > 0 ? `${hrs}ì‹œê°„ ` : ''}{mins}ë¶„ ì§€ë‚¨</span>
            ) : (
              <span>
                {isUrgent && 'â° '}
                ì¶œë°œê¹Œì§€ {hrs > 0 ? `${hrs}ì‹œê°„ ` : ''}{mins}ë¶„ ë‚¨ìŒ
              </span>
            )}
          </div>
        </div>
      );
    }

    // ìº˜ë¦°ë” ì»´í¬ë„ŒíŠ¸
    function Calendar({ tasks, schedules, lessons }) {
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const touchStartXRef = useRef(null);
      const touchStartYRef = useRef(null);

      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const daysInMonth = lastDay.getDate();

      const prevMonth = () => setCurrentMonth(new Date(year, month - 1, 1));
      const nextMonth = () => setCurrentMonth(new Date(year, month + 1, 1));

      const handleTouchStart = (event) => {
        if (!event.touches || event.touches.length === 0) return;
        const touch = event.touches[0];
        touchStartXRef.current = touch.clientX;
        touchStartYRef.current = touch.clientY;
      };

      const handleTouchEnd = (event) => {
        if (touchStartXRef.current === null || touchStartYRef.current === null) return;
        if (!event.changedTouches || event.changedTouches.length === 0) return;
        const touch = event.changedTouches[0];
        const deltaX = touch.clientX - touchStartXRef.current;
        const deltaY = touch.clientY - touchStartYRef.current;
        if (Math.abs(deltaX) > 50 && Math.abs(deltaX) > Math.abs(deltaY)) {
          if (deltaX > 0) {
            prevMonth();
          } else {
            nextMonth();
          }
        }
        touchStartXRef.current = null;
        touchStartYRef.current = null;
      };

      const days = [];
      for (let i = 0; i < startDay; i++) {
        days.push(<div key={`empty-${i}`} style={{ padding: 8 }} />);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dayTasks = tasks.filter(t => {
          if (!t.deadline) return false;
          const d = new Date(t.deadline);
          return d.getFullYear() === year && d.getMonth() === month && d.getDate() === day;
        });

        const daySchedules = schedules.filter(s => {
          if (!s.arrivalTs) return false;
          const d = new Date(s.arrivalTs);
          return d.getFullYear() === year && d.getMonth() === month && d.getDate() === day;
        });

        const dayLessons = lessons.filter(l => {
          if (!l.date) return false;
          const d = new Date(l.date);
          return d.getFullYear() === year && d.getMonth() === month && d.getDate() === day;
        });

        const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();

        days.push(
          <div
            key={day}
            style={{
              padding: 8,
              borderRadius: 8,
              background: isToday ? 'rgba(59, 130, 246, 0.2)' : 'rgba(255,255,255,0.02)',
              border: isToday ? '2px solid #3b82f6' : '1px solid rgba(255,255,255,0.05)',
              minHeight: 100,
            }}
          >
            <div style={{ 
              fontSize: 14, 
              fontWeight: isToday ? 900 : 700, 
              color: isToday ? '#3b82f6' : 'white',
              marginBottom: 6,
            }}>
              {day}
            </div>

            {dayTasks.map(t => (
              <div
                key={t.id}
                style={{
                  fontSize: 10,
                  padding: '3px 6px',
                  borderRadius: 4,
                  background: CATEGORIES[t.category]?.color || '#6b7280',
                  color: 'white',
                  marginBottom: 2,
                  overflow: 'hidden',
                  textOverflow: 'ellipsis',
                  whiteSpace: 'nowrap',
                }}
                title={t.title}
              >
                {t.title}
              </div>
            ))}

            {daySchedules.map(s => (
              <div
                key={s.id}
                style={{
                  fontSize: 10,
                  padding: '3px 6px',
                  borderRadius: 4,
                  background: '#10b981',
                  color: 'white',
                  marginBottom: 2,
                  overflow: 'hidden',
                  textOverflow: 'ellipsis',
                  whiteSpace: 'nowrap',
                }}
                title={s.name}
              >
                ğŸš— {s.name}
              </div>
            ))}

            {dayLessons.map(l => (
              <div
                key={l.id}
                style={{
                  fontSize: 10,
                  padding: '3px 6px',
                  borderRadius: 4,
                  background: '#8b5cf6',
                  color: 'white',
                  marginBottom: 2,
                  overflow: 'hidden',
                  textOverflow: 'ellipsis',
                  whiteSpace: 'nowrap',
                }}
                title={l.subject}
              >
                ğŸ‘¨â€ğŸ« {l.subject}
              </div>
            ))}
          </div>
        );
      }

      return (
        <div className="swipeable calendar-swipe" onTouchStart={handleTouchStart} onTouchEnd={handleTouchEnd}>
          <div className="calendar-header" style={{ marginBottom: 16 }}>
            <button
              style={{
                padding: '10px 18px',
                background: 'rgba(255,255,255,0.1)',
                border: '1px solid rgba(255,255,255,0.2)',
                borderRadius: 10,
                color: 'white',
                cursor: 'pointer',
                fontSize: 14,
                fontWeight: 700,
              }}
              onClick={prevMonth}
            >
              â—€ ì´ì „
            </button>
            <div style={{ fontSize: 20, fontWeight: 900, color: 'white' }}>
              {year}ë…„ {month + 1}ì›”
            </div>
            <button
              style={{
                padding: '10px 18px',
                background: 'rgba(255,255,255,0.1)',
                border: '1px solid rgba(255,255,255,0.2)',
                borderRadius: 10,
                color: 'white',
                cursor: 'pointer',
                fontSize: 14,
                fontWeight: 700,
              }}
              onClick={nextMonth}
            >
              ë‹¤ìŒ â–¶
            </button>
          </div>

          <div className="calendar-grid">
            {['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].map(d => (
              <div key={d} style={{ 
                textAlign: 'center', 
                fontSize: 13, 
                fontWeight: 700, 
                color: 'rgba(255,255,255,0.7)',
                padding: 8,
              }}>
                {d}
              </div>
            ))}
            {days}
          </div>
        </div>
      );
    }

    console.log('âœ“ All helper components defined');

    // ë©”ì¸ App ì»´í¬ë„ŒíŠ¸
    function App() {
      console.log('ğŸ¯ App component rendering...');
      const [state, setState] = useState(() => {
        console.log('ğŸ“¦ Loading state from localStorage...');
        const loadedState = loadState();
        console.log('âœ“ State loaded:', {
          tasks: loadedState.tasks?.length,
          lessons: loadedState.lessons?.length,
          points: loadedState.points
        });
        return loadedState;
      });
      const [view, setView] = useState('dashboard');
      const [tick, setTick] = useState(0);
      const [editingLesson, setEditingLesson] = useState(null);
      const [showAlert, setShowAlert] = useState(null);
      const [selectedStudent, setSelectedStudent] = useState(null);
      const [searchQuery, setSearchQuery] = useState('');
      const [searchResults, setSearchResults] = useState([]);
      const [showSearch, setShowSearch] = useState(false);
      const [editingBehavior, setEditingBehavior] = useState(null);
      const [showMobileMenu, setShowMobileMenu] = useState(false);
      const [behaviorFilter, setBehaviorFilter] = useState({ dateRange: 30, student: 'ALL', chartType: 'daily' });
      const [reportType, setReportType] = useState('weekly');
      const [lessonWeekStart, setLessonWeekStart] = useState(() => startOfWeek(new Date()));
      const [behaviorWeekStart, setBehaviorWeekStart] = useState(() => startOfWeek(new Date()));
      const [behaviorWeekStudent, setBehaviorWeekStudent] = useState('ALL');
      const [scheduleDraft, setScheduleDraft] = useState({
        name: '',
        arrivalTs: '',
        departBeforeMin: 30,
        location: '',
        note: '',
      });
      const [focusDraft, setFocusDraft] = useState({
        durationMin: 25,
        note: '',
      });
      const [editingFocusHistory, setEditingFocusHistory] = useState(null);
      const [editingScheduleHistory, setEditingScheduleHistory] = useState(null);
      const [showFocusComplete, setShowFocusComplete] = useState(false);
      const searchInputRef = useRef(null);
      const lineChartRef = useRef(null);

      useEffect(() => {
        saveState(state);
      }, [state]);

      // 1ì´ˆë§ˆë‹¤ í‹± ì—…ë°ì´íŠ¸ (ì•ŒëŒ ì²´í¬ìš©)
      useEffect(() => {
        const iv = setInterval(() => setTick(t => t + 1), 1000);
        return () => clearInterval(iv);
      }, []);

      useEffect(() => {
        requestNotificationPermission();
      }, []);

      // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Ctrl/Cmd + Kë¡œ ê²€ìƒ‰ ì—´ê¸°)
      useEffect(() => {
        const handleKeyDown = (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            setShowSearch(true);
            setTimeout(() => searchInputRef.current?.focus(), 100);
          }
          if (e.key === 'Escape' && showSearch) {
            setShowSearch(false);
            setSearchQuery('');
            setSearchResults([]);
          }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [showSearch]);

      // ì‹¤ì‹œê°„ ê²€ìƒ‰ ê¸°ëŠ¥
      useEffect(() => {
        if (!searchQuery.trim()) {
          setSearchResults([]);
          return;
        }

        const query = searchQuery.toLowerCase();
        const results = [];

        // ìˆ˜ì—… ê²€ìƒ‰
        state.lessons.forEach(lesson => {
          if (lesson.subject?.toLowerCase().includes(query) ||
              lesson.topic?.toLowerCase().includes(query) ||
              lesson.goal?.toLowerCase().includes(query)) {
            results.push({
              type: 'ìˆ˜ì—…',
              title: lesson.subject,
              subtitle: `${lesson.dayOfWeek}ìš”ì¼ ${lesson.period} - ${lesson.topic || ''}`,
              data: lesson,
              action: () => { setEditingLesson(lesson); setShowSearch(false); }
            });
          }
        });

        // ê³¼ì œ ê²€ìƒ‰
        state.tasks.forEach(task => {
          if (task.title?.toLowerCase().includes(query)) {
            results.push({
              type: 'ê³¼ì œ',
              title: task.title,
              subtitle: `${CATEGORIES[task.category]?.label} - ${PRIORITIES[task.priority]?.label}`,
              data: task,
              action: () => { setView('tasks'); setShowSearch(false); }
            });
          }
        });

        // ì¼ì • ê²€ìƒ‰
        state.schedules.forEach(schedule => {
          if (schedule.name?.toLowerCase().includes(query)) {
            results.push({
              type: 'ì¼ì •',
              title: schedule.name,
              subtitle: new Date(schedule.arrivalTs).toLocaleString('ko-KR'),
              data: schedule,
              action: () => { setView('schedule'); setShowSearch(false); }
            });
          }
        });

        // í–‰ë™ ë¡œê·¸ ê²€ìƒ‰
        state.behaviorLog.forEach(log => {
          if (log.behavior?.toLowerCase().includes(query) ||
              log.studentName?.toLowerCase().includes(query) ||
              log.interventionNote?.toLowerCase().includes(query)) {
            results.push({
              type: 'í–‰ë™',
              title: `${log.studentName} - ${log.behavior}`,
              subtitle: new Date(log.timestamp).toLocaleString('ko-KR'),
              data: log,
              action: () => { setView('behavior'); setEditingBehavior(log); setShowSearch(false); }
            });
          }
        });

        setSearchResults(results.slice(0, 20)); // ìµœëŒ€ 20ê°œë§Œ í‘œì‹œ
      }, [searchQuery, state.lessons, state.tasks, state.schedules, state.behaviorLog]);

      useEffect(() => {
        if (view !== 'behaviorAnalytics') return;
        const canvas = document.getElementById('behaviorLineChart');
        if (!canvas || !window.Chart) return;

        if (!state.behaviorLog.length) {
          if (lineChartRef.current) {
            lineChartRef.current.destroy();
            lineChartRef.current = null;
          }
          return;
        }

        // Define student list and colors
        const students = ['í•™ìƒ1', 'í•™ìƒ2', 'í•™ìƒ3', 'í•™ìƒ4', 'í•™ìƒ5', 'í•™ìƒ6', 'í•™ìƒ7'];
        const studentColors = {
          'í•™ìƒ1': '#ef4444',
          'í•™ìƒ2': '#f59e0b',
          'í•™ìƒ3': '#eab308',
          'í•™ìƒ4': '#22c55e',
          'í•™ìƒ5': '#3b82f6',
          'í•™ìƒ6': '#8b5cf6',
          'í•™ìƒ7': '#ec4899',
          'í•™ê¸‰ í•©ê³„': '#ffffff'
        };

        // Filter data by date range, student, and behavior type
        const now = Date.now();
        let startDate;
        if (behaviorFilter.dateRange === 'march1') {
          // March 1st of current year
          const march1 = new Date(new Date().getFullYear(), 2, 1); // Month is 0-indexed
          startDate = march1.getTime();
        } else {
          const rangeMs = behaviorFilter.dateRange * 24 * 60 * 60 * 1000;
          startDate = now - rangeMs;
        }
        const filteredData = state.behaviorLog.filter(b => {
          if (b.timestamp < startDate) return false;
          // Don't filter by student for ALL or CLASS_TOTAL - we need all data for aggregation
          if (behaviorFilter.student !== 'ALL' && behaviorFilter.student !== 'CLASS_TOTAL' && b.studentName !== behaviorFilter.student) return false;
          return true;
        });

        let labels = [];
        let datasets = [];

        // Process data based on chart type
        if (behaviorFilter.chartType === 'daily') {
          // Daily frequency
          const dailyData = {};
          const dayCount = behaviorFilter.dateRange === 'march1'
            ? Math.ceil((now - startDate) / (24 * 60 * 60 * 1000))
            : behaviorFilter.dateRange;
          for (let i = 0; i < dayCount; i++) {
            const date = new Date(now - i * 24 * 60 * 60 * 1000);
            const dateStr = date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
            dailyData[dateStr] = {};
            students.forEach(s => dailyData[dateStr][s] = 0);
            dailyData[dateStr]['í•™ê¸‰ í•©ê³„'] = 0;
          }

          filteredData.forEach(b => {
            const dateStr = new Date(b.timestamp).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
            if (dailyData[dateStr]) {
              if (students.includes(b.studentName)) {
                dailyData[dateStr][b.studentName]++;
              }
              dailyData[dateStr]['í•™ê¸‰ í•©ê³„']++;
            }
          });

          labels = Object.keys(dailyData).reverse();

          // Add datasets based on filter selection
          if (behaviorFilter.student === 'ALL') {
            // Show all individual students only
            students.forEach(student => {
              datasets.push({
                label: student,
                data: labels.map(label => dailyData[label][student]),
                borderColor: studentColors[student],
                backgroundColor: 'transparent',
                tension: 0.4,
                borderWidth: 2,
              });
            });
          } else if (behaviorFilter.student === 'CLASS_TOTAL') {
            // Show only class total
            datasets.push({
              label: 'í•™ê¸‰ í•©ê³„',
              data: labels.map(label => dailyData[label]['í•™ê¸‰ í•©ê³„']),
              borderColor: studentColors['í•™ê¸‰ í•©ê³„'],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 3,
            });
          } else {
            // Show specific student only
            const selectedStudent = behaviorFilter.student;
            datasets.push({
              label: selectedStudent,
              data: labels.map(label => dailyData[label][selectedStudent] || 0),
              borderColor: studentColors[selectedStudent],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 2,
            });
          }

        } else if (behaviorFilter.chartType === 'weekly') {
          // Weekly frequency
          const weeks = Math.ceil(behaviorFilter.dateRange / 7);
          const weeklyData = {};

          for (let i = 0; i < weeks; i++) {
            const weekEnd = new Date(now - i * 7 * 24 * 60 * 60 * 1000);
            const weekStart = new Date(weekEnd - 6 * 24 * 60 * 60 * 1000);
            const weekLabel = `${weekStart.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })} - ${weekEnd.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}`;
            weeklyData[weekLabel] = { start: weekStart.getTime(), end: weekEnd.getTime() };
            students.forEach(s => weeklyData[weekLabel][s] = 0);
            weeklyData[weekLabel]['í•™ê¸‰ í•©ê³„'] = 0;
          }

          filteredData.forEach(b => {
            Object.keys(weeklyData).forEach(weekLabel => {
              const week = weeklyData[weekLabel];
              if (b.timestamp >= week.start && b.timestamp <= week.end) {
                if (students.includes(b.studentName)) {
                  weeklyData[weekLabel][b.studentName]++;
                }
                weeklyData[weekLabel]['í•™ê¸‰ í•©ê³„']++;
              }
            });
          });

          labels = Object.keys(weeklyData).reverse();

          // Add datasets based on filter selection
          if (behaviorFilter.student === 'ALL') {
            // Show all individual students only
            students.forEach(student => {
              datasets.push({
                label: student,
                data: labels.map(label => weeklyData[label][student]),
                borderColor: studentColors[student],
                backgroundColor: 'transparent',
                tension: 0.4,
                borderWidth: 2,
              });
            });
          } else if (behaviorFilter.student === 'CLASS_TOTAL') {
            // Show only class total
            datasets.push({
              label: 'í•™ê¸‰ í•©ê³„',
              data: labels.map(label => weeklyData[label]['í•™ê¸‰ í•©ê³„']),
              borderColor: studentColors['í•™ê¸‰ í•©ê³„'],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 3,
            });
          } else {
            // Show specific student only
            const selectedStudent = behaviorFilter.student;
            datasets.push({
              label: selectedStudent,
              data: labels.map(label => weeklyData[label][selectedStudent] || 0),
              borderColor: studentColors[selectedStudent],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 2,
            });
          }

        } else if (behaviorFilter.chartType === 'dayOfWeek') {
          // Day of week distribution (Mon-Fri only)
          const daysOfWeek = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
          const dayData = {};
          daysOfWeek.forEach(day => {
            dayData[day] = {};
            students.forEach(s => dayData[day][s] = 0);
            dayData[day]['í•™ê¸‰ í•©ê³„'] = 0;
          });

          filteredData.forEach(b => {
            const dayOfWeek = new Date(b.timestamp).getDay();
            // Only include weekdays (Mon=1 to Fri=5)
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
              const day = daysOfWeek[dayOfWeek - 1];
              if (students.includes(b.studentName)) {
                dayData[day][b.studentName]++;
              }
              dayData[day]['í•™ê¸‰ í•©ê³„']++;
            }
          });

          labels = daysOfWeek;

          // Add datasets based on filter selection
          if (behaviorFilter.student === 'ALL') {
            // Show all individual students only
            students.forEach(student => {
              datasets.push({
                label: student,
                data: labels.map(label => dayData[label][student]),
                borderColor: studentColors[student],
                backgroundColor: 'transparent',
                tension: 0.4,
                borderWidth: 2,
              });
            });
          } else if (behaviorFilter.student === 'CLASS_TOTAL') {
            // Show only class total
            datasets.push({
              label: 'í•™ê¸‰ í•©ê³„',
              data: labels.map(label => dayData[label]['í•™ê¸‰ í•©ê³„']),
              borderColor: studentColors['í•™ê¸‰ í•©ê³„'],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 3,
            });
          } else {
            // Show specific student only
            const selectedStudent = behaviorFilter.student;
            datasets.push({
              label: selectedStudent,
              data: labels.map(label => dayData[label][selectedStudent] || 0),
              borderColor: studentColors[selectedStudent],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 2,
            });
          }

        } else if (behaviorFilter.chartType === 'period') {
          // Period distribution (êµì‹œë³„ - periods 1-7 only)
          const periods = ['1êµì‹œ', '2êµì‹œ', '3êµì‹œ', '4êµì‹œ', '5êµì‹œ', '6êµì‹œ', '7êµì‹œ'];
          const periodData = {};
          periods.forEach(period => {
            periodData[period] = {};
            students.forEach(s => periodData[period][s] = 0);
            periodData[period]['í•™ê¸‰ í•©ê³„'] = 0;
          });

          filteredData.forEach(b => {
            const hour = new Date(b.timestamp).getHours();
            let period = null;
            if (hour >= 9 && hour < 10) period = '1êµì‹œ';
            else if (hour >= 10 && hour < 11) period = '2êµì‹œ';
            else if (hour >= 11 && hour < 12) period = '3êµì‹œ';
            else if (hour >= 12 && hour < 13) period = '4êµì‹œ';
            else if (hour >= 13 && hour < 14) period = '5êµì‹œ';
            else if (hour >= 14 && hour < 15) period = '6êµì‹œ';
            else if (hour >= 15 && hour < 16) period = '7êµì‹œ';

            if (period && periodData[period]) {
              if (students.includes(b.studentName)) {
                periodData[period][b.studentName]++;
              }
              periodData[period]['í•™ê¸‰ í•©ê³„']++;
            }
          });

          labels = periods;

          // Add datasets based on filter selection
          if (behaviorFilter.student === 'ALL') {
            // Show all individual students only
            students.forEach(student => {
              datasets.push({
                label: student,
                data: labels.map(label => periodData[label][student]),
                borderColor: studentColors[student],
                backgroundColor: 'transparent',
                tension: 0.4,
                borderWidth: 2,
              });
            });
          } else if (behaviorFilter.student === 'CLASS_TOTAL') {
            // Show only class total
            datasets.push({
              label: 'í•™ê¸‰ í•©ê³„',
              data: labels.map(label => periodData[label]['í•™ê¸‰ í•©ê³„']),
              borderColor: studentColors['í•™ê¸‰ í•©ê³„'],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 3,
            });
          } else {
            // Show specific student only
            const selectedStudent = behaviorFilter.student;
            datasets.push({
              label: selectedStudent,
              data: labels.map(label => periodData[label][selectedStudent] || 0),
              borderColor: studentColors[selectedStudent],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 2,
            });
          }

        } else if (behaviorFilter.chartType === 'weeklyGoalAchievement') {
          // Weekly goal achievement (scores 3, 4, 5)
          const weeklyData = {};
          const weekCount = behaviorFilter.dateRange === 'march1'
            ? Math.ceil((now - startDate) / (7 * 24 * 60 * 60 * 1000))
            : Math.ceil(behaviorFilter.dateRange / 7);

          for (let i = 0; i < weekCount; i++) {
            const weekStart = new Date(now - i * 7 * 24 * 60 * 60 * 1000);
            const weekLabel = `${weekStart.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}ì£¼`;
            weeklyData[weekLabel] = {};
            students.forEach(s => weeklyData[weekLabel][s] = 0);
            weeklyData[weekLabel]['í•™ê¸‰ í•©ê³„'] = 0;
          }

          // Count student evaluations with scores 3, 4, 5
          Object.entries(state.studentEvals).forEach(([key, evalData]) => {
            if (evalData.score >= 3 && evalData.score <= 5 && evalData.timestamp >= startDate) {
              const weekStart = new Date(evalData.timestamp);
              weekStart.setDate(weekStart.getDate() - weekStart.getDay());
              const weekLabel = `${weekStart.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}ì£¼`;

              if (weeklyData[weekLabel]) {
                const studentId = key.split('-')[1];
                if (students.includes(studentId)) {
                  weeklyData[weekLabel][studentId]++;
                }
                weeklyData[weekLabel]['í•™ê¸‰ í•©ê³„']++;
              }
            }
          });

          labels = Object.keys(weeklyData).reverse();

          // Add datasets based on filter selection
          if (behaviorFilter.student === 'ALL') {
            // Show all individual students only
            students.forEach(student => {
              datasets.push({
                label: student,
                data: labels.map(label => weeklyData[label][student]),
                borderColor: studentColors[student],
                backgroundColor: 'transparent',
                tension: 0.4,
                borderWidth: 2,
              });
            });
          } else if (behaviorFilter.student === 'CLASS_TOTAL') {
            // Show only class total
            datasets.push({
              label: 'í•™ê¸‰ í•©ê³„',
              data: labels.map(label => weeklyData[label]['í•™ê¸‰ í•©ê³„']),
              borderColor: studentColors['í•™ê¸‰ í•©ê³„'],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 3,
            });
          } else {
            // Show specific student only
            const selectedStudent = behaviorFilter.student;
            datasets.push({
              label: selectedStudent,
              data: labels.map(label => weeklyData[label][selectedStudent] || 0),
              borderColor: studentColors[selectedStudent],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 2,
            });
          }

        } else if (behaviorFilter.chartType === 'weeklyEvalFreq') {
          // Weekly evaluation frequency (scores 1-5, excluding 0)
          const weeklyData = {};
          const weekCount = behaviorFilter.dateRange === 'march1'
            ? Math.ceil((now - startDate) / (7 * 24 * 60 * 60 * 1000))
            : Math.ceil(behaviorFilter.dateRange / 7);

          for (let i = 0; i < weekCount; i++) {
            const weekStart = new Date(now - i * 7 * 24 * 60 * 60 * 1000);
            const weekLabel = `${weekStart.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}ì£¼`;
            weeklyData[weekLabel] = {};
            students.forEach(s => weeklyData[weekLabel][s] = 0);
            weeklyData[weekLabel]['í•™ê¸‰ í•©ê³„'] = 0;
          }

          // Count student evaluations with scores 1-5 (excluding 0)
          Object.entries(state.studentEvals).forEach(([key, evalData]) => {
            if (evalData.score >= 1 && evalData.score <= 5 && evalData.timestamp >= startDate) {
              const weekStart = new Date(evalData.timestamp);
              weekStart.setDate(weekStart.getDate() - weekStart.getDay());
              const weekLabel = `${weekStart.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}ì£¼`;

              if (weeklyData[weekLabel]) {
                const studentId = key.split('-')[1];
                if (students.includes(studentId)) {
                  weeklyData[weekLabel][studentId]++;
                }
                weeklyData[weekLabel]['í•™ê¸‰ í•©ê³„']++;
              }
            }
          });

          labels = Object.keys(weeklyData).reverse();

          // Add datasets based on filter selection
          if (behaviorFilter.student === 'ALL') {
            // Show all individual students only
            students.forEach(student => {
              datasets.push({
                label: student,
                data: labels.map(label => weeklyData[label][student]),
                borderColor: studentColors[student],
                backgroundColor: 'transparent',
                tension: 0.4,
                borderWidth: 2,
              });
            });
          } else if (behaviorFilter.student === 'CLASS_TOTAL') {
            // Show only class total
            datasets.push({
              label: 'í•™ê¸‰ í•©ê³„',
              data: labels.map(label => weeklyData[label]['í•™ê¸‰ í•©ê³„']),
              borderColor: studentColors['í•™ê¸‰ í•©ê³„'],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 3,
            });
          } else {
            // Show specific student only
            const selectedStudent = behaviorFilter.student;
            datasets.push({
              label: selectedStudent,
              data: labels.map(label => weeklyData[label][selectedStudent] || 0),
              borderColor: studentColors[selectedStudent],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 2,
            });
          }

        } else if (behaviorFilter.chartType === 'dailyEvalFreq') {
          // Daily evaluation frequency (scores 1-5, excluding 0)
          const dailyData = {};
          const dayCount = behaviorFilter.dateRange === 'march1'
            ? Math.ceil((now - startDate) / (24 * 60 * 60 * 1000))
            : behaviorFilter.dateRange;

          for (let i = 0; i < dayCount; i++) {
            const date = new Date(now - i * 24 * 60 * 60 * 1000);
            const dateStr = date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
            dailyData[dateStr] = {};
            students.forEach(s => dailyData[dateStr][s] = 0);
            dailyData[dateStr]['í•™ê¸‰ í•©ê³„'] = 0;
          }

          // Count student evaluations with scores 1-5 (excluding 0)
          Object.entries(state.studentEvals).forEach(([key, evalData]) => {
            if (evalData.score >= 1 && evalData.score <= 5 && evalData.timestamp >= startDate) {
              const dateStr = new Date(evalData.timestamp).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });

              if (dailyData[dateStr]) {
                const studentId = key.split('-')[1];
                if (students.includes(studentId)) {
                  dailyData[dateStr][studentId]++;
                }
                dailyData[dateStr]['í•™ê¸‰ í•©ê³„']++;
              }
            }
          });

          labels = Object.keys(dailyData).reverse();

          // Add datasets based on filter selection
          if (behaviorFilter.student === 'ALL') {
            // Show all individual students only
            students.forEach(student => {
              datasets.push({
                label: student,
                data: labels.map(label => dailyData[label][student]),
                borderColor: studentColors[student],
                backgroundColor: 'transparent',
                tension: 0.4,
                borderWidth: 2,
              });
            });
          } else if (behaviorFilter.student === 'CLASS_TOTAL') {
            // Show only class total
            datasets.push({
              label: 'í•™ê¸‰ í•©ê³„',
              data: labels.map(label => dailyData[label]['í•™ê¸‰ í•©ê³„']),
              borderColor: studentColors['í•™ê¸‰ í•©ê³„'],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 3,
            });
          } else {
            // Show specific student only
            const selectedStudent = behaviorFilter.student;
            datasets.push({
              label: selectedStudent,
              data: labels.map(label => dailyData[label][selectedStudent] || 0),
              borderColor: studentColors[selectedStudent],
              backgroundColor: 'transparent',
              tension: 0.4,
              borderWidth: 2,
            });
          }
        }

        // Create or update chart
        if (lineChartRef.current) {
          lineChartRef.current.destroy();
        }
        lineChartRef.current = new Chart(canvas, {
          type: 'line',
          data: {
            labels: labels,
            datasets: datasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 300 },
            interaction: { mode: 'nearest', intersect: false },
            elements: {
              point: {
                radius: 3,
                hoverRadius: 5,
                hitRadius: 10,
              }
            },
            plugins: {
              legend: {
                labels: { color: 'white', font: { size: 11 } },
                position: 'top',
              }
            },
            scales: {
              y: {
                ticks: { color: 'white', stepSize: 1 },
                grid: { color: 'rgba(255,255,255,0.1)' },
                beginAtZero: true
              },
              x: {
                ticks: { color: 'white', font: { size: 10 } },
                grid: { color: 'rgba(255,255,255,0.1)' }
              }
            }
          }
        });
      }, [view, state.behaviorLog, behaviorFilter]);

      // ê²€ìƒ‰ ê¸°ë¡ ì €ì¥
      const saveSearchHistory = (query) => {
        if (!query.trim()) return;
        setState(p => ({
          ...p,
          recentSearches: [query, ...p.recentSearches.filter(s => s !== query)].slice(0, 10)
        }));
      };

      // ì¶œë°œ ì•ŒëŒ í•¸ë“¤ëŸ¬ (ìˆ˜ì •: ì œëŒ€ë¡œ ìš¸ë¦¬ë„ë¡)
      const handleScheduleAlert = useCallback((scheduleId) => {
        // setState í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì‹  stateì— ì ‘ê·¼í•˜ê³  stale closure ë°©ì§€
        setState(prevState => {
          // ì´ë¯¸ ì•Œë¦¼ì„ ë³´ë‚¸ ê²½ìš° ìƒíƒœ ë³€ê²½ ì—†ì´ ë¦¬í„´
          if (prevState.alertedSchedules[scheduleId]) {
            return prevState;
          }

          // ìµœì‹  stateì—ì„œ ìŠ¤ì¼€ì¤„ ì°¾ê¸°
          const schedule = prevState.schedules.find(s => s.id === scheduleId);
          if (!schedule) {
            return prevState;
          }

          // ì•Œë¦¼ í‘œì‹œ
          showNotification(
            'ğŸš— ì¶œë°œ ì‹œê°„ì…ë‹ˆë‹¤!',
            `${schedule.name} - ì§€ê¸ˆ ë°”ë¡œ ì¶œë°œí•˜ì„¸ìš”!`,
            { tag: scheduleId, requireInteraction: true }
          );

          setShowAlert({
            title: 'ğŸš— ì¶œë°œ ì‹œê°„!',
            message: `${schedule.name}\nì§€ê¸ˆ ì¶œë°œí•˜ì„¸ìš”!`,
            schedule: schedule
          });

          // 5ì´ˆ í›„ ì•Œë¦¼ ë°°ë„ˆ ìë™ ì œê±°
          setTimeout(() => setShowAlert(null), 5000);

          // ì•Œë¦¼ ìƒíƒœ ì—…ë°ì´íŠ¸
          return {
            ...prevState,
            alertedSchedules: { ...prevState.alertedSchedules, [scheduleId]: true },
          };
        });
      }, []); // ë¹ˆ ì˜ì¡´ì„± ë°°ì—´ë¡œ í•¨ìˆ˜ ì¬ìƒì„± ë°©ì§€, setState í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¡œ ìµœì‹  state ë³´ì¥

      // ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€
      const toggleCollapse = (id) => {
        setState(p => ({
          ...p,
          collapsedItems: {
            ...p.collapsedItems,
            [id]: !p.collapsedItems[id],
          },
        }));
      };

      // ê³¼ì œ ì¶”ê°€
      const addTask = () => {
        const newTask = {
          id: uuid(),
          title: 'ìƒˆ ê³¼ì œ',
          category: 'TEACHING',
          priority: 'MEDIUM',
          progress: 0,
          steps: [],
          tags: [],
          createdAt: nowMs(),
          deadline: null, // ë§ˆê°ì¼ì‹œ
          description: '', // ì„¤ëª…
          assignee: '', // ë‹´ë‹¹ì
        };
        setState(p => ({ ...p, tasks: [...p.tasks, newTask] }));
      };

      // ê³¼ì œ ì‚­ì œ
      const deleteTask = (taskId) => {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setState(p => ({ ...p, tasks: p.tasks.filter(t => t.id !== taskId) }));
        }
      };

      // ê³¼ì œ ìˆ˜ì •
      const updateTask = (taskId, updates) => {
        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => t.id === taskId ? { ...t, ...updates } : t)
        }));
      };

      // ì„¸ë¶€ ë‹¨ê³„ í† ê¸€
      const toggleStep = (taskId, stepId) => {
        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== taskId) return t;
            return {
              ...t,
              steps: t.steps.map(s => s.id === stepId ? { ...s, done: !s.done } : s)
            };
          })
        }));
      };

      // ì„¸ë¶€ ë‹¨ê³„ ì¶”ê°€
      const addStep = (taskId) => {
        const stepText = prompt('ì„¸ë¶€ ë‹¨ê³„ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        if (!stepText) return;

        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== taskId) return t;
            return {
              ...t,
              steps: [...(t.steps || []), { id: uuid(), text: stepText, done: false }]
            };
          })
        }));
      };

      // ì„¸ë¶€ ë‹¨ê³„ ìˆ˜ì •
      const editStep = (taskId, stepId) => {
        const task = state.tasks.find(t => t.id === taskId);
        if (!task) return;
        const step = task.steps.find(s => s.id === stepId);
        if (!step) return;

        const newText = prompt('ì„¸ë¶€ ë‹¨ê³„ ìˆ˜ì •:', step.text);
        if (!newText || newText === step.text) return;

        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== taskId) return t;
            return {
              ...t,
              steps: t.steps.map(s => s.id === stepId ? { ...s, text: newText } : s)
            };
          })
        }));
      };

      // ì„¸ë¶€ ë‹¨ê³„ ì‚­ì œ
      const deleteStep = (taskId, stepId) => {
        if (!confirm('ì´ ë‹¨ê³„ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== taskId) return t;
            return {
              ...t,
              steps: t.steps.filter(s => s.id !== stepId)
            };
          })
        }));
      };

      // ì„¸ë¶€ ë‹¨ê³„ ìœ„ë¡œ ì´ë™
      const moveStepUp = (taskId, stepId) => {
        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== taskId) return t;
            const idx = t.steps.findIndex(s => s.id === stepId);
            if (idx <= 0) return t;
            const newSteps = [...t.steps];
            [newSteps[idx - 1], newSteps[idx]] = [newSteps[idx], newSteps[idx - 1]];
            return { ...t, steps: newSteps };
          })
        }));
      };

      // ì„¸ë¶€ ë‹¨ê³„ ì•„ë˜ë¡œ ì´ë™
      const moveStepDown = (taskId, stepId) => {
        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== taskId) return t;
            const idx = t.steps.findIndex(s => s.id === stepId);
            if (idx < 0 || idx >= t.steps.length - 1) return t;
            const newSteps = [...t.steps];
            [newSteps[idx], newSteps[idx + 1]] = [newSteps[idx + 1], newSteps[idx]];
            return { ...t, steps: newSteps };
          })
        }));
      };

      // ê³¼ì œ ì™„ë£Œ ì‹œ í¬ì¸íŠ¸ ì§€ê¸‰ (ë§ˆê°ì¼ ì „ ì™„ë£Œ ì‹œ 100ì )
      const completeTask = (taskId) => {
        const task = state.tasks.find(t => t.id === taskId);
        if (!task) return;

        const autoProgress = calculateAutoProgress(task);
        if (autoProgress === 100) {
          const isBeforeDeadline = task.deadline && nowMs() < task.deadline;
          if (isBeforeDeadline) {
            setState(p => ({
              ...p,
              points: p.points + 100,
            }));
            alert('ğŸ‰ ë§ˆê°ì¼ ì „ ê³¼ì œ ì™„ë£Œ! +100ì  íšë“!');
          }
        }
      };

      // ìˆ˜ì—… ì¶”ê°€/ìˆ˜ì •
      const saveLesson = (lesson) => {
        if (lesson.id) {
          // ìˆ˜ì •
          setState(p => ({
            ...p,
            lessons: p.lessons.map(l => l.id === lesson.id ? { ...lesson } : l)
          }));
        } else {
          // ì¶”ê°€
          if (lesson.repeatWeekly && (!lesson.date || !lesson.repeatUntil)) {
            alert('ë°˜ë³µ ìˆ˜ì—…ì€ ë‚ ì§œì™€ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
          }
          const baseLesson = {
            ...lesson,
            date: lesson.date ? new Date(lesson.date).getTime() : null,
            dayOfWeek: lesson.date ? getDayLabel(lesson.date) : lesson.dayOfWeek,
          };
          if (lesson.repeatWeekly && lesson.repeatUntil && baseLesson.date) {
            const repeatUntil = new Date(lesson.repeatUntil).getTime();
            const newLessons = [];
            let cursor = baseLesson.date;
            while (cursor <= repeatUntil) {
              newLessons.push({
                ...baseLesson,
                id: uuid(),
                date: cursor,
                dayOfWeek: getDayLabel(cursor),
              });
              cursor += 7 * 24 * 60 * 60 * 1000;
            }
            setState(p => ({
              ...p,
              lessons: [...p.lessons, ...newLessons],
            }));
          } else {
            setState(p => ({
              ...p,
              lessons: [...p.lessons, { ...baseLesson, id: uuid() }]
            }));
          }
        }
        setEditingLesson(null);
      };

      // ìˆ˜ì—… ì‚­ì œ
      const deleteLesson = (lessonId) => {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setState(p => ({
            ...p,
            lessons: p.lessons.filter(l => l.id !== lessonId),
            studentEvals: Object.fromEntries(
              Object.entries(p.studentEvals).filter(([key]) => !key.startsWith(lessonId))
            )
          }));
        }
      };

      // í•™ìƒ í‰ê°€ ì €ì¥
      const saveStudentEval = (lessonId, studentId, score, memo = '') => {
        setState(p => ({
          ...p,
          studentEvals: {
            ...p.studentEvals,
            [`${lessonId}-${studentId}`]: { score, memo, updatedAt: nowMs() }
          }
        }));
      };

      // ìˆ˜ì—… ë° í‰ê°€ í†µí•© CSV ë‚´ë³´ë‚´ê¸°
      const exportLessonsAndEvalsCSV = () => {
        // Enhanced CSV export for AI analysis with comprehensive data
        const headers = [
          'ID',
          'ë‚ ì§œ',
          'ISO_ë‚ ì§œ',
          'ìš”ì¼',
          'êµì‹œ',
          'ê³¼ëª©',
          'ì œì¬',
          'ëª©í‘œ',
          'í™œë™',
          'í•™ìƒ1_ì ìˆ˜',
          'í•™ìƒ1_í‰ê°€',
          'í•™ìƒ2_ì ìˆ˜',
          'í•™ìƒ2_í‰ê°€',
          'í•™ìƒ3_ì ìˆ˜',
          'í•™ìƒ3_í‰ê°€',
          'í•™ìƒ4_ì ìˆ˜',
          'í•™ìƒ4_í‰ê°€',
          'í•™ìƒ5_ì ìˆ˜',
          'í•™ìƒ5_í‰ê°€',
          'í•™ìƒ6_ì ìˆ˜',
          'í•™ìƒ6_í‰ê°€',
          'í•™ìƒ7_ì ìˆ˜',
          'í•™ìƒ7_í‰ê°€',
          'í‰ê· _ì ìˆ˜',
          'ëª©í‘œë‹¬ì„±_í•™ìƒìˆ˜_3ì ì´ìƒ',
          'ì „ì²´_í‰ê°€_í•™ìƒìˆ˜'
        ];
        const rows = [headers];

        state.lessons.forEach(lesson => {
          const scores = [];
          let totalScore = 0;
          let evaluatedCount = 0;
          let achievedCount = 0;

          // Collect student evaluation data
          for (let i = 1; i <= 7; i++) {
            const studentId = `í•™ìƒ${i}`;
            const evalKey = `${lesson.id}-${studentId}`;
            const evalData = state.studentEvals[evalKey];
            const score = evalData?.score;

            if (score !== undefined && score !== null) {
              scores.push(score);
              totalScore += score;
              evaluatedCount++;
              if (score >= 3) achievedCount++;
            }
          }

          const avgScore = evaluatedCount > 0 ? (totalScore / evaluatedCount).toFixed(2) : '';

          const row = [
            lesson.id,
            lesson.date ? new Date(lesson.date).toLocaleDateString('ko-KR') : '',
            lesson.date ? new Date(lesson.date).toISOString() : '',
            lesson.dayOfWeek || '',
            lesson.period || '',
            lesson.subject || '',
            lesson.topic || '',
            `"${(lesson.goal || '').replace(/"/g, '""')}"`,
            `"${(lesson.activity || '').replace(/"/g, '""')}"`,
          ];

          // Add student scores and labels
          for (let i = 1; i <= 7; i++) {
            const studentId = `í•™ìƒ${i}`;
            const evalKey = `${lesson.id}-${studentId}`;
            const evalData = state.studentEvals[evalKey];
            const score = evalData?.score;
            const label = score !== undefined && score !== null
              ? ['ê²°ì„', 'ë¯¸ì°¸ì—¬', 'ë¯¸ë„ë‹¬', 'ìµœëŒ€ì´‰êµ¬', 'ì¼ë¶€ì´‰êµ¬', 'ëª©í‘œë‹¬ì„±'][score]
              : '';

            row.push(score !== undefined && score !== null ? score : '');
            row.push(label);
          }

          row.push(avgScore);
          row.push(achievedCount);
          row.push(evaluatedCount);

          rows.push(row);
        });

        exportToCSV(rows, `ìˆ˜ì—…ë°í‰ê°€_AIë¶„ì„ìš©_${new Date().toISOString().slice(0,10)}.csv`);
      };

      // CSV ê°€ì ¸ì˜¤ê¸°
      const importLessonsCSV = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // íŒŒì¼ í¬ê¸° ê²€ì¦ (10MB ì œí•œ)
        if (file.size > 10 * 1024 * 1024) {
          alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 10MB ì´í•˜ì˜ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
          e.target.value = '';
          return;
        }

        const reader = new FileReader();

        reader.onload = (evt) => {
          try {
            const text = evt.target.result;

            if (!text || typeof text !== 'string') {
              throw new Error('íŒŒì¼ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            const rows = parseCSV(text);

            if (!Array.isArray(rows) || rows.length < 2) {
              alert('ì˜¬ë°”ë¥¸ CSV íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤. ìµœì†Œ 2ì¤„(í—¤ë” + ë°ì´í„°) ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤.');
              return;
            }

            const newLessons = [];
            const errors = [];

            for (let i = 1; i < rows.length; i++) {
              try {
                const [id, date, dayOfWeek, period, subject, topic, goal, activity] = rows[i];
                if (subject) {
                  newLessons.push({
                    id: id || uuid(),
                    date: date ? new Date(date).getTime() : null,
                    dayOfWeek,
                    period,
                    subject,
                    topic,
                    goal,
                    activity
                  });
                }
              } catch (rowError) {
                errors.push(`${i + 1}ë²ˆì§¸ í–‰ ì²˜ë¦¬ ì‹¤íŒ¨: ${rowError.message}`);
              }
            }

            if (errors.length > 0) {
              console.warn('CSV ê°€ì ¸ì˜¤ê¸° ì¤‘ ì¼ë¶€ ì˜¤ë¥˜ ë°œìƒ:', errors);
              if (!confirm(`${errors.length}ê°œì˜ í–‰ì„ ì²˜ë¦¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n${newLessons.length}ê°œì˜ ìˆ˜ì—…ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
              }
            }

            if (newLessons.length === 0) {
              alert('ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
              return;
            }

            if (confirm(`${newLessons.length}ê°œì˜ ìˆ˜ì—…ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
              setState(p => ({
                ...p,
                lessons: [...p.lessons, ...newLessons]
              }));
              alert(`${newLessons.length}ê°œì˜ ìˆ˜ì—…ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
            }
          } catch (error) {
            console.error('CSV íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
            alert(`CSV íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${error.message}\n\níŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
          }
        };

        reader.onerror = (error) => {
          console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
          alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. íŒŒì¼ì´ ì†ìƒë˜ì—ˆê±°ë‚˜ ì ‘ê·¼ ê¶Œí•œì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        };

        reader.onabort = () => {
          console.warn('íŒŒì¼ ì½ê¸°ê°€ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
          alert('íŒŒì¼ ì½ê¸°ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        };

        try {
          reader.readAsText(file, 'UTF-8');
        } catch (error) {
          console.error('FileReader ì‹œì‘ ì˜¤ë¥˜:', error);
          alert(`íŒŒì¼ ì½ê¸°ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:\n${error.message}`);
        }

        e.target.value = '';
      };

      // í–‰ë™ ë¡œê·¸ ì¶”ê°€/ìˆ˜ì •
      const saveBehaviorLog = (behaviorLog) => {
        if (behaviorLog.id) {
          // ìˆ˜ì •
          setState(p => ({
            ...p,
            behaviorLog: p.behaviorLog.map(b => b.id === behaviorLog.id ? behaviorLog : b)
          }));
        } else {
          // ì¶”ê°€
          setState(p => ({
            ...p,
            behaviorLog: [...p.behaviorLog, { ...behaviorLog, id: uuid(), timestamp: nowMs() }]
          }));
        }
        setEditingBehavior(null);
      };

      // í–‰ë™ ë¡œê·¸ ì‚­ì œ
      const deleteBehaviorLog = (logId) => {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setState(p => ({
            ...p,
            behaviorLog: p.behaviorLog.filter(b => b.id !== logId)
          }));
        }
      };

      // ì£¼ê°„ ìˆ˜ì—… ë³´ê³ ì„œ ìƒì„±
      const generateWeeklyLessonReport = () => {
        const now = Date.now();
        const weekAgo = now - 7 * 24 * 60 * 60 * 1000;
        const recentLessons = state.lessons.filter(l => l.date && l.date >= weekAgo);

        const headers = ['ì£¼ê°„ ìˆ˜ì—… ë³´ê³ ì„œ', '', '', ''];
        const rows = [
          headers,
          ['ë‚ ì§œ', 'ê³¼ëª©', 'ì œì¬', 'ëª©í‘œ'],
          ...recentLessons.map(l => [
            l.date ? new Date(l.date).toLocaleDateString('ko-KR') : '',
            l.subject || '',
            l.topic || '',
            l.goal || ''
          ])
        ];

        exportToCSV(rows, `ì£¼ê°„ìˆ˜ì—…ë³´ê³ ì„œ_${new Date().toISOString().slice(0,10)}.csv`);
      };

      // ì›”ê°„ í–‰ë™ ë³´ê³ ì„œ ìƒì„±
      const generateMonthlyBehaviorReport = () => {
        const now = Date.now();
        const monthAgo = now - 30 * 24 * 60 * 60 * 1000;
        const recentBehaviors = state.behaviorLog.filter(b => b.timestamp >= monthAgo);

        // í–‰ë™ ìœ í˜•ë³„ ì§‘ê³„
        const behaviorCounts = {};
        recentBehaviors.forEach(b => {
          const type = BEHAVIOR_TYPES[b.behaviorType]?.label || b.behaviorType;
          behaviorCounts[type] = (behaviorCounts[type] || 0) + 1;
        });

        const headers = ['ì›”ê°„ í–‰ë™ ë³´ê³ ì„œ', '', ''];
        const rows = [
          headers,
          ['ê¸°ê°„', `${new Date(monthAgo).toLocaleDateString('ko-KR')} ~ ${new Date(now).toLocaleDateString('ko-KR')}`, ''],
          ['ì´ ê¸°ë¡ ìˆ˜', recentBehaviors.length, ''],
          [],
          ['í–‰ë™ ìœ í˜•', 'ë°œìƒ íšŸìˆ˜', 'ë¹„ìœ¨(%)'],
          ...Object.entries(behaviorCounts).map(([type, count]) => [
            type,
            count,
            ((count / recentBehaviors.length) * 100).toFixed(1)
          ])
        ];

        exportToCSV(rows, `ì›”ê°„í–‰ë™ë³´ê³ ì„œ_${new Date().toISOString().slice(0,10)}.csv`);
      };

      // PDF ë³´ê³ ì„œ ìƒì„±
      const generatePDFReport = async (reportType) => {
        try {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // í•œê¸€ í°íŠ¸ ì„¤ì • (ê¸°ë³¸ í°íŠ¸ ì‚¬ìš©)
          doc.setFont('helvetica');

          let yPos = 20;

          if (reportType === 'weekly') {
            doc.setFontSize(18);
            doc.text('Weekly Lesson Report', 20, yPos);
            yPos += 15;

            doc.setFontSize(12);
            const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
            const recentLessons = state.lessons.filter(l => l.date && l.date >= weekAgo);

            doc.text(`Period: ${new Date(weekAgo).toLocaleDateString()} - ${new Date().toLocaleDateString()}`, 20, yPos);
            yPos += 10;
            doc.text(`Total Lessons: ${recentLessons.length}`, 20, yPos);
            yPos += 15;

            recentLessons.forEach(lesson => {
              if (yPos > 270) {
                doc.addPage();
                yPos = 20;
              }
              doc.text(`Subject: ${lesson.subject || ''}`, 20, yPos);
              yPos += 7;
              doc.text(`Topic: ${lesson.topic || ''}`, 20, yPos);
              yPos += 7;
              doc.text(`Goal: ${lesson.goal || ''}`, 20, yPos);
              yPos += 12;
            });
          } else if (reportType === 'monthly') {
            doc.setFontSize(18);
            doc.text('Monthly Behavior Report', 20, yPos);
            yPos += 15;

            doc.setFontSize(12);
            const monthAgo = Date.now() - 30 * 24 * 60 * 60 * 1000;
            const recentBehaviors = state.behaviorLog.filter(b => b.timestamp >= monthAgo);

            doc.text(`Period: ${new Date(monthAgo).toLocaleDateString()} - ${new Date().toLocaleDateString()}`, 20, yPos);
            yPos += 10;
            doc.text(`Total Incidents: ${recentBehaviors.length}`, 20, yPos);
            yPos += 15;

            const behaviorCounts = {};
            recentBehaviors.forEach(b => {
              const type = BEHAVIOR_TYPES[b.behaviorType]?.label || b.behaviorType;
              behaviorCounts[type] = (behaviorCounts[type] || 0) + 1;
            });

            Object.entries(behaviorCounts).forEach(([type, count]) => {
              if (yPos > 270) {
                doc.addPage();
                yPos = 20;
              }
              doc.text(`${type}: ${count} incidents (${((count/recentBehaviors.length)*100).toFixed(1)}%)`, 20, yPos);
              yPos += 10;
            });
          }

          doc.save(`${reportType}_report_${new Date().toISOString().slice(0,10)}.pdf`);
          alert('PDF ë³´ê³ ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } catch (error) {
          console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
          alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      };

      const styles = {
        container: {
          minHeight: '100vh',
        },
        card: {
          background: 'rgba(30, 41, 59, 0.4)',
          backdropFilter: 'blur(20px)',
          borderRadius: 20,
          padding: 24,
          marginBottom: 20,
          border: '1px solid rgba(255, 255, 255, 0.1)',
          boxShadow: '0 8px 32px rgba(0, 0, 0, 0.4)',
        },
        h1: {
          fontWeight: 900,
          background: 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)',
          WebkitBackgroundClip: 'text',
          WebkitTextFillColor: 'transparent',
          margin: '0 0 12px 0',
          textAlign: 'center',
        },
        h2: {
          fontSize: 22,
          fontWeight: 800,
          color: 'white',
          margin: '0 0 16px 0',
          display: 'flex',
          alignItems: 'center',
          gap: 8,
        },
        btn: {
          padding: '12px 20px',
          background: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)',
          border: 'none',
          borderRadius: 10,
          color: 'white',
          fontSize: 14,
          fontWeight: 700,
          cursor: 'pointer',
          transition: 'all 0.3s',
          boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)',
        },
        btn2: {
          padding: '10px 16px',
          background: 'rgba(255, 255, 255, 0.1)',
          border: '1px solid rgba(255, 255, 255, 0.2)',
          borderRadius: 8,
          color: 'white',
          fontSize: 13,
          fontWeight: 600,
          cursor: 'pointer',
          transition: 'all 0.2s',
        },
        nav: {
          display: 'grid',
          gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))',
          gap: 10,
          marginBottom: 20,
        },
        navBtn: {
          padding: 14,
          background: 'rgba(255, 255, 255, 0.05)',
          border: '1px solid rgba(255, 255, 255, 0.1)',
          borderRadius: 12,
          color: 'white',
          fontSize: 13,
          fontWeight: 700,
          cursor: 'pointer',
          transition: 'all 0.2s',
          textAlign: 'center',
        },
      };

      const filteredTasks = useMemo(() => {
        const filtered = state.tasks.filter(t => {
          if (state.filters.category !== 'ALL' && t.category !== state.filters.category) return false;
          if (state.filters.priority !== 'ALL' && t.priority !== state.filters.priority) return false;
          if (state.filters.searchText) {
            const search = state.filters.searchText.toLowerCase();
            if (!t.title.toLowerCase().includes(search) &&
                !(t.tags || []).some(tag => tag.toLowerCase().includes(search))) {
              return false;
            }
          }
          return true;
        });

        // ì •ë ¬
        const sorted = [...filtered];
        switch (state.taskSortBy) {
          case 'deadline':
            sorted.sort((a, b) => {
              if (!a.deadline && !b.deadline) return 0;
              if (!a.deadline) return 1;
              if (!b.deadline) return -1;
              return a.deadline - b.deadline;
            });
            break;
          case 'priority':
            sorted.sort((a, b) => {
              const aPri = PRIORITIES[a.priority]?.value || 0;
              const bPri = PRIORITIES[b.priority]?.value || 0;
              return bPri - aPri;
            });
            break;
          case 'name':
            sorted.sort((a, b) => a.title.localeCompare(b.title));
            break;
          case 'createdAt':
            sorted.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
            break;
          default:
            break;
        }
        return sorted;
      }, [state.tasks, state.filters, state.taskSortBy]);

      const stats = useMemo(() => {
        const total = state.tasks.length;
        const completed = state.tasks.filter(t => calculateAutoProgress(t) === 100).length;
        const urgent = state.tasks.filter(t => t.priority === 'URGENT').length;
        const avgProgress = total > 0 ? state.tasks.reduce((sum, t) => sum + calculateAutoProgress(t), 0) / total : 0;
        const level = Math.floor(state.points / 100) + 1;
        
        return { total, completed, urgent, points: state.points, level, avgProgress };
      }, [state.tasks, state.points]);

      const behaviorStudents = useMemo(() => {
        return Array.from(new Set(state.behaviorLog.map(b => b.studentName).filter(Boolean))).sort();
      }, [state.behaviorLog]);

      const filteredBehaviorLog = useMemo(() => {
        const now = Date.now();
        let startDate;
        if (behaviorFilter.dateRange === 'march1') {
          const march1 = new Date(new Date().getFullYear(), 2, 1);
          startDate = march1.getTime();
        } else {
          const rangeMs = behaviorFilter.dateRange * 24 * 60 * 60 * 1000;
          startDate = now - rangeMs;
        }
        return state.behaviorLog.filter(b => {
          if (b.timestamp < startDate) return false;
          // Don't filter by student for ALL or CLASS_TOTAL - show all data
          if (behaviorFilter.student !== 'ALL' && behaviorFilter.student !== 'CLASS_TOTAL' && b.studentName !== behaviorFilter.student) return false;
          return true;
        });
      }, [state.behaviorLog, behaviorFilter]);

      const lessonWeekDates = useMemo(() => {
        return Array.from({ length: 5 }, (_, i) => addDays(lessonWeekStart, i));
      }, [lessonWeekStart]);

      const behaviorWeekDates = useMemo(() => {
        return Array.from({ length: 5 }, (_, i) => addDays(behaviorWeekStart, i));
      }, [behaviorWeekStart]);

      const weeklyBehaviorLogs = useMemo(() => {
        const start = new Date(behaviorWeekStart);
        const end = addDays(start, 5);
        return state.behaviorLog.filter(log => {
          if (!log.timestamp) return false;
          if (behaviorWeekStudent !== 'ALL' && log.studentName !== behaviorWeekStudent) return false;
          const ts = new Date(log.timestamp);
          return ts >= start && ts < end;
        });
      }, [state.behaviorLog, behaviorWeekStart, behaviorWeekStudent]);

      const focusStatus = useMemo(() => {
        const focus = state.focus;
        if (!focus.startedTs) {
          return {
            remainingMs: focus.durationSec * 1000,
            elapsedMs: 0,
          };
        }
        const now = nowMs();
        const elapsed = focus.paused
          ? focus.elapsedBeforePause
          : focus.elapsedBeforePause + (now - focus.startedTs);
        const remaining = Math.max(0, focus.durationSec * 1000 - elapsed);
        return {
          remainingMs: remaining,
          elapsedMs: elapsed,
        };
      }, [state.focus, tick]);

      useEffect(() => {
        if (!state.focus.running || state.focus.paused) return;
        if (focusStatus.remainingMs > 0) return;

        // Timer completed - show success/failure selection
        setShowFocusComplete(true);

        // Stop the timer
        setState(p => ({
          ...p,
          focus: {
            ...p.focus,
            running: false,
            paused: false,
          },
        }));
      }, [focusStatus.remainingMs, state.focus.running, state.focus.paused]);

      const startFocus = () => {
        setState(p => ({
          ...p,
          focus: {
            ...p.focus,
            running: true,
            paused: false,
            durationSec: focusDraft.durationMin * 60,
            startedTs: nowMs(),
            pausedAt: null,
            elapsedBeforePause: 0,
            note: focusDraft.note,
          },
        }));
      };

      const pauseFocus = () => {
        setState(p => ({
          ...p,
          focus: {
            ...p.focus,
            paused: true,
            pausedAt: nowMs(),
            elapsedBeforePause: focusStatus.elapsedMs,
          },
        }));
      };

      const resumeFocus = () => {
        setState(p => ({
          ...p,
          focus: {
            ...p.focus,
            paused: false,
            startedTs: nowMs(),
            pausedAt: null,
          },
        }));
      };

      const resetFocus = () => {
        setState(p => ({
          ...p,
          focus: {
            ...p.focus,
            running: false,
            paused: false,
            startedTs: null,
            pausedAt: null,
            elapsedBeforePause: 0,
          },
        }));
      };

      const editFocusHistory = (id) => {
        const record = state.focusHistory.find(r => r.id === id);
        if (record) {
          setEditingFocusHistory({
            ...record,
            durationMin: Math.round(record.duration / 60),
          });
        }
      };

      const saveFocusHistory = () => {
        if (!editingFocusHistory) return;
        setState(p => ({
          ...p,
          focusHistory: p.focusHistory.map(r =>
            r.id === editingFocusHistory.id
              ? {
                  ...r,
                  note: editingFocusHistory.note,
                  duration: editingFocusHistory.durationMin * 60,
                }
              : r
          ),
        }));
        setEditingFocusHistory(null);
        setShowAlert({ title: 'âœ… ìˆ˜ì • ì™„ë£Œ', message: 'ì§‘ì¤‘ ê¸°ë¡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' });
        setTimeout(() => setShowAlert(null), 3000);
      };

      const deleteFocusHistory = (id) => {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        setState(p => ({
          ...p,
          focusHistory: p.focusHistory.filter(r => r.id !== id),
        }));
        setShowAlert({ title: 'ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ', message: 'ì§‘ì¤‘ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.' });
        setTimeout(() => setShowAlert(null), 3000);
      };

      const completeFocusSession = (success) => {
        // Save focus session to history
        const focusRecord = {
          id: Date.now(),
          startTime: state.focus.startedTs,
          duration: state.focus.durationSec,
          completedAt: nowMs(),
          note: state.focus.note || '',
          taskId: state.focus.taskId || null,
          success: success,
        };

        setState(p => ({
          ...p,
          points: success ? p.points + 100 : p.points,
          focusHistory: [focusRecord, ...(p.focusHistory || [])],
          focus: {
            ...p.focus,
            startedTs: null,
            pausedAt: null,
            elapsedBeforePause: 0,
          },
        }));

        setShowFocusComplete(false);

        if (success) {
          setShowAlert({ title: 'âœ… ì§‘ì¤‘ ì„±ê³µ!', message: 'ì§‘ì¤‘ ì‹œê°„ì„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‰ +100 í¬ì¸íŠ¸' });
        } else {
          setShowAlert({ title: 'ğŸ’ª ë‹¤ìŒì—” ì„±ê³µ!', message: 'ì§‘ì¤‘ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒë²ˆì—” ì„±ê³µí•´ë´ìš”!' });
        }
        setTimeout(() => setShowAlert(null), 4000);
      };

      const addSchedule = () => {
        if (!scheduleDraft.name || !scheduleDraft.arrivalTs) {
          alert('ì¼ì • ì´ë¦„ê³¼ ë„ì°© ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        const arrival = fromLocalDatetimeValue(scheduleDraft.arrivalTs);
        if (!arrival) {
          alert('ì˜¬ë°”ë¥¸ ë„ì°© ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        setState(p => ({
          ...p,
          schedules: [
            ...p.schedules,
            {
              id: uuid(),
              name: scheduleDraft.name,
              arrivalTs: arrival,
              departBeforeMin: parseInt(scheduleDraft.departBeforeMin) || 0,
              location: scheduleDraft.location,
              note: scheduleDraft.note,
            }
          ]
        }));
        setScheduleDraft({ name: '', arrivalTs: '', departBeforeMin: 30, location: '', note: '' });
      };

      const deleteSchedule = (scheduleId) => {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        setState(p => ({
          ...p,
          schedules: p.schedules.filter(s => s.id !== scheduleId),
        }));
      };

      const completeScheduleArrival = (schedule) => {
        const now = nowMs();
        const departTime = schedule.arrivalTs - (schedule.departBeforeMin * 60 * 1000);
        const onTime = now <= schedule.arrivalTs;
        const points = onTime ? 100 : 0;

        const historyRecord = {
          id: Date.now(),
          scheduleId: schedule.id,
          scheduleName: schedule.name,
          arrivalTime: now,
          plannedArrivalTime: schedule.arrivalTs,
          onTime: onTime,
          points: points,
          location: schedule.location || '',
        };

        setState(p => ({
          ...p,
          points: p.points + points,
          scheduleHistory: [historyRecord, ...(p.scheduleHistory || [])],
        }));

        if (onTime) {
          setShowAlert({ title: 'âœ… ì •ì‹œ ë„ì°©!', message: `${schedule.name}ì— ì •ì‹œ ë„ì°©í–ˆìŠµë‹ˆë‹¤! ğŸ‰ +100 í¬ì¸íŠ¸` });
        } else {
          const lateMinutes = Math.round((now - schedule.arrivalTs) / 60000);
          setShowAlert({ title: 'â° ëŠ¦ì€ ë„ì°©', message: `${schedule.name}ì— ${lateMinutes}ë¶„ ëŠ¦ê²Œ ë„ì°©í–ˆìŠµë‹ˆë‹¤.` });
        }
        setTimeout(() => setShowAlert(null), 4000);
      };

      const editScheduleHistory = (id) => {
        const record = state.scheduleHistory.find(r => r.id === id);
        if (record) {
          setEditingScheduleHistory({
            ...record,
            arrivalTimeLocal: toLocalDatetimeValue(record.arrivalTime),
          });
        }
      };

      const saveScheduleHistory = () => {
        if (!editingScheduleHistory) return;
        const newArrivalTime = fromLocalDatetimeValue(editingScheduleHistory.arrivalTimeLocal);
        if (!newArrivalTime) {
          alert('ì˜¬ë°”ë¥¸ ë„ì°© ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        const onTime = newArrivalTime <= editingScheduleHistory.plannedArrivalTime;
        const oldPoints = editingScheduleHistory.points;
        const newPoints = onTime ? 100 : 0;
        const pointsDiff = newPoints - oldPoints;

        setState(p => ({
          ...p,
          points: p.points + pointsDiff,
          scheduleHistory: p.scheduleHistory.map(r =>
            r.id === editingScheduleHistory.id
              ? {
                  ...r,
                  arrivalTime: newArrivalTime,
                  onTime: onTime,
                  points: newPoints,
                }
              : r
          ),
        }));
        setEditingScheduleHistory(null);
        setShowAlert({ title: 'âœ… ìˆ˜ì • ì™„ë£Œ', message: 'ì¼ì • ê¸°ë¡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' });
        setTimeout(() => setShowAlert(null), 3000);
      };

      const deleteScheduleHistory = (id) => {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        const record = state.scheduleHistory.find(r => r.id === id);
        if (record) {
          setState(p => ({
            ...p,
            points: Math.max(0, p.points - record.points),
            scheduleHistory: p.scheduleHistory.filter(r => r.id !== id),
          }));
          setShowAlert({ title: 'ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ', message: 'ì¼ì • ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.' });
          setTimeout(() => setShowAlert(null), 3000);
        }
      };

      return (
        <div style={styles.container} className="app-container">
          {/* ì•Œë¦¼ ë°°ë„ˆ */}
          {showAlert && (
            <div className="alert-banner">
              <div style={{ fontSize: 20, marginBottom: 8 }}>{showAlert.title}</div>
              <div style={{ fontSize: 14 }}>{showAlert.message}</div>
              <button
                style={{ marginTop: 10, padding: '6px 12px', background: 'white', color: '#ef4444', border: 'none', borderRadius: 6, cursor: 'pointer', fontWeight: 700 }}
                onClick={() => setShowAlert(null)}
              >
                í™•ì¸
              </button>
            </div>
          )}

          <h1 style={styles.h1} className="app-title">ğŸ¯ ADHD íŠ¹ìˆ˜êµì‚¬ í†µí•© ê´€ë¦¬ Pro v2.0</h1>
          
          <div style={{ display: 'flex', gap: 12, justifyContent: 'center', marginBottom: 20 }}>
            <div className="token-badge">
              ğŸ’ {state.points} í¬ì¸íŠ¸
            </div>
            <div className="level-badge">
              â­ Level {stats.level}
            </div>
          </div>

          {/* ê²€ìƒ‰ ë°” */}
          {showSearch && (
            <div className="search-container" style={{ position: 'relative', marginBottom: 20 }}>
              <input
                ref={searchInputRef}
                type="text"
                className="search-input"
                placeholder="ğŸ” ê²€ìƒ‰... (Ctrl/Cmd + K)"
                value={searchQuery}
                onChange={(e) => { setSearchQuery(e.target.value); saveSearchHistory(e.target.value); }}
              />
              {searchResults.length > 0 && (
                <div className="search-results">
                  {searchResults.map((result, idx) => (
                    <div
                      key={idx}
                      className="search-result-item"
                      onClick={result.action}
                    >
                      <div style={{ fontSize: 12, color: '#8b5cf6', fontWeight: 700, marginBottom: 4 }}>
                        {result.type}
                      </div>
                      <div style={{ fontSize: 14, color: 'white', fontWeight: 600, marginBottom: 2 }}>
                        {result.title}
                      </div>
                      <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)' }}>
                        {result.subtitle}
                      </div>
                    </div>
                  ))}
                </div>
              )}
              {state.recentSearches.length > 0 && searchQuery === '' && (
                <div className="search-results">
                  <div style={{ padding: '12px 16px', fontSize: 12, color: 'rgba(255,255,255,0.5)', fontWeight: 700 }}>
                    ìµœê·¼ ê²€ìƒ‰
                  </div>
                  {state.recentSearches.map((search, idx) => (
                    <div
                      key={idx}
                      className="search-result-item"
                      onClick={() => setSearchQuery(search)}
                    >
                      <div style={{ fontSize: 14, color: 'white' }}>
                        ğŸ•’ {search}
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}

          {/* í–„ë²„ê±° ë©”ë‰´ (ëª¨ë°”ì¼) */}
          <div className="hamburger-menu" onClick={() => setShowMobileMenu(true)}>
            <div className="hamburger-line"></div>
            <div className="hamburger-line"></div>
            <div className="hamburger-line"></div>
          </div>

          {/* ëª¨ë°”ì¼ ë©”ë‰´ ì˜¤ë²„ë ˆì´ */}
          {showMobileMenu && (
            <div className="mobile-nav-overlay">
              <div className="mobile-nav-close" onClick={() => setShowMobileMenu(false)}>âœ•</div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                {[
                  { key: 'dashboard', icon: 'ğŸ“Š', label: 'ëŒ€ì‹œë³´ë“œ' },
                  { key: 'tasks', icon: 'âœ…', label: 'ê³¼ì œ' },
                  { key: 'teaching', icon: 'ğŸ‘¨â€ğŸ«', label: 'ìˆ˜ì—…ê´€ë¦¬' },
                  { key: 'behaviorAnalytics', icon: 'ğŸ“ˆ', label: 'í–‰ë™ ê·¸ë˜í”„' },
                  { key: 'focus', icon: 'â±ï¸', label: 'ì§‘ì¤‘' },
                  { key: 'points', icon: 'ğŸª™', label: 'í¬ì¸íŠ¸' },
                  { key: 'schedule', icon: 'ğŸš—', label: 'ì¼ì •' },
                  { key: 'calendar', icon: 'ğŸ“…', label: 'ìº˜ë¦°ë”' },
                  { key: 'analytics', icon: 'ğŸ“ˆ', label: 'í†µê³„' },
                ].map(item => (
                  <button
                    key={item.key}
                    style={{
                      ...styles.navBtn,
                      padding: 20,
                      fontSize: 16,
                      background: view === item.key ? 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)' : styles.navBtn.background,
                      boxShadow: view === item.key ? '0 4px 12px rgba(99, 102, 241, 0.4)' : 'none',
                    }}
                    onClick={() => { setView(item.key); setShowMobileMenu(false); }}
                  >
                    {item.icon} {item.label}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* ë°ìŠ¤í¬í†± ë„¤ë¹„ê²Œì´ì…˜ */}
          <div style={styles.nav} className="desktop-nav">
            {[
              { key: 'dashboard', icon: 'ğŸ“Š', label: 'ëŒ€ì‹œë³´ë“œ' },
              { key: 'tasks', icon: 'âœ…', label: 'ê³¼ì œ' },
              { key: 'teaching', icon: 'ğŸ‘¨â€ğŸ«', label: 'ìˆ˜ì—…ê´€ë¦¬' },
              { key: 'behaviorAnalytics', icon: 'ğŸ“ˆ', label: 'í–‰ë™ ê·¸ë˜í”„' },
              { key: 'focus', icon: 'â±ï¸', label: 'ì§‘ì¤‘' },
              { key: 'points', icon: 'ğŸª™', label: 'í¬ì¸íŠ¸' },
              { key: 'schedule', icon: 'ğŸš—', label: 'ì¼ì •' },
              { key: 'calendar', icon: 'ğŸ“…', label: 'ìº˜ë¦°ë”' },
            ].map(item => (
              <button
                key={item.key}
                style={{
                  ...styles.navBtn,
                  background: view === item.key ? 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)' : styles.navBtn.background,
                  boxShadow: view === item.key ? '0 4px 12px rgba(99, 102, 241, 0.4)' : 'none',
                  transform: view === item.key ? 'scale(1.05)' : 'scale(1)',
                }}
                onClick={() => setView(item.key)}
              >
                {item.icon} {item.label}
              </button>
            ))}
            <button
              style={{
                ...styles.navBtn,
                background: showSearch ? 'rgba(59, 130, 246, 0.3)' : styles.navBtn.background,
              }}
              onClick={() => setShowSearch(!showSearch)}
            >
              ğŸ” ê²€ìƒ‰ (Ctrl+K)
            </button>
          </div>

          {/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (ëª¨ë°”ì¼) */}
          <div className="bottom-nav">
            <div className="bottom-nav-grid">
              {[
                { key: 'dashboard', icon: 'ğŸ“Š', label: 'í™ˆ' },
                { key: 'tasks', icon: 'âœ…', label: 'ê³¼ì œ' },
                { key: 'teaching', icon: 'ğŸ‘¨â€ğŸ«', label: 'ìˆ˜ì—…' },
                { key: 'schedule', icon: 'ğŸš—', label: 'ì¼ì •' },
              ].map(item => (
                <button
                  key={item.key}
                  className={`bottom-nav-btn ${view === item.key ? 'active' : ''}`}
                  onClick={() => setView(item.key)}
                >
                  <span>{item.icon}</span>
                  <div>{item.label}</div>
                </button>
              ))}
            </div>
          </div>

          {/* ëŒ€ì‹œë³´ë“œ */}
          {view === 'dashboard' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2} className="section-title">ğŸ“Š ëŒ€ì‹œë³´ë“œ</h2>
              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 24 }}>
                ì „ì²´ ì‹œìŠ¤í…œ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.
              </p>

              {/* ì£¼ìš” í†µê³„ */}
              <div style={{ marginBottom: 30 }}>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                  ğŸ“ˆ ì£¼ìš” í†µê³„
                </h3>
                <div className="stat-grid">
                  {[
                    { label: 'ë³´ìœ  í¬ì¸íŠ¸', value: ((state.points || 0).toLocaleString()) + 'P', icon: 'ğŸª™', color: '#fbbf24', onClick: () => setView('points') },
                    { label: 'ì „ì²´ ìˆ˜ì—…', value: (state.lessons || []).length, icon: 'ğŸ‘¨â€ğŸ«', color: '#8b5cf6', onClick: () => setView('teaching') },
                    { label: 'í–‰ë™ ê¸°ë¡', value: (state.behaviorLog || []).length, icon: 'ğŸ“‹', color: '#3b82f6', onClick: () => setView('behaviorAnalytics') },
                    { label: 'ì§‘ì¤‘ ì„¸ì…˜', value: (state.focusHistory || []).length, icon: 'â±ï¸', color: '#10b981', onClick: () => setView('focus') },
                    { label: 'ì „ì²´ ê³¼ì œ', value: stats.total || 0, icon: 'âœ…', color: '#6366f1', onClick: () => setView('tasks') },
                    { label: 'ì™„ë£Œ ê³¼ì œ', value: stats.completed || 0, icon: 'âœ”ï¸', color: '#22c55e', onClick: () => setView('tasks') },
                  ].map((stat, i) => (
                    <div
                      key={i}
                      className="stat-card"
                      style={{
                        padding: 20,
                        borderRadius: 12,
                        background: `linear-gradient(135deg, ${stat.color}20 0%, ${stat.color}10 100%)`,
                        border: `1px solid ${stat.color}40`,
                        textAlign: 'center',
                      }}
                      onClick={stat.onClick}
                    >
                      <div style={{ fontSize: 32, marginBottom: 8 }}>{stat.icon}</div>
                      <div style={{ fontSize: 28, fontWeight: 900, color: stat.color, marginBottom: 4 }}>
                        {stat.value}
                      </div>
                      <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)' }}>
                        {stat.label}
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* ë¹ ë¥¸ ì‹¤í–‰ */}
              <div style={{ marginBottom: 30 }}>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                  âš¡ ë¹ ë¥¸ ì‹¤í–‰
                </h3>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: 12 }}>
                  {[
                    { label: 'ìƒˆ ê³¼ì œ ì¶”ê°€', icon: 'â•', color: '#6366f1', onClick: () => { setView('tasks'); setTimeout(addTask, 100); } },
                    { label: 'ìˆ˜ì—… ì¶”ê°€', icon: 'ğŸ‘¨â€ğŸ«', color: '#8b5cf6', onClick: () => setView('teaching') },
                    { label: 'ì§‘ì¤‘ ì‹œì‘', icon: 'â±ï¸', color: '#10b981', onClick: () => { setView('focus'); } },
                    { label: 'ì¼ì • ì¶”ê°€', icon: 'ğŸš—', color: '#f59e0b', onClick: () => setView('schedule') },
                  ].map((action, i) => (
                    <button
                      key={i}
                      style={{
                        padding: '16px 12px',
                        borderRadius: 10,
                        background: `linear-gradient(135deg, ${action.color}30 0%, ${action.color}20 100%)`,
                        border: `1px solid ${action.color}50`,
                        color: 'white',
                        fontSize: 14,
                        fontWeight: 700,
                        cursor: 'pointer',
                        transition: 'all 0.2s',
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        gap: 8,
                      }}
                      onClick={action.onClick}
                    >
                      <span style={{ fontSize: 24 }}>{action.icon}</span>
                      <span>{action.label}</span>
                    </button>
                  ))}
                </div>
              </div>

              {/* ì˜¤ëŠ˜ì˜ ìˆ˜ì—… */}
              {(() => {
                if (!state.lessons || state.lessons.length === 0) return null;

                const today = new Date();
                const todayStr = today.toLocaleDateString('ko-KR');
                const todayLessons = state.lessons.filter(l => l && l.date && new Date(l.date).toLocaleDateString('ko-KR') === todayStr);

                return todayLessons.length > 0 && (
                  <div style={{ marginBottom: 30 }}>
                    <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                      ğŸ“š ì˜¤ëŠ˜ì˜ ìˆ˜ì—… ({todayLessons.length}ê°œ)
                    </h3>
                    <div style={{ display: 'grid', gap: 12 }}>
                      {todayLessons.slice(0, 5).map(lesson => (
                        <div
                          key={lesson.id}
                          style={{
                            padding: 16,
                            background: 'rgba(139, 92, 246, 0.2)',
                            border: '1px solid rgba(139, 92, 246, 0.3)',
                            borderRadius: 10,
                          }}
                        >
                          <div style={{ fontSize: 16, fontWeight: 700, color: '#c4b5fd', marginBottom: 4 }}>
                            {lesson.period || 'ë¯¸ì •'} - {lesson.subject || 'ì œëª© ì—†ìŒ'}
                          </div>
                          <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)' }}>
                            {lesson.topic || 'ì£¼ì œ ë¯¸ì…ë ¥'}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                );
              })()}

              {/* ë‹¤ê°€ì˜¤ëŠ” ì¼ì • */}
              {state.schedules && state.schedules.length > 0 && (
                <div style={{ marginBottom: 30 }}>
                  <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                    â° ë‹¤ê°€ì˜¤ëŠ” ì¼ì •
                  </h3>
                  {state.schedules
                    .filter(s => s && s.arrivalTs && (s.arrivalTs - (s.departBeforeMin || 30) * 60 * 1000 > nowMs()))
                    .sort((a, b) => a.arrivalTs - b.arrivalTs)
                    .slice(0, 3)
                    .map(sch => (
                      <CountdownBar
                        key={sch.id}
                        schedule={sch}
                        now={nowMs() + tick * 1000}
                        onAlert={handleScheduleAlert}
                      />
                    ))}
                </div>
              )}

              {/* ì„±ê³¼ ìš”ì•½ */}
              <div>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                  ğŸ¯ ì´ë²ˆ ì£¼ ì„±ê³¼
                </h3>
                <div style={{
                  padding: 20,
                  background: 'rgba(0,0,0,0.2)',
                  borderRadius: 12,
                  border: '1px solid rgba(255,255,255,0.1)',
                }}>
                  <div style={{ display: 'grid', gap: 12, fontSize: 14, color: 'rgba(255,255,255,0.8)' }}>
                    <div>
                      â€¢ ì§‘ì¤‘ ì„±ê³µ ì„¸ì…˜: {(state.focusHistory || []).filter(f => f && f.success).length}íšŒ
                    </div>
                    <div>
                      â€¢ ì™„ë£Œëœ ê³¼ì œ: {stats.completed || 0}ê°œ
                    </div>
                    <div>
                      â€¢ ì§„í–‰ ì¤‘ì¸ ê³¼ì œ: {(stats.total || 0) - (stats.completed || 0)}ê°œ
                    </div>
                    <div style={{ color: '#fbbf24', fontWeight: 700, marginTop: 8 }}>
                      ì´ íšë“ í¬ì¸íŠ¸: {(state.points || 0).toLocaleString()}P
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* ê³¼ì œ ê´€ë¦¬ (ì ‘ê¸°/í¼ì¹˜ê¸° + ìë™ ì§„í–‰ë¥ ) */}
          {view === 'tasks' && (
            <div style={styles.card} className="animate-in">
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20, flexWrap: 'wrap', gap: 12 }}>
                <h2 style={styles.h2} className="section-title">âœ… ê³¼ì œ ê´€ë¦¬</h2>
                <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>
                  <select
                    value={state.taskSortBy}
                    onChange={(e) => setState(p => ({ ...p, taskSortBy: e.target.value }))}
                    style={{
                      padding: '10px 14px',
                      borderRadius: 8,
                      background: 'rgba(255,255,255,0.1)',
                      color: 'white',
                      border: '1px solid rgba(255,255,255,0.2)',
                      fontSize: 13,
                      fontWeight: 700,
                      cursor: 'pointer',
                    }}
                  >
                    <option value="deadline">ë§ˆê°ì¼ìˆœ</option>
                    <option value="priority">ìš°ì„ ìˆœìœ„ìˆœ</option>
                    <option value="name">ì´ë¦„ìˆœ</option>
                    <option value="createdAt">ìµœì‹ ìˆœ</option>
                  </select>
                  <button style={styles.btn} onClick={addTask}>
                    â• ìƒˆ ê³¼ì œ ì¶”ê°€
                  </button>
                </div>
              </div>

              {filteredTasks.length === 0 && (
                <div style={{ textAlign: 'center', padding: 40, color: 'rgba(255,255,255,0.5)' }}>
                  ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ê³¼ì œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!
                </div>
              )}

              {filteredTasks.map((task) => {
                const autoProgress = calculateAutoProgress(task);
                const isCollapsed = state.collapsedItems[task.id];

                return (
                  <div
                    key={task.id}
                    style={{
                      padding: 20,
                      borderRadius: 16,
                      background: 'rgba(255,255,255,0.05)',
                      border: '1px solid rgba(255,255,255,0.1)',
                      marginBottom: 16,
                      transition: 'all 0.3s',
                    }}
                  >
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: isCollapsed ? 0 : 16 }}>
                      <div style={{ flex: 1 }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 8 }}>
                          <span style={{ fontSize: 24 }}>{CATEGORIES[task.category]?.icon}</span>
                          <input
                            className="editable-input"
                            value={task.title}
                            onChange={(e) => updateTask(task.id, { title: e.target.value })}
                            style={{ fontSize: 18, fontWeight: 700 }}
                          />
                          <span className="auto-progress-badge">
                            {autoProgress}%
                          </span>
                        </div>
                      </div>
                      <div style={{ display: 'flex', gap: 8 }}>
                        <button
                          className="collapse-toggle"
                          onClick={() => toggleCollapse(task.id)}
                        >
                          {isCollapsed ? 'â–¼ í¼ì¹˜ê¸°' : 'â–² ì ‘ê¸°'}
                        </button>
                        <button 
                          style={{ ...styles.btn2, padding: '8px 12px', background: 'rgba(59, 130, 246, 0.3)' }}
                          onClick={() => addStep(task.id)}
                        >
                          â• ë‹¨ê³„
                        </button>
                        <button 
                          style={{ ...styles.btn2, padding: '8px 12px', background: 'rgba(239, 68, 68, 0.3)' }}
                          onClick={() => deleteTask(task.id)}
                        >
                          ğŸ—‘ï¸
                        </button>
                      </div>
                    </div>

                    <div className={`collapsible ${isCollapsed ? 'collapsed' : ''}`} style={{ maxHeight: isCollapsed ? 0 : '2000px' }}>
                      <div style={{ marginBottom: 12 }}>
                        <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)', marginBottom: 6, fontWeight: 700 }}>
                          ì§„í–‰ë¥ : {autoProgress}% {task.steps?.length > 0 && `(${task.steps.filter(s => s.done).length}/${task.steps.length} ì™„ë£Œ)`}
                        </div>
                        <div style={{
                          height: 10,
                          background: 'rgba(0,0,0,0.3)',
                          borderRadius: 5,
                          overflow: 'hidden',
                          border: '1px solid rgba(255,255,255,0.1)',
                        }}>
                          <div style={{
                            height: '100%',
                            width: `${autoProgress}%`,
                            background: autoProgress === 100 ? 'linear-gradient(90deg, #10b981, #059669)' : 'linear-gradient(90deg, #3b82f6, #8b5cf6)',
                            transition: 'width 0.5s cubic-bezier(0.4, 0, 0.2, 1)',
                            boxShadow: autoProgress > 0 ? '0 0 10px rgba(59, 130, 246, 0.5)' : 'none',
                          }} />
                        </div>
                      </div>

                      <div style={{ display: 'flex', gap: 8, marginBottom: 12, flexWrap: 'wrap' }}>
                        <select
                          value={task.category}
                          onChange={(e) => updateTask(task.id, { category: e.target.value })}
                          style={{
                            padding: '8px 12px',
                            borderRadius: 8,
                            background: CATEGORIES[task.category]?.color,
                            color: 'white',
                            border: 'none',
                            fontSize: 13,
                            fontWeight: 700,
                            cursor: 'pointer',
                          }}
                        >
                          {Object.entries(CATEGORIES).map(([key, cat]) => (
                            <option key={key} value={key}>{cat.icon} {cat.label}</option>
                          ))}
                        </select>

                        <select
                          value={task.priority}
                          onChange={(e) => updateTask(task.id, { priority: e.target.value })}
                          style={{
                            padding: '8px 12px',
                            borderRadius: 8,
                            background: 'rgba(255,255,255,0.1)',
                            color: 'white',
                            border: '1px solid rgba(255,255,255,0.2)',
                            fontSize: 13,
                            fontWeight: 700,
                            cursor: 'pointer',
                          }}
                        >
                          {Object.entries(PRIORITIES).map(([key, pri]) => (
                            <option key={key} value={key}>{pri.icon} {pri.label}</option>
                          ))}
                        </select>
                      </div>

                      {/* ìƒˆ í•„ë“œ: ë§ˆê°ì¼ì‹œ, ë‹´ë‹¹ì, ì„¤ëª… */}
                      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 12 }}>
                        <div>
                          <label style={{ display: 'block', fontSize: 12, color: 'rgba(255,255,255,0.7)', marginBottom: 6, fontWeight: 700 }}>
                            ë§ˆê°ì¼ì‹œ
                          </label>
                          <input
                            type="datetime-local"
                            value={task.deadline ? toLocalDatetimeValue(task.deadline) : ''}
                            onChange={(e) => updateTask(task.id, { deadline: fromLocalDatetimeValue(e.target.value) })}
                            style={{
                              width: '100%',
                              padding: '8px 12px',
                              borderRadius: 8,
                              background: 'rgba(255,255,255,0.1)',
                              color: 'white',
                              border: '1px solid rgba(255,255,255,0.2)',
                              fontSize: 13,
                            }}
                          />
                          {task.deadline && nowMs() < task.deadline && (() => {
                            const diff = task.deadline - nowMs();
                            const days = Math.floor(diff / (24 * 60 * 60 * 1000));
                            const hours = Math.floor((diff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
                            const minutes = Math.floor((diff % (60 * 60 * 1000)) / (60 * 1000));
                            return (
                              <div style={{
                                marginTop: 6,
                                fontSize: 11,
                                color: diff < 24 * 60 * 60 * 1000 ? '#ef4444' : '#10b981',
                                fontWeight: 700,
                              }}>
                                ë‚¨ì€ ì‹œê°„: {days}ì¼ {hours}ì‹œê°„ {minutes}ë¶„
                              </div>
                            );
                          })()}
                          {task.deadline && nowMs() >= task.deadline && (
                            <div style={{ marginTop: 6, fontSize: 11, color: '#ef4444', fontWeight: 700 }}>
                              âš ï¸ ë§ˆê° ì§€ë‚¨
                            </div>
                          )}
                        </div>
                        <div>
                          <label style={{ display: 'block', fontSize: 12, color: 'rgba(255,255,255,0.7)', marginBottom: 6, fontWeight: 700 }}>
                            ë‹´ë‹¹ì
                          </label>
                          <input
                            type="text"
                            value={task.assignee || ''}
                            onChange={(e) => updateTask(task.id, { assignee: e.target.value })}
                            placeholder="ë‹´ë‹¹ì ì´ë¦„"
                            style={{
                              width: '100%',
                              padding: '8px 12px',
                              borderRadius: 8,
                              background: 'rgba(255,255,255,0.1)',
                              color: 'white',
                              border: '1px solid rgba(255,255,255,0.2)',
                              fontSize: 13,
                            }}
                          />
                        </div>
                      </div>

                      <div style={{ marginBottom: 12 }}>
                        <label style={{ display: 'block', fontSize: 12, color: 'rgba(255,255,255,0.7)', marginBottom: 6, fontWeight: 700 }}>
                          ì„¤ëª…
                        </label>
                        <textarea
                          value={task.description || ''}
                          onChange={(e) => updateTask(task.id, { description: e.target.value })}
                          placeholder="ê³¼ì œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."
                          rows={3}
                          style={{
                            width: '100%',
                            padding: '8px 12px',
                            borderRadius: 8,
                            background: 'rgba(255,255,255,0.1)',
                            color: 'white',
                            border: '1px solid rgba(255,255,255,0.2)',
                            fontSize: 13,
                            resize: 'vertical',
                            fontFamily: 'inherit',
                          }}
                        />
                      </div>

                      {task.steps && task.steps.length > 0 && (
                        <div>
                          <div style={{ fontSize: 14, fontWeight: 700, color: 'white', marginBottom: 8 }}>
                            ğŸ“ ì„¸ë¶€ ë‹¨ê³„ ({task.steps.filter(s => s.done).length}/{task.steps.length})
                          </div>
                          {task.steps.map((step, stepIdx) => (
                            <div
                              key={step.id}
                              style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: 8,
                                marginBottom: 8,
                                padding: 10,
                                background: step.done ? 'rgba(16, 185, 129, 0.1)' : 'rgba(0,0,0,0.2)',
                                borderRadius: 8,
                                border: step.done ? '1px solid rgba(16, 185, 129, 0.3)' : '1px solid rgba(255,255,255,0.1)',
                                transition: 'all 0.3s',
                              }}
                            >
                              <input
                                type="checkbox"
                                checked={step.done}
                                onChange={() => {
                                  toggleStep(task.id, step.id);
                                  // ì²´í¬ í›„ ì™„ë£Œ ì—¬ë¶€ í™•ì¸ (ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸ ëŒ€ê¸°)
                                  setTimeout(() => completeTask(task.id), 100);
                                }}
                                style={{ width: 10, height: 10, cursor: 'pointer', minWidth: 10, minHeight: 10 }}
                              />
                              <span style={{
                                flex: 1,
                                textDecoration: step.done ? 'line-through' : 'none',
                                opacity: step.done ? 0.6 : 1,
                                fontSize: 13,
                              }}>
                                {step.text}
                              </span>
                              <div style={{ display: 'flex', gap: 4 }}>
                                <button
                                  onClick={() => moveStepUp(task.id, step.id)}
                                  disabled={stepIdx === 0}
                                  style={{
                                    padding: '4px 8px',
                                    background: stepIdx === 0 ? 'rgba(255,255,255,0.05)' : 'rgba(59, 130, 246, 0.2)',
                                    border: '1px solid rgba(255,255,255,0.1)',
                                    borderRadius: 6,
                                    color: stepIdx === 0 ? 'rgba(255,255,255,0.3)' : 'white',
                                    fontSize: 11,
                                    cursor: stepIdx === 0 ? 'not-allowed' : 'pointer',
                                    fontWeight: 700,
                                  }}
                                  title="ìœ„ë¡œ ì´ë™"
                                >
                                  â–²
                                </button>
                                <button
                                  onClick={() => moveStepDown(task.id, step.id)}
                                  disabled={stepIdx === task.steps.length - 1}
                                  style={{
                                    padding: '4px 8px',
                                    background: stepIdx === task.steps.length - 1 ? 'rgba(255,255,255,0.05)' : 'rgba(59, 130, 246, 0.2)',
                                    border: '1px solid rgba(255,255,255,0.1)',
                                    borderRadius: 6,
                                    color: stepIdx === task.steps.length - 1 ? 'rgba(255,255,255,0.3)' : 'white',
                                    fontSize: 11,
                                    cursor: stepIdx === task.steps.length - 1 ? 'not-allowed' : 'pointer',
                                    fontWeight: 700,
                                  }}
                                  title="ì•„ë˜ë¡œ ì´ë™"
                                >
                                  â–¼
                                </button>
                                <button
                                  onClick={() => editStep(task.id, step.id)}
                                  style={{
                                    padding: '4px 8px',
                                    background: 'rgba(251, 191, 36, 0.2)',
                                    border: '1px solid rgba(251, 191, 36, 0.3)',
                                    borderRadius: 6,
                                    color: 'white',
                                    fontSize: 11,
                                    cursor: 'pointer',
                                    fontWeight: 700,
                                  }}
                                  title="ìˆ˜ì •"
                                >
                                  âœï¸
                                </button>
                                <button
                                  onClick={() => deleteStep(task.id, step.id)}
                                  style={{
                                    padding: '4px 8px',
                                    background: 'rgba(239, 68, 68, 0.2)',
                                    border: '1px solid rgba(239, 68, 68, 0.3)',
                                    borderRadius: 6,
                                    color: 'white',
                                    fontSize: 11,
                                    cursor: 'pointer',
                                    fontWeight: 700,
                                  }}
                                  title="ì‚­ì œ"
                                >
                                  ğŸ—‘ï¸
                                </button>
                              </div>
                              {step.done && <span style={{ fontSize: 16 }}>âœ…</span>}
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          )}

          {/* ìˆ˜ì—… ê´€ë¦¬ ì‹œìŠ¤í…œ */}
          {view === 'teaching' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2} className="section-title">ğŸ‘¨â€ğŸ« ìˆ˜ì—… ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 20 }}>
                ì£¼ê°„ ìº˜ë¦°ë”ì—ì„œ ë‚ ì§œë³„ ìˆ˜ì—…ì„ ê´€ë¦¬í•˜ê³ , ë°˜ë³µ ìˆ˜ì—…ì„ ì†ì‰½ê²Œ ì¶”ê°€í•˜ì„¸ìš”.
              </p>

              <div style={{ marginBottom: 20, display: 'flex', gap: 10, flexWrap: 'wrap', alignItems: 'center' }}>
                <button
                  style={styles.btn}
                  onClick={() => setEditingLesson({ date: lessonWeekStart.getTime(), period: '1êµì‹œ' })}
                >
                  â• ìˆ˜ì—… ì¶”ê°€
                </button>
                <button
                  style={{ ...styles.btn, background: 'linear-gradient(135deg, #10b981, #059669)' }}
                  onClick={exportLessonsAndEvalsCSV}
                >
                  ğŸ’¾ ìˆ˜ì—… ë° í‰ê°€ CSV ì €ì¥
                </button>
                <label className="file-input-label">
                  ğŸ“¥ CSV ë¶ˆëŸ¬ì˜¤ê¸°
                  <input type="file" accept=".csv" onChange={importLessonsCSV} />
                </label>
              </div>

              <div className="calendar-header" style={{ marginBottom: 16 }}>
                <button
                  style={{ ...styles.btn2, padding: '10px 16px' }}
                  onClick={() => setLessonWeekStart(addDays(lessonWeekStart, -7))}
                >
                  â—€ ì´ì „ ì£¼
                </button>
                <div style={{ fontSize: 18, fontWeight: 800, color: 'white' }}>
                  {getWeekLabel(lessonWeekStart)}
                </div>
                <button
                  style={{ ...styles.btn2, padding: '10px 16px' }}
                  onClick={() => setLessonWeekStart(addDays(lessonWeekStart, 7))}
                >
                  ë‹¤ìŒ ì£¼ â–¶
                </button>
              </div>

              {/* ì£¼ê°„ ìˆ˜ì—…í‘œ */}
              <div className="timetable">
                <div className="timetable-header">êµì‹œ</div>
                {lessonWeekDates.map((dayDate) => (
                  <div key={dayDate.toISOString()} className="timetable-header">
                    <div>{getDayLabel(dayDate)}ìš”ì¼</div>
                    <div style={{ fontSize: 11, marginTop: 4 }}>
                      {dayDate.toLocaleDateString('ko-KR', { month: 'numeric', day: 'numeric' })}
                    </div>
                  </div>
                ))}

                {PERIODS.map((period) => (
                  <React.Fragment key={period}>
                    <div className="timetable-cell" style={{ fontWeight: 900, background: 'rgba(59, 130, 246, 0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      {period}
                    </div>
                    {lessonWeekDates.map((dayDate) => {
                      const lessons = state.lessons.filter(l => {
                        if (l.date) return isSameDay(l.date, dayDate) && l.period === period;
                        return l.dayOfWeek === getDayLabel(dayDate) && l.period === period;
                      });

                      return (
                        <div
                          key={`${dayDate.toISOString()}-${period}`}
                          className="timetable-cell"
                          onClick={() => setEditingLesson({ date: dayDate.getTime(), period })}
                        >
                          {lessons.length === 0 ? (
                            <div style={{ textAlign: 'center', color: 'rgba(255,255,255,0.3)', fontSize: 11 }}>
                              + ìˆ˜ì—… ì¶”ê°€
                            </div>
                          ) : (
                            lessons.map(lesson => {
                              const subjectColor = lesson.subject && SUBJECTS[lesson.subject]
                                ? SUBJECTS[lesson.subject].color
                                : '#8b5cf6';
                              return (
                                <div
                                  key={lesson.id}
                                  className="lesson-card"
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    setEditingLesson(lesson);
                                  }}
                                  style={{
                                    background: `linear-gradient(135deg, ${subjectColor}50, ${subjectColor}30)`,
                                    border: `1px solid ${subjectColor}80`,
                                  }}
                                >
                                  <div className="lesson-card-title">{lesson.subject}</div>
                                  <div className="lesson-card-subtitle">
                                    {lesson.topic || 'ì œì¬ ë¯¸ì…ë ¥'}
                                  </div>
                                  <div style={{ fontSize: 9, marginTop: 4, color: 'rgba(255,255,255,0.6)' }}>
                                    {lesson.goal ? `ëª©í‘œ: ${lesson.goal.slice(0, 20)}${lesson.goal.length > 20 ? '...' : ''}` : ''}
                                  </div>
                                </div>
                              );
                            })
                          )}
                        </div>
                      );
                    })}
                  </React.Fragment>
                ))}
              </div>

            </div>
          )}

          {/* ì§‘ì¤‘ íƒ€ì´ë¨¸ */}
          {view === 'focus' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2} className="section-title">â±ï¸ ì§‘ì¤‘ íƒ€ì´ë¨¸</h2>
              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 16 }}>
                ê°„ë‹¨í•œ ì§‘ì¤‘ íƒ€ì´ë¨¸ë¡œ ìˆ˜ì—… ì¤€ë¹„, ê¸°ë¡ ì‘ì„± ì‹œê°„ì„ ê´€ë¦¬í•˜ì„¸ìš”.
              </p>

              <CircularTimer remainingMs={focusStatus.remainingMs} totalMs={state.focus.durationSec * 1000} />

              <div style={{ marginTop: 20, display: 'grid', gap: 12 }}>
                <div className="form-grid">
                  <div>
                    <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>ì§‘ì¤‘ ì‹œê°„(ë¶„)</label>
                    <input
                      type="number"
                      min="1"
                      className="form-control"
                      value={focusDraft.durationMin}
                      onChange={(e) => setFocusDraft({ ...focusDraft, durationMin: parseInt(e.target.value) || 1 })}
                    />
                  </div>
                  <div>
                    <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>ë©”ëª¨</label>
                    <input
                      className="form-control"
                      value={focusDraft.note}
                      onChange={(e) => setFocusDraft({ ...focusDraft, note: e.target.value })}
                      placeholder="ì˜ˆ: í–‰ë™ ê¸°ë¡ ì •ë¦¬"
                    />
                  </div>
                  <div>
                    <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>ìƒíƒœ</label>
                    <div style={{ padding: '12px 14px', borderRadius: 10, background: 'rgba(255,255,255,0.08)', border: '1px solid rgba(255,255,255,0.15)' }}>
                      {state.focus.running ? (state.focus.paused ? 'ì¼ì‹œì •ì§€' : 'ì§‘ì¤‘ ì¤‘') : 'ëŒ€ê¸°'}
                    </div>
                  </div>
                </div>

                <div style={{ display: 'flex', gap: 10, flexWrap: 'wrap' }}>
                  {!state.focus.running && (
                    <button style={styles.btn} onClick={startFocus}>
                      â–¶ï¸ ì‹œì‘
                    </button>
                  )}
                  {state.focus.running && !state.focus.paused && (
                    <button style={{ ...styles.btn, background: 'linear-gradient(135deg, #f59e0b, #d97706)' }} onClick={pauseFocus}>
                      â¸ï¸ ì¼ì‹œì •ì§€
                    </button>
                  )}
                  {state.focus.running && state.focus.paused && (
                    <button style={{ ...styles.btn, background: 'linear-gradient(135deg, #10b981, #059669)' }} onClick={resumeFocus}>
                      â–¶ï¸ ì¬ê°œ
                    </button>
                  )}
                  <button style={{ ...styles.btn2, padding: '12px 20px' }} onClick={resetFocus}>
                    ğŸ”„ ì´ˆê¸°í™”
                  </button>
                </div>
              </div>

              {/* ì§‘ì¤‘ ê¸°ë¡ */}
              {state.focusHistory && state.focusHistory.length > 0 && (
                <div style={{ ...styles.card, marginTop: 20 }}>
                  <h3 style={{ fontSize: 18, fontWeight: 800, color: 'white', marginBottom: 16 }}>
                    ğŸ“Š ì§‘ì¤‘ ê¸°ë¡ ({state.focusHistory.length}ê±´)
                  </h3>
                  <div style={{ display: 'grid', gap: 12 }}>
                    {state.focusHistory.slice(0, 10).map(record => (
                      <div key={record.id} style={{
                        padding: 16,
                        background: 'rgba(255,255,255,0.08)',
                        border: '1px solid rgba(255,255,255,0.15)',
                        borderRadius: 10,
                      }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: 8 }}>
                          <div>
                            <div style={{ fontSize: 14, fontWeight: 700, color: 'white', marginBottom: 4 }}>
                              {record.note || 'ì§‘ì¤‘ ì„¸ì…˜'}
                            </div>
                            <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)' }}>
                              {formatDateTime(record.completedAt)}
                            </div>
                          </div>
                          <div style={{ fontSize: 16, fontWeight: 700, color: '#a78bfa' }}>
                            {Math.round(record.duration / 60)}ë¶„
                          </div>
                        </div>
                        <div style={{ display: 'flex', gap: 8, marginTop: 12 }}>
                          <button
                            style={{ ...styles.btn2, padding: '8px 16px', fontSize: 12 }}
                            onClick={() => editFocusHistory(record.id)}
                          >
                            âœï¸ ìˆ˜ì •
                          </button>
                          <button
                            style={{ ...styles.btn2, padding: '8px 16px', fontSize: 12, background: 'rgba(239, 68, 68, 0.3)' }}
                            onClick={() => deleteFocusHistory(record.id)}
                          >
                            ğŸ—‘ï¸ ì‚­ì œ
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* í¬ì¸íŠ¸ ê´€ë¦¬ */}
          {view === 'points' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2} className="section-title">ğŸª™ í¬ì¸íŠ¸ ê´€ë¦¬</h2>
              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 20 }}>
                ì§‘ì¤‘ ì„±ê³µ, ê³¼ì œ ì™„ë£Œ ë“±ìœ¼ë¡œ í¬ì¸íŠ¸ë¥¼ íšë“í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”.
              </p>

              {/* í˜„ì¬ í¬ì¸íŠ¸ í‘œì‹œ */}
              <div style={{
                padding: 30,
                borderRadius: 16,
                background: 'linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3))',
                border: '2px solid rgba(251, 191, 36, 0.4)',
                marginBottom: 24,
                textAlign: 'center',
              }}>
                <div style={{ fontSize: 16, color: 'rgba(255,255,255,0.8)', marginBottom: 8 }}>ë³´ìœ  í¬ì¸íŠ¸</div>
                <div style={{ fontSize: 48, fontWeight: 900, color: '#fbbf24' }}>{state.points.toLocaleString()}</div>
                <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.6)', marginTop: 4 }}>P</div>
              </div>

              {/* í¬ì¸íŠ¸ ì¡°ì • ì„¹ì…˜ */}
              <div style={{
                padding: 20,
                background: 'rgba(0,0,0,0.2)',
                borderRadius: 12,
                border: '1px solid rgba(255,255,255,0.1)',
                marginBottom: 24,
              }}>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                  âš™ï¸ í¬ì¸íŠ¸ ì¡°ì •
                </h3>

                <div style={{ display: 'grid', gap: 16 }}>
                  <div className="form-field">
                    <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>í¬ì¸íŠ¸ ë³€ê²½</label>
                    <div style={{ display: 'flex', gap: 8 }}>
                      <input
                        type="number"
                        placeholder="í¬ì¸íŠ¸ ì…ë ¥"
                        id="pointsInput"
                        className="form-control"
                        style={{ flex: 1 }}
                      />
                      <button
                        style={{
                          padding: '10px 16px',
                          background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                          border: 'none',
                          borderRadius: 8,
                          color: 'white',
                          fontSize: 13,
                          fontWeight: 700,
                          cursor: 'pointer',
                          transition: 'all 0.2s',
                        }}
                        onClick={() => {
                          const input = document.getElementById('pointsInput');
                          const value = parseInt(input.value) || 0;
                          if (value !== 0) {
                            setState(p => ({ ...p, points: p.points + value }));
                            setShowAlert({
                              title: value > 0 ? 'âœ… í¬ì¸íŠ¸ ì¶”ê°€' : 'âš ï¸ í¬ì¸íŠ¸ ì°¨ê°',
                              message: `${Math.abs(value)}í¬ì¸íŠ¸ê°€ ${value > 0 ? 'ì¶”ê°€' : 'ì°¨ê°'}ë˜ì—ˆìŠµë‹ˆë‹¤.`
                            });
                            setTimeout(() => setShowAlert(null), 3000);
                            input.value = '';
                          }
                        }}
                      >
                        â• ì¶”ê°€
                      </button>
                      <button
                        style={{
                          padding: '10px 16px',
                          background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                          border: 'none',
                          borderRadius: 8,
                          color: 'white',
                          fontSize: 13,
                          fontWeight: 700,
                          cursor: 'pointer',
                          transition: 'all 0.2s',
                        }}
                        onClick={() => {
                          const input = document.getElementById('pointsInput');
                          const value = parseInt(input.value) || 0;
                          if (value !== 0) {
                            setState(p => ({ ...p, points: Math.max(0, p.points - value) }));
                            setShowAlert({
                              title: 'âš ï¸ í¬ì¸íŠ¸ ì°¨ê°',
                              message: `${value}í¬ì¸íŠ¸ê°€ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤.`
                            });
                            setTimeout(() => setShowAlert(null), 3000);
                            input.value = '';
                          }
                        }}
                      >
                        â– ì°¨ê°
                      </button>
                    </div>
                  </div>

                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))', gap: 10 }}>
                    {[10, 50, 100, 500].map(amount => (
                      <button
                        key={amount}
                        style={{
                          padding: '12px',
                          background: 'rgba(251, 191, 36, 0.2)',
                          border: '1px solid rgba(251, 191, 36, 0.3)',
                          borderRadius: 8,
                          color: '#fbbf24',
                          fontSize: 14,
                          fontWeight: 700,
                          cursor: 'pointer',
                          transition: 'all 0.2s',
                        }}
                        onClick={() => {
                          setState(p => ({ ...p, points: p.points + amount }));
                          setShowAlert({
                            title: 'âœ… í¬ì¸íŠ¸ ì¶”ê°€',
                            message: `${amount}í¬ì¸íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`
                          });
                          setTimeout(() => setShowAlert(null), 3000);
                        }}
                      >
                        +{amount}P
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              {/* í¬ì¸íŠ¸ ì´ë ¥ */}
              <div style={{
                padding: 20,
                background: 'rgba(0,0,0,0.2)',
                borderRadius: 12,
                border: '1px solid rgba(255,255,255,0.1)',
              }}>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                  ğŸ“Š í¬ì¸íŠ¸ íšë“ ì´ë ¥
                </h3>
                <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.7)' }}>
                  <div style={{ marginBottom: 12 }}>
                    â€¢ ì§‘ì¤‘ ì„±ê³µ: +100 í¬ì¸íŠ¸
                  </div>
                  <div style={{ marginBottom: 12 }}>
                    â€¢ ë§ˆê°ì¼ ì „ ê³¼ì œ ì™„ë£Œ: +100 í¬ì¸íŠ¸
                  </div>
                  <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: 12, marginTop: 16 }}>
                    í¬ì¸íŠ¸ëŠ” ì§‘ì¤‘ íƒ€ì´ë¨¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí•˜ê±°ë‚˜ ê³¼ì œë¥¼ ë§ˆê°ì¼ ì „ì— ì™„ë£Œí•˜ë©´ ìë™ìœ¼ë¡œ ëˆ„ì ë©ë‹ˆë‹¤.
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* ì¼ì • ì•ŒëŒ */}
          {view === 'schedule' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2} className="section-title">ğŸš— ì¼ì • ê´€ë¦¬ & ì¶œë°œ ì•ŒëŒ</h2>
              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 16, padding: 12, background: 'rgba(239, 68, 68, 0.1)', borderRadius: 8, border: '1px solid rgba(239, 68, 68, 0.3)' }}>
                â° <strong>ì¶œë°œ ì‹œê°„ì— ìë™ìœ¼ë¡œ ì•Œë¦¼ì´ ìš¸ë¦½ë‹ˆë‹¤!</strong> ì¼ì • ì¶”ê°€ í›„ ì¶œë°œ ì „ ì•Œë¦¼ì„ í™•ì¸í•˜ì„¸ìš”.
              </p>

              <div style={{ display: 'grid', gap: 12, marginBottom: 20 }}>
                <div className="form-field">
                  <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>ì¼ì • ì´ë¦„ *</label>
                  <input
                    className="form-control"
                    value={scheduleDraft.name}
                    onChange={(e) => setScheduleDraft({ ...scheduleDraft, name: e.target.value })}
                    placeholder="ì˜ˆ: ìƒë‹´ ì¼ì •, í•™êµ íšŒì˜"
                  />
                </div>
                <div className="form-field">
                  <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>ë„ì°© ì‹œê°„ *</label>
                  <input
                    type="datetime-local"
                    className="form-control"
                    value={scheduleDraft.arrivalTs}
                    onChange={(e) => setScheduleDraft({ ...scheduleDraft, arrivalTs: e.target.value })}
                  />
                </div>
                <div className="form-grid">
                  <div>
                    <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>ì¶œë°œ ì „ ì•Œë¦¼(ë¶„)</label>
                    <input
                      type="number"
                      min="0"
                      className="form-control"
                      value={scheduleDraft.departBeforeMin}
                      onChange={(e) => setScheduleDraft({ ...scheduleDraft, departBeforeMin: e.target.value })}
                    />
                  </div>
                  <div>
                    <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>ì¥ì†Œ</label>
                    <input
                      className="form-control"
                      value={scheduleDraft.location}
                      onChange={(e) => setScheduleDraft({ ...scheduleDraft, location: e.target.value })}
                      placeholder="ì˜ˆ: êµë¬´ì‹¤"
                    />
                  </div>
                  <div>
                    <label style={{ fontWeight: 700, color: 'rgba(255,255,255,0.8)' }}>ë©”ëª¨</label>
                    <input
                      className="form-control"
                      value={scheduleDraft.note}
                      onChange={(e) => setScheduleDraft({ ...scheduleDraft, note: e.target.value })}
                      placeholder="ì¤€ë¹„ë¬¼ ë“±"
                    />
                  </div>
                </div>
                <button style={styles.btn} onClick={addSchedule}>
                  â• ì¼ì • ì¶”ê°€
                </button>
              </div>

              {state.schedules.length === 0 && (
                <div style={{ textAlign: 'center', padding: 40, color: 'rgba(255,255,255,0.5)' }}>
                  ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
              )}

              {state.schedules
                .slice()
                .sort((a, b) => a.arrivalTs - b.arrivalTs)
                .map(sch => (
                  <div key={sch.id} style={{ marginBottom: 16 }}>
                    <CountdownBar 
                      schedule={sch} 
                      now={nowMs() + tick * 1000}
                      onAlert={handleScheduleAlert}
                    />
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 10, marginTop: 8, paddingLeft: 8 }}>
                      <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)' }}>
                        {sch.location ? `ğŸ“ ${sch.location}` : 'ğŸ“ ìœ„ì¹˜ ë¯¸ì…ë ¥'} {sch.note ? `â€¢ ${sch.note}` : ''}
                      </div>
                      <div style={{ display: 'flex', gap: 8 }}>
                        <button
                          style={{ ...styles.btn, padding: '8px 16px', fontSize: 12, background: 'linear-gradient(135deg, #10b981, #059669)' }}
                          onClick={() => completeScheduleArrival(sch)}
                        >
                          âœ… ë„ì°© ì™„ë£Œ
                        </button>
                        <button
                          style={{ ...styles.btn2, padding: '8px 16px', fontSize: 12, background: 'rgba(239, 68, 68, 0.3)' }}
                          onClick={() => deleteSchedule(sch.id)}
                        >
                          ì‚­ì œ
                        </button>
                      </div>
                    </div>
                  </div>
                ))}

              {/* ì¼ì • ë„ì°© ê¸°ë¡ */}
              {state.scheduleHistory && state.scheduleHistory.length > 0 && (
                <div style={{ ...styles.card, marginTop: 20 }}>
                  <h3 style={{ fontSize: 18, fontWeight: 800, color: 'white', marginBottom: 16 }}>
                    ğŸ“Š ì¼ì • ë„ì°© ê¸°ë¡ ({state.scheduleHistory.length}ê±´)
                  </h3>
                  <div style={{ display: 'grid', gap: 12 }}>
                    {state.scheduleHistory.slice(0, 10).map(record => (
                      <div key={record.id} style={{
                        padding: 16,
                        background: 'rgba(255,255,255,0.08)',
                        border: '1px solid rgba(255,255,255,0.15)',
                        borderRadius: 10,
                      }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: 8 }}>
                          <div>
                            <div style={{ fontSize: 14, fontWeight: 700, color: 'white', marginBottom: 4 }}>
                              {record.scheduleName}
                            </div>
                            <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)' }}>
                              ë„ì°©: {formatDateTime(record.arrivalTime)}
                            </div>
                            {record.location && (
                              <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginTop: 2 }}>
                                ğŸ“ {record.location}
                              </div>
                            )}
                          </div>
                          <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'end', gap: 4 }}>
                            <span style={{
                              padding: '4px 12px',
                              borderRadius: 6,
                              fontSize: 12,
                              fontWeight: 700,
                              background: record.onTime ? 'rgba(16, 185, 129, 0.3)' : 'rgba(239, 68, 68, 0.3)',
                              color: record.onTime ? '#6ee7b7' : '#fca5a5',
                            }}>
                              {record.onTime ? 'âœ… ì •ì‹œ' : 'â° ëŠ¦ìŒ'}
                            </span>
                            <div style={{ fontSize: 14, fontWeight: 700, color: '#fbbf24' }}>
                              +{record.points} P
                            </div>
                          </div>
                        </div>
                        <div style={{ display: 'flex', gap: 8, marginTop: 12 }}>
                          <button
                            style={{ ...styles.btn2, padding: '8px 16px', fontSize: 12 }}
                            onClick={() => editScheduleHistory(record.id)}
                          >
                            âœï¸ ìˆ˜ì •
                          </button>
                          <button
                            style={{ ...styles.btn2, padding: '8px 16px', fontSize: 12, background: 'rgba(239, 68, 68, 0.3)' }}
                            onClick={() => deleteScheduleHistory(record.id)}
                          >
                            ğŸ—‘ï¸ ì‚­ì œ
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* ìº˜ë¦°ë” */}
          {view === 'calendar' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2} className="section-title">ğŸ“… ì›”ë³„ ìº˜ë¦°ë”</h2>
              <Calendar tasks={state.tasks} schedules={state.schedules} lessons={state.lessons} />
            </div>
          )}

          {/* PBS í–‰ë™ì§€ì› (í–‰ë™ íŠ¸ë˜í‚¹) */}
          {view === 'behavior' && (
            <div style={styles.card} className="animate-in">
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20, flexWrap: 'wrap', gap: 10 }}>
                <h2 style={styles.h2} className="section-title">ğŸ¯ PBS ì£¼ê°„ í–‰ë™ ë¶„í¬ ê¸°ë¡ì§€</h2>
                <div style={{ display: 'flex', gap: 10, flexWrap: 'wrap' }}>
                  <button
                    style={styles.btn}
                    onClick={() => setEditingBehavior({ behaviorType: 'TARGET', frequency: 0 })}
                  >
                    â• í–‰ë™ ê¸°ë¡ ì¶”ê°€
                  </button>
                  <button
                    style={{ ...styles.btn, background: 'linear-gradient(135deg, #10b981, #059669)' }}
                    onClick={() => exportBehaviorLogCSV(state.behaviorLog)}
                  >
                    ğŸ’¾ CSV ë‚´ë³´ë‚´ê¸°
                  </button>
                </div>
              </div>

              <div className="calendar-header" style={{ marginBottom: 16 }}>
                <button
                  style={{ ...styles.btn2, padding: '10px 16px' }}
                  onClick={() => setBehaviorWeekStart(addDays(behaviorWeekStart, -7))}
                >
                  â—€ ì´ì „ ì£¼
                </button>
                <div style={{ fontSize: 18, fontWeight: 800, color: 'white' }}>
                  {getWeekLabel(behaviorWeekStart)}
                </div>
                <button
                  style={{ ...styles.btn2, padding: '10px 16px' }}
                  onClick={() => setBehaviorWeekStart(addDays(behaviorWeekStart, 7))}
                >
                  ë‹¤ìŒ ì£¼ â–¶
                </button>
              </div>

              <div className="chart-actions" style={{ marginBottom: 16 }}>
                <select
                  value={behaviorWeekStudent}
                  onChange={(e) => setBehaviorWeekStudent(e.target.value)}
                  className="form-select"
                >
                  <option value="ALL">ì „ì²´ í•™ìƒ</option>
                  {behaviorStudents.map(student => (
                    <option key={student} value={student}>{student}</option>
                  ))}
                </select>
              </div>

              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 20, padding: 12, background: 'rgba(139, 92, 246, 0.1)', borderRadius: 8, border: '1px solid rgba(139, 92, 246, 0.3)' }}>
                ğŸ“Š <strong>ì£¼ê°„ ë¶„í¬ ê¸°ë¡ì§€:</strong> ìš”ì¼ë³„ í–‰ë™ ë°œìƒ ë¶„í¬ë¥¼ í•œëˆˆì— í™•ì¸í•˜ê³ , ABC ê¸°ë¡ìœ¼ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.
              </p>

              <div style={{ display: 'grid', gap: 12 }}>
                {behaviorWeekDates.map((dayDate) => {
                  const dayLogs = weeklyBehaviorLogs.filter(log => isSameDay(log.timestamp, dayDate));
                  const typeCounts = {};
                  dayLogs.forEach(log => {
                    const label = BEHAVIOR_TYPES[log.behaviorType]?.label || log.behaviorType;
                    typeCounts[label] = (typeCounts[label] || 0) + 1;
                  });

                  return (
                    <div
                      key={dayDate.toISOString()}
                      style={{
                        padding: 16,
                        borderRadius: 14,
                        background: 'rgba(255,255,255,0.05)',
                        border: '1px solid rgba(255,255,255,0.1)',
                      }}
                    >
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 10 }}>
                        <div style={{ fontSize: 16, fontWeight: 800, color: 'white' }}>
                          {getDayLabel(dayDate)}ìš”ì¼ Â· {dayDate.toLocaleDateString('ko-KR', { month: 'numeric', day: 'numeric' })}
                        </div>
                        <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)' }}>
                          ì´ {dayLogs.length}ê±´
                        </div>
                      </div>

                      <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8, marginBottom: 12 }}>
                        {Object.entries(BEHAVIOR_TYPES).map(([key, type]) => (
                          <div
                            key={key}
                            style={{
                              padding: '6px 10px',
                              borderRadius: 999,
                              border: `1px solid ${type.color}55`,
                              background: `${type.color}20`,
                              fontSize: 12,
                              color: 'white',
                              fontWeight: 700,
                            }}
                          >
                            {type.icon} {type.label} Â· {typeCounts[type.label] || 0}
                          </div>
                        ))}
                      </div>

                      {dayLogs.length === 0 ? (
                        <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.5)' }}>
                          ê¸°ë¡ëœ í–‰ë™ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                      ) : (
                        <div style={{ display: 'grid', gap: 8 }}>
                          {dayLogs.map(log => (
                            <div
                              key={log.id}
                              style={{
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                padding: '10px 12px',
                                borderRadius: 10,
                                background: 'rgba(0,0,0,0.2)',
                              }}
                            >
                              <div>
                                <div style={{ fontSize: 13, fontWeight: 700, color: 'white' }}>
                                  {log.studentName} Â· {log.behavior}
                                </div>
                                <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.6)' }}>
                                  {BEHAVIOR_TYPES[log.behaviorType]?.label} Â· {log.antecedent || 'ì„ í–‰ì‚¬ê±´ ë¯¸ì…ë ¥'}
                                </div>
                              </div>
                              <div style={{ display: 'flex', gap: 6 }}>
                                <button
                                  style={{ ...styles.btn2, padding: '6px 10px', background: 'rgba(59, 130, 246, 0.3)' }}
                                  onClick={() => setEditingBehavior(log)}
                                >
                                  ìˆ˜ì •
                                </button>
                                <button
                                  style={{ ...styles.btn2, padding: '6px 10px', background: 'rgba(239, 68, 68, 0.3)' }}
                                  onClick={() => deleteBehaviorLog(log.id)}
                                >
                                  ì‚­ì œ
                                </button>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {/* í–‰ë™ ê·¸ë˜í”„ / ë¶„ì„ */}
          {view === 'behaviorAnalytics' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2} className="section-title">ğŸ“ˆ í–‰ë™ ë°ì´í„° ë¶„ì„ ë° ì‹œê°í™”</h2>

              <div className="chart-actions" style={{ marginBottom: 20 }}>
                <select
                  value={behaviorFilter.chartType}
                  onChange={(e) => setBehaviorFilter({ ...behaviorFilter, chartType: e.target.value })}
                  className="form-select"
                >
                  <option value="daily">ì¼ë³„ í–‰ë™ ë°œìƒ ë¹ˆë„</option>
                  <option value="weekly">ì£¼ë³„ í–‰ë™ ë°œìƒ ë¹ˆë„</option>
                  <option value="dayOfWeek">ìš”ì¼ë³„ í–‰ë™ ë°œìƒ ë¶„í¬</option>
                  <option value="period">êµì‹œë³„ í–‰ë™ ë°œìƒ ë¶„í¬</option>
                  <option value="weeklyGoalAchievement">ì£¼ë³„ ìˆ˜ì—…ëª©í‘œ ë„ë‹¬ ë¹ˆë„ (3~5ì )</option>
                  <option value="weeklyEvalFreq">ì£¼ë³„ í–‰ë™ë°œìƒ ë¹ˆë„ (1~5ì )</option>
                  <option value="dailyEvalFreq">ì¼ë³„ í–‰ë™ë°œìƒ ë¹ˆë„ (1~5ì )</option>
                </select>
                <select
                  value={behaviorFilter.dateRange}
                  onChange={(e) => setBehaviorFilter({ ...behaviorFilter, dateRange: parseInt(e.target.value) })}
                  className="form-select"
                >
                  <option value={7}>ìµœê·¼ 7ì¼</option>
                  <option value={30}>ìµœê·¼ 30ì¼</option>
                  <option value={90}>ìµœê·¼ 90ì¼</option>
                  <option value="march1">({new Date().getFullYear()}ë…„) 3ì›” 1ì¼ ~ í˜„ì¬</option>
                </select>
                <select
                  value={behaviorFilter.student}
                  onChange={(e) => setBehaviorFilter({ ...behaviorFilter, student: e.target.value })}
                  className="form-select"
                >
                  <option value="ALL">ì „ì²´ ë°ì´í„° (ëª¨ë“  í•™ìƒ)</option>
                  <option value="CLASS_TOTAL">í•™ê¸‰ í•©ê³„</option>
                  <option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
                  {['í•™ìƒ1', 'í•™ìƒ2', 'í•™ìƒ3', 'í•™ìƒ4', 'í•™ìƒ5', 'í•™ìƒ6', 'í•™ìƒ7'].map(student => (
                    <option key={student} value={student}>{student}</option>
                  ))}
                </select>

                <button
                  style={{ ...styles.btn2, background: 'rgba(16, 185, 129, 0.3)' }}
                  onClick={() => exportChartAsPNG('behaviorLineChart', 'í–‰ë™ë¹ˆë„ì°¨íŠ¸.png')}
                >
                  ğŸ“Š ì°¨íŠ¸ PNG ì €ì¥
                </button>
              </div>

              {state.behaviorLog.length === 0 ? (
                <div style={{ textAlign: 'center', padding: 60, color: 'rgba(255,255,255,0.5)' }}>
                  ë¶„ì„í•  í–‰ë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. í–‰ë™ ê¸°ë¡ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.
                </div>
              ) : filteredBehaviorLog.length === 0 ? (
                <div style={{ textAlign: 'center', padding: 60, color: 'rgba(255,255,255,0.5)' }}>
                  ì„ íƒí•œ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” í–‰ë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
              ) : (
                <div>
                  {/* í†µê³„ ìš”ì•½ */}
                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',
                    gap: 16,
                    marginBottom: 30,
                  }}>
                    {(() => {
                      const byType = {};
                      filteredBehaviorLog.forEach(b => {
                        const type = BEHAVIOR_TYPES[b.behaviorType]?.label || b.behaviorType;
                        byType[type] = (byType[type] || 0) + 1;
                      });

                      const sorted = Object.entries(byType).sort((a, b) => b[1] - a[1]);
                      const mostCommon = sorted.length > 0 ? sorted[0] : null;

                      return (
                        <>
                          <div style={{
                            padding: 20,
                            borderRadius: 12,
                            background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(99, 102, 241, 0.3))',
                            border: '1px solid rgba(59, 130, 246, 0.4)',
                            textAlign: 'center',
                          }}>
                            <div style={{ fontSize: 32, fontWeight: 900, color: '#60a5fa' }}>{filteredBehaviorLog.length}</div>
                            <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.8)' }}>ì´ ê¸°ë¡ ìˆ˜</div>
                          </div>
                          <div style={{
                            padding: 20,
                            borderRadius: 12,
                            background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.3))',
                            border: '1px solid rgba(16, 185, 129, 0.4)',
                            textAlign: 'center',
                          }}>
                            <div style={{ fontSize: 32, fontWeight: 900, color: '#10b981' }}>
                              {(() => {
                                if (filteredBehaviorLog.length === 0) return 0;
                                const dayCount = behaviorFilter.dateRange === 'march1'
                                  ? Math.ceil((Date.now() - new Date(new Date().getFullYear(), 2, 1).getTime()) / (24 * 60 * 60 * 1000))
                                  : behaviorFilter.dateRange;
                                return (filteredBehaviorLog.length / dayCount).toFixed(1);
                              })()}
                            </div>
                            <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.8)' }}>ì¼í‰ê·  ë°œìƒ</div>
                          </div>
                          <div style={{
                            padding: 20,
                            borderRadius: 12,
                            background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(124, 58, 237, 0.3))',
                            border: '1px solid rgba(139, 92, 246, 0.4)',
                            textAlign: 'center',
                          }}>
                            <div style={{ fontSize: 16, fontWeight: 900, color: '#a78bfa' }}>
                              {mostCommon ? mostCommon[0] : '-'}
                            </div>
                            <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.8)' }}>ìµœë‹¤ ë°œìƒ</div>
                          </div>
                        </>
                      );
                    })()}
                  </div>

                  {/* ì°¨íŠ¸: ì„ íƒëœ ìœ í˜• */}
                  <div className="chart-container">
                    <h3 style={{ fontSize: 16, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                      ğŸ“Š {
                        behaviorFilter.chartType === 'daily' ? 'ì¼ë³„ í–‰ë™ ë°œìƒ ë¹ˆë„' :
                        behaviorFilter.chartType === 'weekly' ? 'ì£¼ë³„ í–‰ë™ ë°œìƒ ë¹ˆë„' :
                        behaviorFilter.chartType === 'dayOfWeek' ? 'ìš”ì¼ë³„ í–‰ë™ ë°œìƒ ë¶„í¬' :
                        behaviorFilter.chartType === 'period' ? 'êµì‹œë³„ í–‰ë™ ë°œìƒ ë¶„í¬' :
                        behaviorFilter.chartType === 'weeklyGoalAchievement' ? 'ì£¼ë³„ ìˆ˜ì—…ëª©í‘œ ë„ë‹¬ ë¹ˆë„ (3~5ì )' :
                        behaviorFilter.chartType === 'weeklyEvalFreq' ? 'ì£¼ë³„ í–‰ë™ë°œìƒ ë¹ˆë„ (1~5ì )' :
                        behaviorFilter.chartType === 'dailyEvalFreq' ? 'ì¼ë³„ í–‰ë™ë°œìƒ ë¹ˆë„ (1~5ì )' :
                        'ì°¨íŠ¸'
                      } (í•™ìƒë³„ ì¶”ì´)
                    </h3>
                    <canvas id="behaviorLineChart"></canvas>
                  </div>

                </div>
              )}
            </div>
          )}


          {/* ìˆ˜ì—… í¸ì§‘ ëª¨ë‹¬ */}
          {editingLesson && (
            <div className="modal-overlay" onClick={() => setEditingLesson(null)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <h2 style={{ fontSize: 22, fontWeight: 800, color: 'white', marginBottom: 20 }}>
                  {editingLesson.id ? 'âœï¸ ìˆ˜ì—… ìˆ˜ì •' : 'â• ìˆ˜ì—… ì¶”ê°€'}
                </h2>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>ë‚ ì§œ</label>
                  <input
                    type="date"
                    value={editingLesson.date ? toLocalDateValue(editingLesson.date) : ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, date: e.target.value ? new Date(e.target.value).getTime() : null })}
                    className="form-control"
                  />
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>êµì‹œ</label>
                  <select
                    value={editingLesson.period || '1êµì‹œ'}
                    onChange={(e) => setEditingLesson({ ...editingLesson, period: e.target.value })}
                    className="form-select"
                  >
                    {PERIODS.map(period => <option key={period} value={period}>{period}</option>)}
                  </select>
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>ê³¼ëª©ëª… *</label>
                  <select
                    value={editingLesson.subject || ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, subject: e.target.value })}
                    className="form-select"
                    style={{
                      background: editingLesson.subject && SUBJECTS[editingLesson.subject]
                        ? SUBJECTS[editingLesson.subject].color
                        : 'rgba(255,255,255,0.1)',
                      color: 'white',
                    }}
                  >
                    <option value="" style={{ background: '#1e293b', color: 'white' }}>ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    {Object.entries(SUBJECTS).map(([subj, data]) => (
                      <option key={subj} value={subj} style={{ background: '#1e293b', color: 'white' }}>
                        {data.label}
                      </option>
                    ))}
                  </select>
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>ì œì¬/ë‹¨ì›</label>
                  <input
                    type="text"
                    placeholder="ì˜ˆ: ë§ì…ˆê³¼ ëº„ì…ˆ, ê°ì • í‘œí˜„í•˜ê¸°"
                    value={editingLesson.topic || ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, topic: e.target.value })}
                    className="form-control"
                  />
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>ëª©í‘œ</label>
                  <textarea
                    placeholder="ì˜ˆ: í•™ìƒì€ 10 ì´í•˜ì˜ ìˆ˜ë¥¼ ë”í•˜ê³  ëº„ ìˆ˜ ìˆë‹¤."
                    value={editingLesson.goal || ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, goal: e.target.value })}
                    rows={3}
                    className="form-textarea"
                  />
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>í™œë™</label>
                  <textarea
                    placeholder="ì˜ˆ: 1. ìˆ«ì ì¹´ë“œë¡œ ê²Œì„í•˜ê¸° 2. ì›Œí¬ì‹œíŠ¸ í™œë™ 3. ë§ˆë¬´ë¦¬ í™œë™"
                    value={editingLesson.activity || ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, activity: e.target.value })}
                    rows={4}
                    className="form-textarea"
                  />
                </div>

                {!editingLesson.id && (
                  <div className="form-field">
                    <label style={{ display: 'flex', alignItems: 'center', gap: 8, color: 'rgba(255,255,255,0.8)', fontWeight: 700 }}>
                      <input
                        type="checkbox"
                        checked={editingLesson.repeatWeekly || false}
                        onChange={(e) => setEditingLesson({ ...editingLesson, repeatWeekly: e.target.checked })}
                      />
                      ì„ íƒí•œ ê¸°ê°„ ë™ì•ˆ ë§¤ì£¼ ìˆ˜ì—…ìœ¼ë¡œ ì¶”ê°€
                    </label>
                    {editingLesson.repeatWeekly && (
                      <input
                        type="date"
                        value={editingLesson.repeatUntil || ''}
                        onChange={(e) => setEditingLesson({ ...editingLesson, repeatUntil: e.target.value })}
                        className="form-control"
                      />
                    )}
                  </div>
                )}

                {/* í•™ìƒ í‰ê°€ ì„¹ì…˜ (ìˆ˜ì—… ìˆ˜ì • ì‹œì—ë§Œ í‘œì‹œ) */}
                {editingLesson.id && (
                  <div style={{ marginTop: 24, padding: 16, background: 'rgba(0,0,0,0.2)', borderRadius: 12, border: '1px solid rgba(255,255,255,0.1)' }}>
                    <h3 style={{ fontSize: 16, fontWeight: 700, color: 'white', marginBottom: 12 }}>
                      ğŸ“Š í•™ìƒë³„ ìˆ˜ì—…ëª©í‘œ í‰ê°€
                    </h3>
                    <p style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)', marginBottom: 12 }}>
                      í‰ê°€ ì²™ë„: 0(ê²°ì„) / 1(ë¯¸ì°¸ì—¬) / 2(ë¯¸ë„ë‹¬) / 3(ìµœëŒ€ì´‰êµ¬) / 4(ì¼ë¶€ì´‰êµ¬) / 5(ëª©í‘œë‹¬ì„±)
                    </p>
                    <div className="student-eval-grid">
                      <div className="eval-cell" style={{ fontWeight: 900, background: 'rgba(139, 92, 246, 0.3)', color: '#c4b5fd' }}>í•™ìƒ</div>
                      {[0, 1, 2, 3, 4, 5].map(score => (
                        <div key={score} className="eval-cell" style={{ fontWeight: 900, background: 'rgba(139, 92, 246, 0.3)', color: '#c4b5fd' }}>
                          <div>{score}ì </div>
                          <div style={{ fontSize: 9, marginTop: 2 }}>{EVAL_SCORES[score].label}</div>
                        </div>
                      ))}
                      {[1, 2, 3, 4, 5, 6, 7].map(studentNum => {
                        const studentId = `í•™ìƒ${studentNum}`;
                        const evalKey = `${editingLesson.id}-${studentId}`;
                        const currentScore = state.studentEvals[evalKey]?.score;
                        return (
                          <React.Fragment key={studentNum}>
                            <div className="eval-cell" style={{ fontWeight: 700, background: 'rgba(59, 130, 246, 0.1)' }}>
                              {studentId}
                            </div>
                            {[0, 1, 2, 3, 4, 5].map(score => (
                              <div
                                key={score}
                                className={`eval-cell eval-score-${score} ${currentScore === score ? 'selected' : ''}`}
                                onClick={() => saveStudentEval(editingLesson.id, studentId, score)}
                                style={{
                                  cursor: 'pointer',
                                  fontWeight: currentScore === score ? 900 : 600,
                                }}
                              >
                                {currentScore === score ? 'âœ“' : '-'}
                              </div>
                            ))}
                          </React.Fragment>
                        );
                      })}
                    </div>
                  </div>
                )}

                {/* PBS í–‰ë™ ê¸°ë¡ ì„¹ì…˜ (ìˆ˜ì—… ìˆ˜ì • ì‹œì—ë§Œ í‘œì‹œ) */}
                {editingLesson.id && (
                  <div style={{ marginTop: 16, padding: 16, background: 'rgba(0,0,0,0.2)', borderRadius: 12, border: '1px solid rgba(255,255,255,0.1)' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                      <h3 style={{ fontSize: 16, fontWeight: 700, color: 'white' }}>
                        ğŸ¯ PBS í–‰ë™ ê¸°ë¡
                      </h3>
                      <button
                        style={{ ...styles.btn2, padding: '8px 12px', background: 'rgba(59, 130, 246, 0.3)' }}
                        onClick={() => {
                          const lessonDate = editingLesson.date ? new Date(editingLesson.date) : new Date();
                          setEditingBehavior({
                            timestamp: lessonDate.getTime(),
                            lessonId: editingLesson.id,
                            studentName: '',
                            behaviorType: 'POSITIVE',
                            antecedent: '',
                            behavior: '',
                            consequence: '',
                            frequency: 0,
                            interventionNote: ''
                          });
                        }}
                      >
                        â• í–‰ë™ ê¸°ë¡ ì¶”ê°€
                      </button>
                    </div>
                    <div style={{ maxHeight: 200, overflowY: 'auto' }}>
                      {(() => {
                        const lessonBehaviors = state.behaviorLog.filter(b => b.lessonId === editingLesson.id);
                        return lessonBehaviors.length === 0 ? (
                          <div style={{ textAlign: 'center', padding: 20, color: 'rgba(255,255,255,0.5)', fontSize: 12 }}>
                            ì´ ìˆ˜ì—…ì— ëŒ€í•œ í–‰ë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                          </div>
                        ) : (
                          <div style={{ display: 'grid', gap: 8 }}>
                            {lessonBehaviors.map(log => (
                              <div
                                key={log.id}
                                style={{
                                  padding: 10,
                                  background: 'rgba(0,0,0,0.2)',
                                  borderRadius: 8,
                                  border: '1px solid rgba(255,255,255,0.1)',
                                  fontSize: 12,
                                }}
                              >
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start' }}>
                                  <div style={{ flex: 1 }}>
                                    <div style={{ fontWeight: 700, color: BEHAVIOR_TYPES[log.behaviorType]?.color }}>
                                      {BEHAVIOR_TYPES[log.behaviorType]?.icon} {log.studentName}
                                    </div>
                                    <div style={{ color: 'rgba(255,255,255,0.8)', marginTop: 2 }}>
                                      {log.behavior || 'í–‰ë™ ë¯¸ì…ë ¥'}
                                    </div>
                                    <div style={{ color: 'rgba(255,255,255,0.6)', fontSize: 10, marginTop: 2 }}>
                                      {log.antecedent || 'ì„ í–‰ì‚¬ê±´ ë¯¸ì…ë ¥'} â†’ {log.consequence || 'í›„ì†ê²°ê³¼ ë¯¸ì…ë ¥'}
                                    </div>
                                  </div>
                                  <div style={{ display: 'flex', gap: 4 }}>
                                    <button
                                      style={{ ...styles.btn2, padding: '4px 8px', fontSize: 10, background: 'rgba(251, 191, 36, 0.2)' }}
                                      onClick={() => setEditingBehavior(log)}
                                    >
                                      âœï¸
                                    </button>
                                    <button
                                      style={{ ...styles.btn2, padding: '4px 8px', fontSize: 10, background: 'rgba(239, 68, 68, 0.2)' }}
                                      onClick={() => {
                                        if (confirm('ì´ í–‰ë™ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                          setState(p => ({
                                            ...p,
                                            behaviorLog: p.behaviorLog.filter(b => b.id !== log.id)
                                          }));
                                        }
                                      }}
                                    >
                                      ğŸ—‘ï¸
                                    </button>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        );
                      })()}
                    </div>
                  </div>
                )}

                <div style={{ display: 'flex', gap: 10, marginTop: 20 }}>
                  <button
                    style={{ ...styles.btn, flex: 1 }}
                    onClick={() => {
                      if (!editingLesson.subject || !editingLesson.date) {
                        alert('ê³¼ëª©ëª…ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                        return;
                      }
                      saveLesson(editingLesson);
                    }}
                  >
                    ğŸ’¾ ì €ì¥
                  </button>
                  {editingLesson.id && (
                    <button
                      style={{ ...styles.btn, background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}
                      onClick={() => {
                        deleteLesson(editingLesson.id);
                        setEditingLesson(null);
                      }}
                    >
                      ğŸ—‘ï¸ ì‚­ì œ
                    </button>
                  )}
                  <button
                    style={{ ...styles.btn2, padding: '12px 20px' }}
                    onClick={() => setEditingLesson(null)}
                  >
                    ì·¨ì†Œ
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* ì§‘ì¤‘ ê¸°ë¡ í¸ì§‘ ëª¨ë‹¬ */}
          {editingFocusHistory && (
            <div className="modal-overlay" onClick={() => setEditingFocusHistory(null)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <h2 style={{ fontSize: 22, fontWeight: 800, color: 'white', marginBottom: 20 }}>
                  âœï¸ ì§‘ì¤‘ ê¸°ë¡ ìˆ˜ì •
                </h2>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    ë©”ëª¨
                  </label>
                  <input
                    type="text"
                    placeholder="ì§‘ì¤‘ í™œë™ ë©”ëª¨"
                    value={editingFocusHistory.note || ''}
                    onChange={(e) => setEditingFocusHistory({ ...editingFocusHistory, note: e.target.value })}
                    className="form-control"
                  />
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    ì§‘ì¤‘ ì‹œê°„ (ë¶„)
                  </label>
                  <input
                    type="number"
                    min="1"
                    placeholder="ì§‘ì¤‘ ì‹œê°„"
                    value={editingFocusHistory.durationMin || ''}
                    onChange={(e) => setEditingFocusHistory({ ...editingFocusHistory, durationMin: parseInt(e.target.value) || 1 })}
                    className="form-control"
                  />
                </div>

                <div style={{ display: 'flex', gap: 10, marginTop: 20 }}>
                  <button style={styles.btn} onClick={saveFocusHistory}>
                    ğŸ’¾ ì €ì¥
                  </button>
                  <button style={{ ...styles.btn2, padding: '12px 20px' }} onClick={() => setEditingFocusHistory(null)}>
                    ì·¨ì†Œ
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* ì§‘ì¤‘ ì™„ë£Œ ëª¨ë‹¬ */}
          {showFocusComplete && (
            <div className="modal-overlay" onClick={() => {}}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: 500 }}>
                <h2 style={{ fontSize: 24, fontWeight: 800, color: 'white', marginBottom: 16, textAlign: 'center' }}>
                  â±ï¸ ì§‘ì¤‘ ì‹œê°„ ì¢…ë£Œ
                </h2>
                <p style={{ fontSize: 16, color: 'rgba(255,255,255,0.8)', marginBottom: 24, textAlign: 'center' }}>
                  ì§‘ì¤‘ ì‹œê°„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!<br />
                  ì§‘ì¤‘ì— ì„±ê³µí•˜ì…¨ë‚˜ìš”?
                </p>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16, marginTop: 24 }}>
                  <button
                    style={{
                      padding: '20px',
                      background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                      border: 'none',
                      borderRadius: 12,
                      color: 'white',
                      fontSize: 18,
                      fontWeight: 700,
                      cursor: 'pointer',
                      boxShadow: '0 4px 12px rgba(16, 185, 129, 0.3)',
                      transition: 'all 0.3s',
                    }}
                    onClick={() => completeFocusSession(true)}
                    onMouseEnter={(e) => e.target.style.transform = 'translateY(-2px)'}
                    onMouseLeave={(e) => e.target.style.transform = 'translateY(0)'}
                  >
                    âœ… ì„±ê³µ<br />
                    <span style={{ fontSize: 12, fontWeight: 400 }}>+100 í¬ì¸íŠ¸</span>
                  </button>
                  <button
                    style={{
                      padding: '20px',
                      background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                      border: 'none',
                      borderRadius: 12,
                      color: 'white',
                      fontSize: 18,
                      fontWeight: 700,
                      cursor: 'pointer',
                      boxShadow: '0 4px 12px rgba(239, 68, 68, 0.3)',
                      transition: 'all 0.3s',
                    }}
                    onClick={() => completeFocusSession(false)}
                    onMouseEnter={(e) => e.target.style.transform = 'translateY(-2px)'}
                    onMouseLeave={(e) => e.target.style.transform = 'translateY(0)'}
                  >
                    âŒ ì‹¤íŒ¨<br />
                    <span style={{ fontSize: 12, fontWeight: 400 }}>í¬ì¸íŠ¸ ì—†ìŒ</span>
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* ì¼ì • ê¸°ë¡ í¸ì§‘ ëª¨ë‹¬ */}
          {editingScheduleHistory && (
            <div className="modal-overlay" onClick={() => setEditingScheduleHistory(null)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <h2 style={{ fontSize: 22, fontWeight: 800, color: 'white', marginBottom: 20 }}>
                  âœï¸ ì¼ì • ê¸°ë¡ ìˆ˜ì •
                </h2>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    ì¼ì • ì´ë¦„
                  </label>
                  <input
                    type="text"
                    value={editingScheduleHistory.scheduleName}
                    disabled
                    className="form-control"
                    style={{ opacity: 0.6, cursor: 'not-allowed' }}
                  />
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    ì‹¤ì œ ë„ì°© ì‹œê°„ *
                  </label>
                  <input
                    type="datetime-local"
                    value={editingScheduleHistory.arrivalTimeLocal || ''}
                    onChange={(e) => setEditingScheduleHistory({ ...editingScheduleHistory, arrivalTimeLocal: e.target.value })}
                    className="form-control"
                  />
                </div>

                <div style={{ padding: 12, background: 'rgba(59, 130, 246, 0.1)', borderRadius: 8, marginTop: 12 }}>
                  <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)' }}>
                    ì˜ˆì • ë„ì°©: {formatDateTime(editingScheduleHistory.plannedArrivalTime)}
                  </div>
                  <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.5)', marginTop: 4 }}>
                    ì •ì‹œ ë„ì°© ì‹œ 100 í¬ì¸íŠ¸ íšë“
                  </div>
                </div>

                <div style={{ display: 'flex', gap: 10, marginTop: 20 }}>
                  <button style={styles.btn} onClick={saveScheduleHistory}>
                    ğŸ’¾ ì €ì¥
                  </button>
                  <button style={{ ...styles.btn2, padding: '12px 20px' }} onClick={() => setEditingScheduleHistory(null)}>
                    ì·¨ì†Œ
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* í–‰ë™ ê¸°ë¡ í¸ì§‘ ëª¨ë‹¬ */}
          {editingBehavior && (
            <div className="modal-overlay" onClick={() => setEditingBehavior(null)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <h2 style={{ fontSize: 22, fontWeight: 800, color: 'white', marginBottom: 20 }}>
                  {editingBehavior.id ? 'âœï¸ í–‰ë™ ê¸°ë¡ ìˆ˜ì •' : 'â• í–‰ë™ ê¸°ë¡ ì¶”ê°€'}
                </h2>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    í•™ìƒ ì´ë¦„ *
                  </label>
                  <input
                    type="text"
                    placeholder="í•™ìƒ ì´ë¦„ ì…ë ¥"
                    value={editingBehavior.studentName || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, studentName: e.target.value })}
                    className="form-control"
                    autoComplete="name"
                    inputMode="text"
                  />
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    í–‰ë™ ìœ í˜• *
                  </label>
                  <select
                    value={editingBehavior.behaviorType || 'TARGET'}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, behaviorType: e.target.value })}
                    className="form-select"
                  >
                    {Object.entries(BEHAVIOR_TYPES).map(([key, type]) => (
                      <option key={key} value={key}>{type.icon} {type.label}</option>
                    ))}
                  </select>
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    ì„ í–‰ì‚¬ê±´ (Antecedent) *
                  </label>
                  <input
                    type="text"
                    placeholder="í–‰ë™ ì „ ìƒí™© (ì˜ˆ: ê³¼ì œì œì‹œ, ë˜ë˜ìƒí˜¸ì‘ìš©)"
                    value={editingBehavior.antecedent || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, antecedent: e.target.value })}
                    className="form-control"
                    inputMode="text"
                    list="antecedents"
                  />
                  <datalist id="antecedents">
                    {COMMON_ANTECEDENTS.map(a => <option key={a} value={a} />)}
                  </datalist>
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    í–‰ë™ (Behavior) *
                  </label>
                  <input
                    type="text"
                    placeholder="ê´€ì°°ëœ í–‰ë™ (ì˜ˆ: ì†Œë¦¬ì§€ë¥´ê¸°, ìë¦¬ì´íƒˆ)"
                    value={editingBehavior.behavior || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, behavior: e.target.value })}
                    className="form-control"
                    inputMode="text"
                    list="behaviors"
                  />
                  <datalist id="behaviors">
                    {COMMON_BEHAVIORS.map(b => <option key={b} value={b} />)}
                  </datalist>
                  <div style={{ display: 'flex', gap: 6, flexWrap: 'wrap', marginTop: 8 }}>
                    {COMMON_BEHAVIORS.slice(0, 5).map(b => (
                      <button
                        key={b}
                        style={{ padding: '6px 12px', background: 'rgba(59, 130, 246, 0.2)', border: '1px solid rgba(59, 130, 246, 0.3)', borderRadius: 6, color: 'white', fontSize: 12, cursor: 'pointer' }}
                        onClick={() => setEditingBehavior({ ...editingBehavior, behavior: b })}
                      >
                        {b}
                      </button>
                    ))}
                  </div>
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    í›„ì†ê²°ê³¼ (Consequence) *
                  </label>
                  <input
                    type="text"
                    placeholder="í–‰ë™ í›„ ê²°ê³¼ (ì˜ˆ: ê´€ì‹¬ì œê³µ, í† í°ì œê³µ)"
                    value={editingBehavior.consequence || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, consequence: e.target.value })}
                    className="form-control"
                    inputMode="text"
                    list="consequences"
                  />
                  <datalist id="consequences">
                    {COMMON_CONSEQUENCES.map(c => <option key={c} value={c} />)}
                  </datalist>
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 10, fontWeight: 700 }}>
                    í–‰ë™ ë°œìƒ ë¹ˆë„ *
                  </label>
                  <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>
                    {[0, 1, 2, 3, 4, 5].map(freq => (
                      <button
                        key={freq}
                        type="button"
                        style={{
                          flex: '1 1 auto',
                          minWidth: '60px',
                          padding: '12px 16px',
                          borderRadius: 10,
                          border: editingBehavior.frequency === freq ? '2px solid #3b82f6' : '1px solid rgba(255,255,255,0.2)',
                          background: editingBehavior.frequency === freq
                            ? 'linear-gradient(135deg, rgba(59, 130, 246, 0.4), rgba(99, 102, 241, 0.4))'
                            : 'rgba(255,255,255,0.05)',
                          color: 'white',
                          fontSize: 16,
                          fontWeight: editingBehavior.frequency === freq ? 800 : 600,
                          cursor: 'pointer',
                          transition: 'all 0.2s',
                        }}
                        onClick={() => setEditingBehavior({ ...editingBehavior, frequency: freq })}
                      >
                        <div style={{ fontSize: 18, marginBottom: 2 }}>{freq}íšŒ</div>
                        <div style={{ fontSize: 10, opacity: 0.7 }}>
                          {freq === 0 && 'ì—†ìŒ'}
                          {freq === 1 && '1íšŒ'}
                          {freq === 2 && '2íšŒ'}
                          {freq === 3 && '3íšŒ'}
                          {freq === 4 && '4íšŒ'}
                          {freq === 5 && '5íšŒ+'}
                        </div>
                      </button>
                    ))}
                  </div>
                  <p style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginTop: 8 }}>
                    ğŸ’¡ í–‰ë™ì´ ê´€ì°°ëœ íšŸìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš” (0íšŒ = ë°œìƒí•˜ì§€ ì•ŠìŒ, 5íšŒ = 5íšŒ ì´ìƒ)
                  </p>
                </div>

                <div className="form-field">
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    ì¤‘ì¬ ë…¸íŠ¸ (ì„ íƒì‚¬í•­)
                  </label>
                  <textarea
                    placeholder="ì‚¬ìš©í•œ ì¤‘ì¬ ì „ëµ, íš¨ê³¼, í–¥í›„ ê³„íš ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”"
                    value={editingBehavior.interventionNote || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, interventionNote: e.target.value })}
                    rows={4}
                    className="form-textarea"
                  />
                </div>

                <div style={{ display: 'flex', gap: 10, marginTop: 20 }}>
                  <button
                    style={{ ...styles.btn, flex: 1 }}
                    onClick={() => {
                      if (!editingBehavior.studentName || !editingBehavior.behavior || !editingBehavior.antecedent || !editingBehavior.consequence) {
                        alert('í•™ìƒ ì´ë¦„, ì„ í–‰ì‚¬ê±´, í–‰ë™, í›„ì†ê²°ê³¼ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                        return;
                      }
                      saveBehaviorLog(editingBehavior);
                    }}
                  >
                    ğŸ’¾ ì €ì¥
                  </button>
                  {editingBehavior.id && (
                    <button
                      style={{ ...styles.btn, background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}
                      onClick={() => {
                        deleteBehaviorLog(editingBehavior.id);
                        setEditingBehavior(null);
                      }}
                    >
                      ğŸ—‘ï¸ ì‚­ì œ
                    </button>
                  )}
                  <button
                    style={{ ...styles.btn2, padding: '12px 20px' }}
                    onClick={() => setEditingBehavior(null)}
                  >
                    ì·¨ì†Œ
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    console.log('========================================');
    console.log('âœ… App component defined successfully');
    console.log('========================================');

    // Error boundary wrapper component
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null };
      }

      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }

      componentDidCatch(error, errorInfo) {
        console.error('React Error:', error, errorInfo);
      }

      render() {
        if (this.state.hasError) {
          return (
            <div style={{ padding: 40, background: '#1a1f3a', color: 'white', minHeight: '100vh' }}>
              <h1 style={{ color: '#ef4444' }}>âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h1>
              <p style={{ marginTop: 20, color: 'rgba(255,255,255,0.8)' }}>
                {this.state.error?.toString()}
              </p>
              <button
                onClick={() => { localStorage.clear(); window.location.reload(); }}
                style={{ marginTop: 20, padding: '12px 24px', background: '#3b82f6', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer', fontSize: 16 }}
              >
                ğŸ”„ ë°ì´í„° ì´ˆê¸°í™” í›„ ìƒˆë¡œê³ ì¹¨
              </button>
            </div>
          );
        }
        return this.props.children;
      }
    }

    console.log('========================================');
    console.log('ğŸ¬ Starting React render process...');
    console.log('========================================');

    // Render with error handling
    try {
      console.log('Creating React root...');
      const root = ReactDOM.createRoot(document.getElementById('root'));
      console.log('âœ“ React root created');

      console.log('Rendering App component...');
      root.render(
        <ErrorBoundary>
          <App />
        </ErrorBoundary>
      );
      console.log('========================================');
      console.log('âœ… Render call completed successfully!');
      console.log('========================================');
    } catch (error) {
      console.error('========================================');
      console.error('âŒ CRITICAL ERROR during render:', error);
      console.error('========================================');
      document.getElementById('root').innerHTML = `
        <div style="padding: 40px; background: #1a1f3a; color: white; min-height: 100vh;">
          <h1 style="color: #ef4444;">âŒ ì´ˆê¸°í™” ì˜¤ë¥˜</h1>
          <p style="margin-top: 20px;">${error.toString()}</p>
          <button onclick="localStorage.clear(); window.location.reload();"
            style="margin-top: 20px; padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
            ğŸ”„ ë°ì´í„° ì´ˆê¸°í™” í›„ ìƒˆë¡œê³ ì¹¨
          </button>
        </div>
      `;
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ADHD íŠ¹ìˆ˜êµì‚¬ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ Pro v2.0</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body { 
      margin: 0; 
      padding: 0; 
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0a0e27 100%);
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      color: #e2e8f0;
      min-height: 100vh;
    }
    
    .scrollable {
      -webkit-overflow-scrolling: touch;
      overflow-y: auto;
    }
    
    button, input[type="checkbox"] {
      min-height: 44px;
      min-width: 44px;
    }
    
    #root {
      min-height: 100vh;
      min-height: -webkit-fill-available;
    }

    .editable-input {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      color: white;
      font-size: inherit;
      font-weight: inherit;
      width: 100%;
      outline: none;
      padding: 4px 8px;
      border-radius: 6px;
      transition: all 0.2s;
      font-family: inherit;
    }
    
    .editable-input:focus {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
    }

    .draggable-task {
      cursor: move;
      transition: transform 0.2s, opacity 0.2s;
    }

    .draggable-task:active {
      opacity: 0.5;
      cursor: grabbing;
    }

    .stat-card {
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }

    /* ì ‘ê¸°/í¼ì¹˜ê¸° ì• ë‹ˆë©”ì´ì…˜ */
    .collapsible {
      overflow: hidden;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
    }

    .collapsed {
      max-height: 0 !important;
      opacity: 0;
    }

    .collapse-toggle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      background: rgba(139, 92, 246, 0.2);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 8px;
      color: #a78bfa;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .collapse-toggle:hover {
      background: rgba(139, 92, 246, 0.3);
      transform: scale(1.05);
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideInUp 0.4s ease-out;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      max-width: 900px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 24px;
      animation: slideInUp 0.3s;
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring-circle {
      transition: stroke-dashoffset 0.5s;
    }

    input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: rgba(255,255,255,0.1);
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3b82f6;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3b82f6;
      cursor: pointer;
      border: none;
    }

    .token-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2));
      border: 1px solid rgba(251, 191, 36, 0.3);
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      color: #fbbf24;
    }

    .level-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.2));
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      color: #a78bfa;
    }

    /* ì‹œê°„í‘œ ìŠ¤íƒ€ì¼ */
    .timetable {
      display: grid;
      grid-template-columns: 80px repeat(5, 1fr);
      gap: 2px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .timetable-cell {
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      min-height: 100px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .timetable-cell:hover {
      background: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.3);
      transform: scale(1.02);
    }

    .timetable-header {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(99, 102, 241, 0.3));
      border: 1px solid rgba(59, 130, 246, 0.4);
      font-weight: 900;
      text-align: center;
      padding: 14px;
      font-size: 14px;
      color: #60a5fa;
    }

    .lesson-card {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(168, 85, 247, 0.3));
      border: 1px solid rgba(139, 92, 246, 0.4);
      border-radius: 8px;
      padding: 10px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 6px;
    }

    .lesson-card:hover {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.4), rgba(168, 85, 247, 0.4));
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .lesson-card-title {
      font-weight: 700;
      color: #c4b5fd;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .lesson-card-subtitle {
      font-size: 10px;
      color: rgba(255,255,255,0.7);
    }

    /* í•™ìƒ í‰ê°€ ê·¸ë¦¬ë“œ */
    .student-eval-grid {
      display: grid;
      grid-template-columns: 120px repeat(6, 1fr);
      gap: 8px;
      margin-top: 16px;
    }

    .eval-cell {
      padding: 12px 8px;
      background: rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
      font-weight: 600;
    }

    .eval-cell:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .eval-cell.selected {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.3);
      border-width: 2px;
      font-weight: 900;
    }

    .eval-score-0 { 
      background: linear-gradient(135deg, rgba(107, 114, 128, 0.3), rgba(75, 85, 99, 0.3)); 
      border-color: rgba(107, 114, 128, 0.5);
    }
    .eval-score-0.selected { background: rgba(107, 114, 128, 0.5); }
    
    .eval-score-1 { 
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.3)); 
      border-color: rgba(239, 68, 68, 0.5);
    }
    .eval-score-1.selected { background: rgba(239, 68, 68, 0.5); }
    
    .eval-score-2 { 
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.3)); 
      border-color: rgba(251, 191, 36, 0.5);
    }
    .eval-score-2.selected { background: rgba(251, 191, 36, 0.5); }
    
    .eval-score-3 { 
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.3)); 
      border-color: rgba(59, 130, 246, 0.5);
    }
    .eval-score-3.selected { background: rgba(59, 130, 246, 0.5); }
    
    .eval-score-4 { 
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.3)); 
      border-color: rgba(34, 197, 94, 0.5);
    }
    .eval-score-4.selected { background: rgba(34, 197, 94, 0.5); }
    
    .eval-score-5 { 
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.3)); 
      border-color: rgba(16, 185, 129, 0.5);
    }
    .eval-score-5.selected { background: rgba(16, 185, 129, 0.5); }

    /* íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .file-input-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border: none;
      border-radius: 10px;
      color: white;
      fontSize: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .file-input-label:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    input[type="file"] {
      display: none;
    }

    /* ì•Œë¦¼ ë°°ë„ˆ */
    .alert-banner {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 12px;
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);
      z-index: 2000;
      animation: slideInRight 0.3s, pulse 1s infinite;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
    .chart-container {
      position: relative;
      height: 300px;
      margin: 20px 0;
      padding: 20px;
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* ì§„í–‰ë¥  ìë™ í‘œì‹œ */
    .auto-progress-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.2));
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      color: #10b981;
    }

    /* ë°˜ì‘í˜• ë””ìì¸ - ëª¨ë°”ì¼ ìµœì í™” */

    /* í–„ë²„ê±° ë©”ë‰´ */
    .hamburger-menu {
      display: none;
      flex-direction: column;
      gap: 4px;
      padding: 10px;
      background: rgba(99, 102, 241, 0.3);
      border: 1px solid rgba(99, 102, 241, 0.5);
      border-radius: 8px;
      cursor: pointer;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1001;
    }

    .hamburger-line {
      width: 25px;
      height: 3px;
      background: white;
      border-radius: 2px;
      transition: all 0.3s;
    }

    .mobile-nav-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      padding: 80px 20px 20px;
      overflow-y: auto;
    }

    .mobile-nav-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 32px;
      color: white;
      cursor: pointer;
      padding: 10px;
    }

    /* ê²€ìƒ‰ë°” ìŠ¤íƒ€ì¼ */
    .search-container {
      position: sticky;
      top: 0;
      z-index: 999;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .search-input {
      width: 100%;
      padding: 12px 40px 12px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      font-size: 14px;
      outline: none;
      transition: all 0.3s;
    }

    .search-input:focus {
      background: rgba(255, 255, 255, 0.15);
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 20px;
      right: 20px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      margin-top: 8px;
      max-height: 400px;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .search-result-item {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: all 0.2s;
    }

    .search-result-item:hover {
      background: rgba(59, 130, 246, 0.2);
    }

    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (ëª¨ë°”ì¼) */
    .bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 8px;
      z-index: 100;
      box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.4);
    }

    .bottom-nav-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 4px;
    }

    .bottom-nav-btn {
      padding: 8px;
      background: transparent;
      border: none;
      border-radius: 8px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: all 0.2s;
    }

    .bottom-nav-btn.active {
      background: rgba(99, 102, 241, 0.3);
      color: white;
    }

    .bottom-nav-btn span {
      font-size: 20px;
    }

    /* íƒœë¸”ë¦¿ (768px - 1024px) */
    @media (max-width: 1024px) and (min-width: 768px) {
      .timetable {
        grid-template-columns: 70px repeat(5, 1fr);
        font-size: 12px;
      }

      .student-eval-grid {
        grid-template-columns: 100px repeat(6, 1fr);
        gap: 6px;
        font-size: 12px;
      }

      .modal-content {
        max-width: 700px;
        padding: 20px;
      }
    }

    /* ëª¨ë°”ì¼ (<768px) */
    @media (max-width: 768px) {
      body {
        padding-bottom: 70px;
      }

      .hamburger-menu {
        display: flex;
      }

      .bottom-nav {
        display: block;
      }

      .timetable {
        grid-template-columns: 50px repeat(5, 1fr);
        font-size: 10px;
        gap: 1px;
      }

      .student-eval-grid {
        grid-template-columns: 70px repeat(6, 1fr);
        gap: 3px;
        font-size: 10px;
      }

      .timetable-cell {
        min-height: 70px;
        padding: 6px;
      }

      .lesson-card {
        padding: 6px;
        font-size: 10px;
        margin-bottom: 4px;
      }

      .modal-content {
        max-width: 100%;
        width: 100%;
        max-height: 100vh;
        border-radius: 0;
        padding: 16px;
      }

      .chart-container {
        height: 250px;
        padding: 12px;
      }

      /* ì¹´ë“œ ë·°ë¡œ ë³€í™˜ */
      .mobile-card-view {
        display: block !important;
      }

      .mobile-card-item {
        padding: 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        margin-bottom: 12px;
      }

      /* ë„¤ë¹„ê²Œì´ì…˜ ìˆ¨ê¹€ (í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ì‚¬ìš©) */
      .desktop-nav {
        display: none !important;
      }

      /* ê²€ìƒ‰ë°” ëª¨ë°”ì¼ ìµœì í™” */
      .search-container {
        padding: 10px 15px;
      }

      .search-input {
        font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
      }
    }

    /* ê°€ë¡œ ëª¨ë“œ */
    @media (max-width: 768px) and (orientation: landscape) {
      .bottom-nav {
        padding: 4px;
      }

      .bottom-nav-btn {
        padding: 6px;
        font-size: 10px;
      }

      .bottom-nav-btn span {
        font-size: 16px;
      }
    }

    /* ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì§€ì› */
    .swipeable {
      touch-action: pan-y;
      user-select: none;
    }

    /* í„°ì¹˜ í”¼ë“œë°± */
    @media (hover: none) and (pointer: coarse) {
      button:active, .clickable:active {
        transform: scale(0.95);
        opacity: 0.8;
      }
    }

    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #4f46e5, #4338ca);
    }
  </style>
</head>
<body>
  <div id="root"></div>
<script type="text/babel">
    const { useEffect, useMemo, useRef, useState, useCallback } = React;

    const LS_KEY = "adhd_pro_manager_v2_upgraded";

    function nowMs() { return Date.now(); }
    function uuid() {
      return Math.random().toString(16).slice(2) + "-" + Math.random().toString(16).slice(2);
    }

    function toLocalDatetimeValue(ts) {
      if (!ts) return "";
      const d = new Date(ts);
      const pad = (n) => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function fromLocalDatetimeValue(v) {
      if (!v) return null;
      const t = new Date(v).getTime();
      return Number.isFinite(t) ? t : null;
    }

    function toLocalDateValue(ts) {
      if (!ts) return "";
      const d = new Date(ts);
      const pad = (n) => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
    }

    function clamp01(x) { return Math.min(1, Math.max(0, x)); }

    // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
    function requestNotificationPermission() {
      if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission();
      }
    }

    // ì•Œë¦¼ í‘œì‹œ (ì†Œë¦¬ + ì§„ë™ + ì‹œê°ì  ì•Œë¦¼)
    function showNotification(title, body, options = {}) {
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(title, {
          body,
          icon: 'ğŸš—',
          badge: 'â°',
          vibrate: [200, 100, 200, 100, 200],
          requireInteraction: true,
          tag: options.tag || 'default',
          ...options
        });
      }
      
      // ì•Œë¦¼ìŒ ì¬ìƒ
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
      } catch (e) {
        console.log('Audio notification failed:', e);
      }
    }

    const CATEGORIES = {
      IEP: { label: 'IEP í‰ê°€', icon: 'ğŸ“‹', color: '#3b82f6' },
      PBS: { label: 'PBS ì‘ì—…', icon: 'ğŸ¯', color: '#8b5cf6' },
      SUPERVISION: { label: 'ìˆ˜í¼ë¹„ì „', icon: 'ğŸ‘¥', color: '#ec4899' },
      PLATFORM: { label: 'í”Œë«í¼ ê°œë°œ', icon: 'ğŸ’»', color: '#10b981' },
      BEHAVIOR: { label: 'í–‰ë™ì¤‘ì¬', icon: 'ğŸ“Š', color: '#f59e0b' },
      ADMIN: { label: 'í–‰ì •ì—…ë¬´', icon: 'ğŸ“', color: '#6366f1' },
      STUDENT: { label: 'í•™ìƒ ì§€ì›', icon: 'ğŸ“', color: '#06b6d4' },
      RESEARCH: { label: 'ì—°êµ¬/ìë£Œ', icon: 'ğŸ”¬', color: '#84cc16' },
      TEACHING: { label: 'ìˆ˜ì—… ì¤€ë¹„', icon: 'ğŸ‘¨â€ğŸ«', color: '#f43f5e' },
      LECTURE: { label: 'ê°•ì˜ í™œë™', icon: 'ğŸ¤', color: '#14b8a6' },
      PERSONAL: { label: 'ê°œì¸ ìƒí™œ', icon: 'ğŸ ', color: '#a855f7' },
    };

    const PRIORITIES = {
      URGENT: { label: 'ê¸´ê¸‰', icon: 'ğŸ”´', value: 4 },
      HIGH: { label: 'ë†’ìŒ', icon: 'ğŸŸ ', value: 3 },
      MEDIUM: { label: 'ë³´í†µ', icon: 'ğŸŸ¡', value: 2 },
      LOW: { label: 'ë‚®ìŒ', icon: 'ğŸŸ¢', value: 1 },
    };

    const DAYS_OF_WEEK = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
    const PERIODS = ['1êµì‹œ', '2êµì‹œ', '3êµì‹œ', '4êµì‹œ', '5êµì‹œ', '6êµì‹œ', '7êµì‹œ'];

    const EVAL_SCORES = {
      0: { label: 'ê²°ì„', color: '#6b7280', description: 'ìˆ˜ì—… ë¶ˆì°¸' },
      1: { label: 'ë¯¸ì°¸ì—¬', color: '#ef4444', description: 'ìˆ˜ì—… ì°¸ì—¬í•˜ì§€ ì•ŠìŒ' },
      2: { label: 'ë¯¸ë„ë‹¬', color: '#fbbf24', description: 'ëª©í‘œ ë¯¸ë‹¬ì„±' },
      3: { label: 'ìµœëŒ€ì´‰êµ¬', color: '#3b82f6', description: 'ì „ì ì¸ ë„ì›€ í•„ìš”' },
      4: { label: 'ì¼ë¶€ì´‰êµ¬', color: '#22c55e', description: 'ë¶€ë¶„ì  ë„ì›€ í•„ìš”' },
      5: { label: 'ëª©í‘œë‹¬ì„±', color: '#10b981', description: 'ë…ë¦½ì  ìˆ˜í–‰' },
    };

    // í–‰ë™ ìœ í˜• (PBS/í–‰ë™ì§€ì›)
    const BEHAVIOR_TYPES = {
      TARGET: { label: 'í‘œì í–‰ë™', color: '#ef4444', icon: 'ğŸ¯' },
      REPLACEMENT: { label: 'ëŒ€ì²´í–‰ë™', color: '#10b981', icon: 'âœ¨' },
      POSITIVE: { label: 'ê¸ì •í–‰ë™', color: '#3b82f6', icon: 'ğŸ‘' },
    };

    // ì¼ë°˜ì ì¸ í–‰ë™ ëª©ë¡ (ë¹ ë¥¸ ì¶”ê°€ìš©)
    const COMMON_BEHAVIORS = [
      'ì†Œë¦¬ì§€ë¥´ê¸°', 'ìë¦¬ì´íƒˆ', 'ë¬¼ê±´ë˜ì§€ê¸°', 'ìí•´í–‰ë™', 'ê³µê²©í–‰ë™',
      'ê³¼ì œê±°ë¶€', 'ì£¼ì˜ì§‘ì¤‘', 'ê¸ì •ì  ìƒí˜¸ì‘ìš©', 'ì§€ì‹œë”°ë¥´ê¸°', 'ìê¸°ì¡°ì ˆ'
    ];

    // ì¼ë°˜ì ì¸ ì„ í–‰ì‚¬ê±´
    const COMMON_ANTECEDENTS = [
      'ê³¼ì œì œì‹œ', 'ë˜ë˜ìƒí˜¸ì‘ìš©', 'ì „í™˜ìƒí™©', 'ìš”êµ¬ê±°ë¶€', 'ê°ê°ìê·¹',
      'ê´€ì‹¬ìš”êµ¬', 'íšŒí”¼', 'ì˜ˆì¸¡ë¶ˆê°€ëŠ¥í•œ ìƒí™©'
    ];

    // ì¼ë°˜ì ì¸ í›„ì†ê²°ê³¼
    const COMMON_CONSEQUENCES = [
      'ê´€ì‹¬ì œê³µ', 'ê³¼ì œì¤‘ë‹¨', 'í† í°ì œê³µ', 'êµ¬ë‘ì¹­ì°¬', 'ë¬´ì‹œ',
      'ì§„ì •ì‹œê°„', 'ì„ íƒê¶Œì œê³µ', 'ëŒ€ì²´í–‰ë™ì´‰êµ¬'
    ];

    const DEFAULT_STATE = {
      points: 0,
      level: 1,
      tasks: [],
      focus: {
        running: false,
        paused: false,
        durationSec: 120,
        startedTs: null,
        pausedAt: null,
        elapsedBeforePause: 0,
        taskId: null,
        note: "",
      },
      schedules: [],
      filters: {
        category: 'ALL',
        priority: 'ALL',
        searchText: '',
      },
      completedSprints: [],
      behaviorLog: [],
      lessons: [], // ìˆ˜ì—… ë°ì´í„°
      studentEvals: {}, // í•™ìƒë³„ í‰ê°€ ë°ì´í„° { lessonId: { studentId: score } }
      collapsedItems: {},
      alertedSchedules: {},
      recentSearches: [], // ìµœê·¼ ê²€ìƒ‰ ê¸°ë¡ (ìµœëŒ€ 10ê°œ)
    };

    function loadState() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return DEFAULT_STATE;
        const parsed = JSON.parse(raw);
        if (!parsed || typeof parsed !== "object") return DEFAULT_STATE;
        
        return {
          ...DEFAULT_STATE,
          ...parsed,
          tasks: Array.isArray(parsed.tasks) ? parsed.tasks : DEFAULT_STATE.tasks,
          focus: { ...DEFAULT_STATE.focus, ...(parsed.focus || {}) },
          schedules: Array.isArray(parsed.schedules) ? parsed.schedules : DEFAULT_STATE.schedules,
          filters: { ...DEFAULT_STATE.filters, ...(parsed.filters || {}) },
          completedSprints: Array.isArray(parsed.completedSprints) ? parsed.completedSprints : [],
          behaviorLog: Array.isArray(parsed.behaviorLog) ? parsed.behaviorLog : [],
          lessons: Array.isArray(parsed.lessons) ? parsed.lessons : [],
          studentEvals: parsed.studentEvals || {},
          collapsedItems: parsed.collapsedItems || {},
          alertedSchedules: parsed.alertedSchedules || {},
          recentSearches: Array.isArray(parsed.recentSearches) ? parsed.recentSearches : [],
        };
      } catch {
        return DEFAULT_STATE;
      }
    }

    function saveState(st) {
      localStorage.setItem(LS_KEY, JSON.stringify(st));
    }

    // CSV ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
    function exportToCSV(data, filename) {
      const csvContent = data.map(row => row.map(cell => {
        const cellStr = String(cell || '');
        return cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')
          ? `"${cellStr.replace(/"/g, '""')}"`
          : cellStr;
      }).join(',')).join('\n');

      const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }

    function parseCSV(text) {
      // ì…ë ¥ ê²€ì¦
      if (!text || typeof text !== 'string') {
        throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ CSV í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.');
      }

      // BOM (Byte Order Mark) ì œê±°
      if (text.charCodeAt(0) === 0xFEFF) {
        text = text.slice(1);
      }

      // ë¹ˆ í…ìŠ¤íŠ¸ ì²˜ë¦¬
      if (text.trim().length === 0) {
        return [];
      }

      const rows = [];
      let currentRow = [];
      let currentCell = '';
      let inQuotes = false;
      let quoteStarted = false; // ì…€ì´ ë”°ì˜´í‘œë¡œ ì‹œì‘í–ˆëŠ”ì§€ ì¶”ì 

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const nextChar = text[i + 1];

        if (char === '"') {
          if (!inQuotes && currentCell === '') {
            // ì…€ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ë”°ì˜´í‘œ ë°œê²¬
            inQuotes = true;
            quoteStarted = true;
          } else if (inQuotes && nextChar === '"') {
            // ì´ìŠ¤ì¼€ì´í”„ëœ ë”°ì˜´í‘œ ("" -> ")
            currentCell += '"';
            i++;
          } else if (inQuotes) {
            // ë”°ì˜´í‘œ ì¢…ë£Œ
            inQuotes = false;
          } else {
            // ë”°ì˜´í‘œë¡œ ì‹œì‘í•˜ì§€ ì•Šì€ ì…€ ë‚´ë¶€ì˜ ë”°ì˜´í‘œëŠ” ë¦¬í„°ëŸ´ë¡œ ì²˜ë¦¬
            currentCell += char;
          }
        } else if (char === ',' && !inQuotes) {
          // í•„ë“œ êµ¬ë¶„ì
          currentRow.push(currentCell);
          currentCell = '';
          quoteStarted = false;
        } else if ((char === '\n' || char === '\r') && !inQuotes) {
          // í–‰ ì¢…ë£Œ
          currentRow.push(currentCell);

          // ë¹ˆ í–‰ì´ ì•„ë‹Œ ê²½ìš°ë§Œ ì¶”ê°€ (ëª¨ë“  ì…€ì´ ë¹„ì–´ìˆì§€ ì•Šì€ ê²½ìš°)
          if (currentRow.some(cell => cell.trim() !== '')) {
            rows.push(currentRow);
          }

          currentRow = [];
          currentCell = '';
          quoteStarted = false;

          // CRLF ì²˜ë¦¬
          if (char === '\r' && nextChar === '\n') {
            i++;
          }
        } else {
          currentCell += char;
        }
      }

      // ë§ˆì§€ë§‰ ì…€ê³¼ í–‰ ì²˜ë¦¬
      if (currentCell || currentRow.length > 0) {
        currentRow.push(currentCell);
        // ë¹ˆ í–‰ì´ ì•„ë‹Œ ê²½ìš°ë§Œ ì¶”ê°€
        if (currentRow.some(cell => cell.trim() !== '')) {
          rows.push(currentRow);
        }
      }

      // ë”°ì˜´í‘œê°€ ì œëŒ€ë¡œ ë‹«íˆì§€ ì•Šì€ ê²½ìš° ê²½ê³ 
      if (inQuotes) {
        console.warn('CSV íŒŒì‹± ê²½ê³ : ë‹«íˆì§€ ì•Šì€ ë”°ì˜´í‘œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }

      // í–‰ ê¸¸ì´ ì •ê·œí™” (ê°€ì¥ ê¸´ í–‰ì„ ê¸°ì¤€ìœ¼ë¡œ ë¹ˆ ì…€ ì¶”ê°€)
      const maxLength = Math.max(...rows.map(row => row.length));
      rows.forEach(row => {
        while (row.length < maxLength) {
          row.push('');
        }
      });

      return rows;
    }

    // ì§„í–‰ë¥  ìë™ ê³„ì‚° (ì„¸ë¶€ ë‹¨ê³„ ê¸°ë°˜)
    function calculateAutoProgress(task) {
      if (!task.steps || task.steps.length === 0) return task.progress || 0;
      const completed = task.steps.filter(s => s.done).length;
      return Math.round((completed / task.steps.length) * 100);
    }

    // í–‰ë™ ë¡œê·¸ CSV ë‚´ë³´ë‚´ê¸°
    function exportBehaviorLogCSV(behaviorLog) {
      const headers = ['ID', 'ë‚ ì§œì‹œê°„', 'í•™ìƒì´ë¦„', 'í–‰ë™ìœ í˜•', 'ì„ í–‰ì‚¬ê±´', 'í–‰ë™', 'í›„ì†ê²°ê³¼', 'ë¹ˆë„', 'ê°•ë„', 'ì§€ì†ì‹œê°„(ë¶„)', 'ì¤‘ì¬ë…¸íŠ¸'];
      const rows = [headers];

      behaviorLog.forEach(log => {
        rows.push([
          log.id,
          new Date(log.timestamp).toLocaleString('ko-KR'),
          log.studentName || '',
          BEHAVIOR_TYPES[log.behaviorType]?.label || log.behaviorType,
          log.antecedent || '',
          log.behavior || '',
          log.consequence || '',
          log.frequency || 1,
          log.intensity || 1,
          log.duration || 0,
          log.interventionNote || ''
        ]);
      });

      exportToCSV(rows, `í–‰ë™ë¡œê·¸_${new Date().toISOString().slice(0,10)}.csv`);
    }

    // ì°¨íŠ¸ë¥¼ PNGë¡œ ë‚´ë³´ë‚´ê¸°
    function exportChartAsPNG(chartId, filename) {
      const canvas = document.getElementById(chartId);
      if (canvas) {
        const link = document.createElement('a');
        link.download = filename;
        link.href = canvas.toDataURL('image/png');
        link.click();
      }
    }

    // ì›í˜• íƒ€ì´ë¨¸ ì»´í¬ë„ŒíŠ¸
    function CircularTimer({ remainingMs, totalMs, size = 200 }) {
      const progress = totalMs > 0 ? clamp01(remainingMs / totalMs) : 1;
      const radius = (size - 20) / 2;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference * (1 - progress);
      
      const minutes = Math.floor(remainingMs / 60000);
      const seconds = Math.floor((remainingMs % 60000) / 1000);

      return (
        <div style={{ position: 'relative', width: size, height: size, margin: '0 auto' }}>
          <svg width={size} height={size} style={{ transform: 'rotate(-90deg)' }}>
            <circle
              cx={size / 2}
              cy={size / 2}
              r={radius}
              fill="none"
              stroke="rgba(255,255,255,0.1)"
              strokeWidth="10"
            />
            <circle
              cx={size / 2}
              cy={size / 2}
              r={radius}
              fill="none"
              stroke={progress > 0.5 ? '#10b981' : progress > 0.2 ? '#f59e0b' : '#ef4444'}
              strokeWidth="10"
              strokeDasharray={circumference}
              strokeDashoffset={offset}
              style={{ transition: 'stroke-dashoffset 0.3s linear, stroke 0.3s' }}
            />
          </svg>
          <div style={{
            position: 'absolute',
            top: '50%',
            left: '50%',
            transform: 'translate(-50%, -50%)',
            textAlign: 'center',
          }}>
            <div style={{ fontSize: 48, fontWeight: 900, color: 'white' }}>
              {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
            </div>
            <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.7)', marginTop: 8 }}>
              {progress > 0.5 ? 'ì§‘ì¤‘ ì¤‘!' : progress > 0.2 ? 'ì¡°ê¸ˆë§Œ ë”!' : 'ê±°ì˜ ë‹¤ ì™”ì–´ìš”!'}
            </div>
          </div>
        </div>
      );
    }

    // ì¶œë°œ ì•ŒëŒ ì¹´ìš´íŠ¸ë‹¤ìš´ ë°” (ìˆ˜ì •: ì•ŒëŒ ê¸°ëŠ¥ ê°•í™”)
    function CountdownBar({ schedule, now, onAlert }) {
      if (!schedule.arrivalTs) return null;

      const departTs = schedule.arrivalTs - schedule.departBeforeMin * 60 * 1000;
      const remaining = departTs - now;
      const totalTime = schedule.departBeforeMin * 60 * 1000;
      const progress = Math.max(0, Math.min(1, remaining / totalTime));

      const isPast = remaining < 0;
      const isUrgent = remaining > 0 && remaining < 15 * 60 * 1000;
      const isDepartTime = remaining <= 0 && remaining > -2000; // ì•ŒëŒ ìœˆë„ìš°: ì¶œë°œ ì‹œê°„ ì „í›„ 2ì´ˆ

      useEffect(() => {
        if (isDepartTime && onAlert) {
          onAlert(schedule.id);
        }
      }, [isDepartTime, schedule.id, onAlert]);

      const hrs = Math.floor(Math.abs(remaining) / (1000 * 60 * 60));
      const mins = Math.floor((Math.abs(remaining) % (1000 * 60 * 60)) / (1000 * 60));

      return (
        <div style={{
          padding: 16,
          borderRadius: 12,
          background: isPast ? 'rgba(239, 68, 68, 0.2)' : isUrgent ? 'rgba(251, 191, 36, 0.2)' : 'rgba(16, 185, 129, 0.2)',
          border: `2px solid ${isPast ? '#ef4444' : isUrgent ? '#fbbf24' : '#10b981'}`,
          marginBottom: 12,
          animation: isUrgent ? 'pulse 1s infinite' : 'none',
        }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>
            <div style={{ fontSize: 16, fontWeight: 700, color: 'white' }}>
              {schedule.name}
            </div>
            <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.8)' }}>
              {new Date(schedule.arrivalTs).toLocaleString('ko-KR', { 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit' 
              })}
            </div>
          </div>

          <div style={{
            height: 10,
            borderRadius: 5,
            background: 'rgba(0,0,0,0.3)',
            overflow: 'hidden',
            marginBottom: 10,
          }}>
            <div style={{
              height: '100%',
              width: `${progress * 100}%`,
              background: isPast ? 'linear-gradient(90deg, #ef4444, #dc2626)' : 
                         isUrgent ? 'linear-gradient(90deg, #fbbf24, #f59e0b)' : 
                         'linear-gradient(90deg, #10b981, #059669)',
              transition: 'width 1s linear',
            }} />
          </div>

          <div style={{ fontSize: 14, color: 'rgba(255,255,255,0.95)', fontWeight: 700 }}>
            {isPast ? (
              <span>âš ï¸ ì¶œë°œ ì‹œê°„ {hrs > 0 ? `${hrs}ì‹œê°„ ` : ''}{mins}ë¶„ ì§€ë‚¨</span>
            ) : (
              <span>
                {isUrgent && 'â° '}
                ì¶œë°œê¹Œì§€ {hrs > 0 ? `${hrs}ì‹œê°„ ` : ''}{mins}ë¶„ ë‚¨ìŒ
              </span>
            )}
          </div>
        </div>
      );
    }

    // ìº˜ë¦°ë” ì»´í¬ë„ŒíŠ¸
    function Calendar({ tasks, schedules, lessons }) {
      const [currentMonth, setCurrentMonth] = useState(new Date());

      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const daysInMonth = lastDay.getDate();

      const prevMonth = () => setCurrentMonth(new Date(year, month - 1, 1));
      const nextMonth = () => setCurrentMonth(new Date(year, month + 1, 1));

      const days = [];
      for (let i = 0; i < startDay; i++) {
        days.push(<div key={`empty-${i}`} style={{ padding: 8 }} />);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dayTasks = tasks.filter(t => {
          if (!t.deadlineTs) return false;
          const d = new Date(t.deadlineTs);
          return d.getFullYear() === year && d.getMonth() === month && d.getDate() === day;
        });

        const daySchedules = schedules.filter(s => {
          if (!s.arrivalTs) return false;
          const d = new Date(s.arrivalTs);
          return d.getFullYear() === year && d.getMonth() === month && d.getDate() === day;
        });

        const dayLessons = lessons.filter(l => {
          if (!l.date) return false;
          const d = new Date(l.date);
          return d.getFullYear() === year && d.getMonth() === month && d.getDate() === day;
        });

        const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();

        days.push(
          <div
            key={day}
            style={{
              padding: 8,
              borderRadius: 8,
              background: isToday ? 'rgba(59, 130, 246, 0.2)' : 'rgba(255,255,255,0.02)',
              border: isToday ? '2px solid #3b82f6' : '1px solid rgba(255,255,255,0.05)',
              minHeight: 100,
            }}
          >
            <div style={{ 
              fontSize: 14, 
              fontWeight: isToday ? 900 : 700, 
              color: isToday ? '#3b82f6' : 'white',
              marginBottom: 6,
            }}>
              {day}
            </div>

            {dayTasks.map(t => (
              <div
                key={t.id}
                style={{
                  fontSize: 10,
                  padding: '3px 6px',
                  borderRadius: 4,
                  background: CATEGORIES[t.category]?.color || '#6b7280',
                  color: 'white',
                  marginBottom: 2,
                  overflow: 'hidden',
                  textOverflow: 'ellipsis',
                  whiteSpace: 'nowrap',
                }}
                title={t.title}
              >
                {t.title}
              </div>
            ))}

            {daySchedules.map(s => (
              <div
                key={s.id}
                style={{
                  fontSize: 10,
                  padding: '3px 6px',
                  borderRadius: 4,
                  background: '#10b981',
                  color: 'white',
                  marginBottom: 2,
                  overflow: 'hidden',
                  textOverflow: 'ellipsis',
                  whiteSpace: 'nowrap',
                }}
                title={s.name}
              >
                ğŸš— {s.name}
              </div>
            ))}

            {dayLessons.map(l => (
              <div
                key={l.id}
                style={{
                  fontSize: 10,
                  padding: '3px 6px',
                  borderRadius: 4,
                  background: '#8b5cf6',
                  color: 'white',
                  marginBottom: 2,
                  overflow: 'hidden',
                  textOverflow: 'ellipsis',
                  whiteSpace: 'nowrap',
                }}
                title={l.subject}
              >
                ğŸ‘¨â€ğŸ« {l.subject}
              </div>
            ))}
          </div>
        );
      }

      return (
        <div>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
            <button
              style={{
                padding: '10px 18px',
                background: 'rgba(255,255,255,0.1)',
                border: '1px solid rgba(255,255,255,0.2)',
                borderRadius: 10,
                color: 'white',
                cursor: 'pointer',
                fontSize: 14,
                fontWeight: 700,
              }}
              onClick={prevMonth}
            >
              â—€ ì´ì „
            </button>
            <div style={{ fontSize: 20, fontWeight: 900, color: 'white' }}>
              {year}ë…„ {month + 1}ì›”
            </div>
            <button
              style={{
                padding: '10px 18px',
                background: 'rgba(255,255,255,0.1)',
                border: '1px solid rgba(255,255,255,0.2)',
                borderRadius: 10,
                color: 'white',
                cursor: 'pointer',
                fontSize: 14,
                fontWeight: 700,
              }}
              onClick={nextMonth}
            >
              ë‹¤ìŒ â–¶
            </button>
          </div>

          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(7, 1fr)',
            gap: 4,
          }}>
            {['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].map(d => (
              <div key={d} style={{ 
                textAlign: 'center', 
                fontSize: 13, 
                fontWeight: 700, 
                color: 'rgba(255,255,255,0.7)',
                padding: 8,
              }}>
                {d}
              </div>
            ))}
            {days}
          </div>
        </div>
      );
    }
// ë©”ì¸ App ì»´í¬ë„ŒíŠ¸
    function App() {
      const [state, setState] = useState(loadState);
      const [view, setView] = useState('dashboard');
      const [tick, setTick] = useState(0);
      const [editingLesson, setEditingLesson] = useState(null);
      const [showAlert, setShowAlert] = useState(null);
      const [selectedStudent, setSelectedStudent] = useState(null);
      const [searchQuery, setSearchQuery] = useState('');
      const [searchResults, setSearchResults] = useState([]);
      const [showSearch, setShowSearch] = useState(false);
      const [editingBehavior, setEditingBehavior] = useState(null);
      const [showMobileMenu, setShowMobileMenu] = useState(false);
      const [behaviorFilter, setBehaviorFilter] = useState({ dateRange: 30, student: 'ALL', behaviorType: 'ALL' });
      const [reportType, setReportType] = useState('weekly');
      const searchInputRef = useRef(null);

      useEffect(() => {
        saveState(state);
      }, [state]);

      // 1ì´ˆë§ˆë‹¤ í‹± ì—…ë°ì´íŠ¸ (ì•ŒëŒ ì²´í¬ìš©)
      useEffect(() => {
        const iv = setInterval(() => setTick(t => t + 1), 1000);
        return () => clearInterval(iv);
      }, []);

      useEffect(() => {
        requestNotificationPermission();
      }, []);

      // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Ctrl/Cmd + Kë¡œ ê²€ìƒ‰ ì—´ê¸°)
      useEffect(() => {
        const handleKeyDown = (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            setShowSearch(true);
            setTimeout(() => searchInputRef.current?.focus(), 100);
          }
          if (e.key === 'Escape' && showSearch) {
            setShowSearch(false);
            setSearchQuery('');
            setSearchResults([]);
          }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [showSearch]);

      // ì‹¤ì‹œê°„ ê²€ìƒ‰ ê¸°ëŠ¥
      useEffect(() => {
        if (!searchQuery.trim()) {
          setSearchResults([]);
          return;
        }

        const query = searchQuery.toLowerCase();
        const results = [];

        // ìˆ˜ì—… ê²€ìƒ‰
        state.lessons.forEach(lesson => {
          if (lesson.subject?.toLowerCase().includes(query) ||
              lesson.topic?.toLowerCase().includes(query) ||
              lesson.goal?.toLowerCase().includes(query)) {
            results.push({
              type: 'ìˆ˜ì—…',
              title: lesson.subject,
              subtitle: `${lesson.dayOfWeek}ìš”ì¼ ${lesson.period} - ${lesson.topic || ''}`,
              data: lesson,
              action: () => { setEditingLesson(lesson); setShowSearch(false); }
            });
          }
        });

        // ê³¼ì œ ê²€ìƒ‰
        state.tasks.forEach(task => {
          if (task.title?.toLowerCase().includes(query)) {
            results.push({
              type: 'ê³¼ì œ',
              title: task.title,
              subtitle: `${CATEGORIES[task.category]?.label} - ${PRIORITIES[task.priority]?.label}`,
              data: task,
              action: () => { setView('tasks'); setShowSearch(false); }
            });
          }
        });

        // ì¼ì • ê²€ìƒ‰
        state.schedules.forEach(schedule => {
          if (schedule.name?.toLowerCase().includes(query)) {
            results.push({
              type: 'ì¼ì •',
              title: schedule.name,
              subtitle: new Date(schedule.arrivalTs).toLocaleString('ko-KR'),
              data: schedule,
              action: () => { setView('schedule'); setShowSearch(false); }
            });
          }
        });

        // í–‰ë™ ë¡œê·¸ ê²€ìƒ‰
        state.behaviorLog.forEach(log => {
          if (log.behavior?.toLowerCase().includes(query) ||
              log.studentName?.toLowerCase().includes(query) ||
              log.interventionNote?.toLowerCase().includes(query)) {
            results.push({
              type: 'í–‰ë™',
              title: `${log.studentName} - ${log.behavior}`,
              subtitle: new Date(log.timestamp).toLocaleString('ko-KR'),
              data: log,
              action: () => { setView('behavior'); setEditingBehavior(log); setShowSearch(false); }
            });
          }
        });

        setSearchResults(results.slice(0, 20)); // ìµœëŒ€ 20ê°œë§Œ í‘œì‹œ
      }, [searchQuery, state.lessons, state.tasks, state.schedules, state.behaviorLog]);

      // ê²€ìƒ‰ ê¸°ë¡ ì €ì¥
      const saveSearchHistory = (query) => {
        if (!query.trim()) return;
        setState(p => ({
          ...p,
          recentSearches: [query, ...p.recentSearches.filter(s => s !== query)].slice(0, 10)
        }));
      };

      // ì¶œë°œ ì•ŒëŒ í•¸ë“¤ëŸ¬ (ìˆ˜ì •: ì œëŒ€ë¡œ ìš¸ë¦¬ë„ë¡)
      const handleScheduleAlert = useCallback((scheduleId) => {
        // setState í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì‹  stateì— ì ‘ê·¼í•˜ê³  stale closure ë°©ì§€
        setState(prevState => {
          // ì´ë¯¸ ì•Œë¦¼ì„ ë³´ë‚¸ ê²½ìš° ìƒíƒœ ë³€ê²½ ì—†ì´ ë¦¬í„´
          if (prevState.alertedSchedules[scheduleId]) {
            return prevState;
          }

          // ìµœì‹  stateì—ì„œ ìŠ¤ì¼€ì¤„ ì°¾ê¸°
          const schedule = prevState.schedules.find(s => s.id === scheduleId);
          if (!schedule) {
            return prevState;
          }

          // ì•Œë¦¼ í‘œì‹œ
          showNotification(
            'ğŸš— ì¶œë°œ ì‹œê°„ì…ë‹ˆë‹¤!',
            `${schedule.name} - ì§€ê¸ˆ ë°”ë¡œ ì¶œë°œí•˜ì„¸ìš”!`,
            { tag: scheduleId, requireInteraction: true }
          );

          setShowAlert({
            title: 'ğŸš— ì¶œë°œ ì‹œê°„!',
            message: `${schedule.name}\nì§€ê¸ˆ ì¶œë°œí•˜ì„¸ìš”!`,
            schedule: schedule
          });

          // 5ì´ˆ í›„ ì•Œë¦¼ ë°°ë„ˆ ìë™ ì œê±°
          setTimeout(() => setShowAlert(null), 5000);

          // ì•Œë¦¼ ìƒíƒœ ì—…ë°ì´íŠ¸
          return {
            ...prevState,
            alertedSchedules: { ...prevState.alertedSchedules, [scheduleId]: true },
          };
        });
      }, []); // ë¹ˆ ì˜ì¡´ì„± ë°°ì—´ë¡œ í•¨ìˆ˜ ì¬ìƒì„± ë°©ì§€, setState í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë¡œ ìµœì‹  state ë³´ì¥

      // ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€
      const toggleCollapse = (id) => {
        setState(p => ({
          ...p,
          collapsedItems: {
            ...p.collapsedItems,
            [id]: !p.collapsedItems[id],
          },
        }));
      };

      // ê³¼ì œ ì¶”ê°€
      const addTask = () => {
        const newTask = {
          id: uuid(),
          title: 'ìƒˆ ê³¼ì œ',
          category: 'TEACHING',
          priority: 'MEDIUM',
          progress: 0,
          steps: [],
          tags: [],
          createdAt: nowMs(),
        };
        setState(p => ({ ...p, tasks: [...p.tasks, newTask] }));
      };

      // ê³¼ì œ ì‚­ì œ
      const deleteTask = (taskId) => {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setState(p => ({ ...p, tasks: p.tasks.filter(t => t.id !== taskId) }));
        }
      };

      // ê³¼ì œ ìˆ˜ì •
      const updateTask = (taskId, updates) => {
        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => t.id === taskId ? { ...t, ...updates } : t)
        }));
      };

      // ì„¸ë¶€ ë‹¨ê³„ í† ê¸€
      const toggleStep = (taskId, stepId) => {
        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== taskId) return t;
            return {
              ...t,
              steps: t.steps.map(s => s.id === stepId ? { ...s, done: !s.done } : s)
            };
          })
        }));
      };

      // ì„¸ë¶€ ë‹¨ê³„ ì¶”ê°€
      const addStep = (taskId) => {
        const stepText = prompt('ì„¸ë¶€ ë‹¨ê³„ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        if (!stepText) return;
        
        setState(p => ({
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== taskId) return t;
            return {
              ...t,
              steps: [...(t.steps || []), { id: uuid(), text: stepText, done: false }]
            };
          })
        }));
      };

      // ìˆ˜ì—… ì¶”ê°€/ìˆ˜ì •
      const saveLesson = (lesson) => {
        if (lesson.id) {
          // ìˆ˜ì •
          setState(p => ({
            ...p,
            lessons: p.lessons.map(l => l.id === lesson.id ? lesson : l)
          }));
        } else {
          // ì¶”ê°€
          setState(p => ({
            ...p,
            lessons: [...p.lessons, { ...lesson, id: uuid() }]
          }));
        }
        setEditingLesson(null);
      };

      // ìˆ˜ì—… ì‚­ì œ
      const deleteLesson = (lessonId) => {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setState(p => ({
            ...p,
            lessons: p.lessons.filter(l => l.id !== lessonId),
            studentEvals: Object.fromEntries(
              Object.entries(p.studentEvals).filter(([key]) => !key.startsWith(lessonId))
            )
          }));
        }
      };

      // í•™ìƒ í‰ê°€ ì €ì¥
      const saveStudentEval = (lessonId, studentId, score, memo = '') => {
        setState(p => ({
          ...p,
          studentEvals: {
            ...p.studentEvals,
            [`${lessonId}-${studentId}`]: { score, memo, updatedAt: nowMs() }
          }
        }));
      };

      // ìˆ˜ì—… CSV ë‚´ë³´ë‚´ê¸°
      const exportLessonsCSV = () => {
        const headers = ['ID', 'ë‚ ì§œ', 'ìš”ì¼', 'êµì‹œ', 'ê³¼ëª©', 'ì œì¬', 'ëª©í‘œ', 'í™œë™'];
        const rows = [headers];
        
        state.lessons.forEach(lesson => {
          rows.push([
            lesson.id,
            lesson.date ? new Date(lesson.date).toLocaleDateString('ko-KR') : '',
            lesson.dayOfWeek || '',
            lesson.period || '',
            lesson.subject || '',
            lesson.topic || '',
            lesson.goal || '',
            lesson.activity || ''
          ]);
        });

        exportToCSV(rows, `ìˆ˜ì—…ê´€ë¦¬_${new Date().toISOString().slice(0,10)}.csv`);
      };

      // í‰ê°€ CSV ë‚´ë³´ë‚´ê¸°
      const exportEvalsCSV = () => {
        const headers = ['ìˆ˜ì—…ID', 'ë‚ ì§œ', 'ê³¼ëª©', 'í•™ìƒ', 'í‰ê°€ì ìˆ˜', 'ë©”ëª¨'];
        const rows = [headers];
        
        Object.entries(state.studentEvals).forEach(([key, evalData]) => {
          const [lessonId, studentId] = key.split('-');
          const lesson = state.lessons.find(l => l.id === lessonId);
          
          rows.push([
            lessonId,
            lesson?.date ? new Date(lesson.date).toLocaleDateString('ko-KR') : '',
            lesson?.subject || '',
            studentId,
            evalData.score,
            evalData.memo || ''
          ]);
        });

        exportToCSV(rows, `í•™ìƒí‰ê°€_${new Date().toISOString().slice(0,10)}.csv`);
      };

      // CSV ê°€ì ¸ì˜¤ê¸°
      const importLessonsCSV = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // íŒŒì¼ í¬ê¸° ê²€ì¦ (10MB ì œí•œ)
        if (file.size > 10 * 1024 * 1024) {
          alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 10MB ì´í•˜ì˜ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
          e.target.value = '';
          return;
        }

        const reader = new FileReader();

        reader.onload = (evt) => {
          try {
            const text = evt.target.result;

            if (!text || typeof text !== 'string') {
              throw new Error('íŒŒì¼ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            const rows = parseCSV(text);

            if (!Array.isArray(rows) || rows.length < 2) {
              alert('ì˜¬ë°”ë¥¸ CSV íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤. ìµœì†Œ 2ì¤„(í—¤ë” + ë°ì´í„°) ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤.');
              return;
            }

            const newLessons = [];
            const errors = [];

            for (let i = 1; i < rows.length; i++) {
              try {
                const [id, date, dayOfWeek, period, subject, topic, goal, activity] = rows[i];
                if (subject) {
                  newLessons.push({
                    id: id || uuid(),
                    date: date ? new Date(date).getTime() : null,
                    dayOfWeek,
                    period,
                    subject,
                    topic,
                    goal,
                    activity
                  });
                }
              } catch (rowError) {
                errors.push(`${i + 1}ë²ˆì§¸ í–‰ ì²˜ë¦¬ ì‹¤íŒ¨: ${rowError.message}`);
              }
            }

            if (errors.length > 0) {
              console.warn('CSV ê°€ì ¸ì˜¤ê¸° ì¤‘ ì¼ë¶€ ì˜¤ë¥˜ ë°œìƒ:', errors);
              if (!confirm(`${errors.length}ê°œì˜ í–‰ì„ ì²˜ë¦¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n${newLessons.length}ê°œì˜ ìˆ˜ì—…ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
              }
            }

            if (newLessons.length === 0) {
              alert('ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
              return;
            }

            if (confirm(`${newLessons.length}ê°œì˜ ìˆ˜ì—…ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
              setState(p => ({
                ...p,
                lessons: [...p.lessons, ...newLessons]
              }));
              alert(`${newLessons.length}ê°œì˜ ìˆ˜ì—…ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
            }
          } catch (error) {
            console.error('CSV íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
            alert(`CSV íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${error.message}\n\níŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
          }
        };

        reader.onerror = (error) => {
          console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
          alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. íŒŒì¼ì´ ì†ìƒë˜ì—ˆê±°ë‚˜ ì ‘ê·¼ ê¶Œí•œì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        };

        reader.onabort = () => {
          console.warn('íŒŒì¼ ì½ê¸°ê°€ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
          alert('íŒŒì¼ ì½ê¸°ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        };

        try {
          reader.readAsText(file, 'UTF-8');
        } catch (error) {
          console.error('FileReader ì‹œì‘ ì˜¤ë¥˜:', error);
          alert(`íŒŒì¼ ì½ê¸°ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:\n${error.message}`);
        }

        e.target.value = '';
      };

      // í–‰ë™ ë¡œê·¸ ì¶”ê°€/ìˆ˜ì •
      const saveBehaviorLog = (behaviorLog) => {
        if (behaviorLog.id) {
          // ìˆ˜ì •
          setState(p => ({
            ...p,
            behaviorLog: p.behaviorLog.map(b => b.id === behaviorLog.id ? behaviorLog : b)
          }));
        } else {
          // ì¶”ê°€
          setState(p => ({
            ...p,
            behaviorLog: [...p.behaviorLog, { ...behaviorLog, id: uuid(), timestamp: nowMs() }]
          }));
        }
        setEditingBehavior(null);
      };

      // í–‰ë™ ë¡œê·¸ ì‚­ì œ
      const deleteBehaviorLog = (logId) => {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setState(p => ({
            ...p,
            behaviorLog: p.behaviorLog.filter(b => b.id !== logId)
          }));
        }
      };

      // ì£¼ê°„ ìˆ˜ì—… ë³´ê³ ì„œ ìƒì„±
      const generateWeeklyLessonReport = () => {
        const now = Date.now();
        const weekAgo = now - 7 * 24 * 60 * 60 * 1000;
        const recentLessons = state.lessons.filter(l => l.date && l.date >= weekAgo);

        const headers = ['ì£¼ê°„ ìˆ˜ì—… ë³´ê³ ì„œ', '', '', ''];
        const rows = [
          headers,
          ['ë‚ ì§œ', 'ê³¼ëª©', 'ì œì¬', 'ëª©í‘œ'],
          ...recentLessons.map(l => [
            l.date ? new Date(l.date).toLocaleDateString('ko-KR') : '',
            l.subject || '',
            l.topic || '',
            l.goal || ''
          ])
        ];

        exportToCSV(rows, `ì£¼ê°„ìˆ˜ì—…ë³´ê³ ì„œ_${new Date().toISOString().slice(0,10)}.csv`);
      };

      // ì›”ê°„ í–‰ë™ ë³´ê³ ì„œ ìƒì„±
      const generateMonthlyBehaviorReport = () => {
        const now = Date.now();
        const monthAgo = now - 30 * 24 * 60 * 60 * 1000;
        const recentBehaviors = state.behaviorLog.filter(b => b.timestamp >= monthAgo);

        // í–‰ë™ ìœ í˜•ë³„ ì§‘ê³„
        const behaviorCounts = {};
        recentBehaviors.forEach(b => {
          const type = BEHAVIOR_TYPES[b.behaviorType]?.label || b.behaviorType;
          behaviorCounts[type] = (behaviorCounts[type] || 0) + 1;
        });

        const headers = ['ì›”ê°„ í–‰ë™ ë³´ê³ ì„œ', '', ''];
        const rows = [
          headers,
          ['ê¸°ê°„', `${new Date(monthAgo).toLocaleDateString('ko-KR')} ~ ${new Date(now).toLocaleDateString('ko-KR')}`, ''],
          ['ì´ ê¸°ë¡ ìˆ˜', recentBehaviors.length, ''],
          [],
          ['í–‰ë™ ìœ í˜•', 'ë°œìƒ íšŸìˆ˜', 'ë¹„ìœ¨(%)'],
          ...Object.entries(behaviorCounts).map(([type, count]) => [
            type,
            count,
            ((count / recentBehaviors.length) * 100).toFixed(1)
          ])
        ];

        exportToCSV(rows, `ì›”ê°„í–‰ë™ë³´ê³ ì„œ_${new Date().toISOString().slice(0,10)}.csv`);
      };

      // PDF ë³´ê³ ì„œ ìƒì„±
      const generatePDFReport = async (reportType) => {
        try {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // í•œê¸€ í°íŠ¸ ì„¤ì • (ê¸°ë³¸ í°íŠ¸ ì‚¬ìš©)
          doc.setFont('helvetica');

          let yPos = 20;

          if (reportType === 'weekly') {
            doc.setFontSize(18);
            doc.text('Weekly Lesson Report', 20, yPos);
            yPos += 15;

            doc.setFontSize(12);
            const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
            const recentLessons = state.lessons.filter(l => l.date && l.date >= weekAgo);

            doc.text(`Period: ${new Date(weekAgo).toLocaleDateString()} - ${new Date().toLocaleDateString()}`, 20, yPos);
            yPos += 10;
            doc.text(`Total Lessons: ${recentLessons.length}`, 20, yPos);
            yPos += 15;

            recentLessons.forEach(lesson => {
              if (yPos > 270) {
                doc.addPage();
                yPos = 20;
              }
              doc.text(`Subject: ${lesson.subject || ''}`, 20, yPos);
              yPos += 7;
              doc.text(`Topic: ${lesson.topic || ''}`, 20, yPos);
              yPos += 7;
              doc.text(`Goal: ${lesson.goal || ''}`, 20, yPos);
              yPos += 12;
            });
          } else if (reportType === 'monthly') {
            doc.setFontSize(18);
            doc.text('Monthly Behavior Report', 20, yPos);
            yPos += 15;

            doc.setFontSize(12);
            const monthAgo = Date.now() - 30 * 24 * 60 * 60 * 1000;
            const recentBehaviors = state.behaviorLog.filter(b => b.timestamp >= monthAgo);

            doc.text(`Period: ${new Date(monthAgo).toLocaleDateString()} - ${new Date().toLocaleDateString()}`, 20, yPos);
            yPos += 10;
            doc.text(`Total Incidents: ${recentBehaviors.length}`, 20, yPos);
            yPos += 15;

            const behaviorCounts = {};
            recentBehaviors.forEach(b => {
              const type = BEHAVIOR_TYPES[b.behaviorType]?.label || b.behaviorType;
              behaviorCounts[type] = (behaviorCounts[type] || 0) + 1;
            });

            Object.entries(behaviorCounts).forEach(([type, count]) => {
              if (yPos > 270) {
                doc.addPage();
                yPos = 20;
              }
              doc.text(`${type}: ${count} incidents (${((count/recentBehaviors.length)*100).toFixed(1)}%)`, 20, yPos);
              yPos += 10;
            });
          }

          doc.save(`${reportType}_report_${new Date().toISOString().slice(0,10)}.pdf`);
          alert('PDF ë³´ê³ ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } catch (error) {
          console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
          alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      };

      const styles = {
        container: {
          maxWidth: 1400,
          margin: '0 auto',
          padding: 20,
          minHeight: '100vh',
        },
        card: {
          background: 'rgba(30, 41, 59, 0.4)',
          backdropFilter: 'blur(20px)',
          borderRadius: 20,
          padding: 24,
          marginBottom: 20,
          border: '1px solid rgba(255, 255, 255, 0.1)',
          boxShadow: '0 8px 32px rgba(0, 0, 0, 0.4)',
        },
        h1: {
          fontSize: 32,
          fontWeight: 900,
          background: 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)',
          WebkitBackgroundClip: 'text',
          WebkitTextFillColor: 'transparent',
          margin: '0 0 12px 0',
          textAlign: 'center',
        },
        h2: {
          fontSize: 22,
          fontWeight: 800,
          color: 'white',
          margin: '0 0 16px 0',
          display: 'flex',
          alignItems: 'center',
          gap: 8,
        },
        btn: {
          padding: '12px 20px',
          background: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)',
          border: 'none',
          borderRadius: 10,
          color: 'white',
          fontSize: 14,
          fontWeight: 700,
          cursor: 'pointer',
          transition: 'all 0.3s',
          boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)',
        },
        btn2: {
          padding: '10px 16px',
          background: 'rgba(255, 255, 255, 0.1)',
          border: '1px solid rgba(255, 255, 255, 0.2)',
          borderRadius: 8,
          color: 'white',
          fontSize: 13,
          fontWeight: 600,
          cursor: 'pointer',
          transition: 'all 0.2s',
        },
        nav: {
          display: 'grid',
          gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))',
          gap: 10,
          marginBottom: 20,
        },
        navBtn: {
          padding: 14,
          background: 'rgba(255, 255, 255, 0.05)',
          border: '1px solid rgba(255, 255, 255, 0.1)',
          borderRadius: 12,
          color: 'white',
          fontSize: 13,
          fontWeight: 700,
          cursor: 'pointer',
          transition: 'all 0.2s',
          textAlign: 'center',
        },
      };

      const filteredTasks = useMemo(() => {
        return state.tasks.filter(t => {
          if (state.filters.category !== 'ALL' && t.category !== state.filters.category) return false;
          if (state.filters.priority !== 'ALL' && t.priority !== state.filters.priority) return false;
          if (state.filters.searchText) {
            const search = state.filters.searchText.toLowerCase();
            if (!t.title.toLowerCase().includes(search) && 
                !(t.tags || []).some(tag => tag.toLowerCase().includes(search))) {
              return false;
            }
          }
          return true;
        });
      }, [state.tasks, state.filters]);

      const stats = useMemo(() => {
        const total = state.tasks.length;
        const completed = state.tasks.filter(t => calculateAutoProgress(t) === 100).length;
        const urgent = state.tasks.filter(t => t.priority === 'URGENT').length;
        const avgProgress = total > 0 ? state.tasks.reduce((sum, t) => sum + calculateAutoProgress(t), 0) / total : 0;
        const level = Math.floor(state.points / 100) + 1;
        
        return { total, completed, urgent, points: state.points, level, avgProgress };
      }, [state.tasks, state.points]);

      return (
        <div style={styles.container}>
          {/* ì•Œë¦¼ ë°°ë„ˆ */}
          {showAlert && (
            <div className="alert-banner">
              <div style={{ fontSize: 20, marginBottom: 8 }}>{showAlert.title}</div>
              <div style={{ fontSize: 14 }}>{showAlert.message}</div>
              <button
                style={{ marginTop: 10, padding: '6px 12px', background: 'white', color: '#ef4444', border: 'none', borderRadius: 6, cursor: 'pointer', fontWeight: 700 }}
                onClick={() => setShowAlert(null)}
              >
                í™•ì¸
              </button>
            </div>
          )}

          <h1 style={styles.h1}>ğŸ¯ ADHD íŠ¹ìˆ˜êµì‚¬ í†µí•© ê´€ë¦¬ Pro v2.0</h1>
          
          <div style={{ display: 'flex', gap: 12, justifyContent: 'center', marginBottom: 20 }}>
            <div className="token-badge">
              ğŸ’ {state.points} í¬ì¸íŠ¸
            </div>
            <div className="level-badge">
              â­ Level {stats.level}
            </div>
          </div>

          {/* ê²€ìƒ‰ ë°” */}
          {showSearch && (
            <div className="search-container" style={{ position: 'relative', marginBottom: 20 }}>
              <input
                ref={searchInputRef}
                type="text"
                className="search-input"
                placeholder="ğŸ” ê²€ìƒ‰... (Ctrl/Cmd + K)"
                value={searchQuery}
                onChange={(e) => { setSearchQuery(e.target.value); saveSearchHistory(e.target.value); }}
              />
              {searchResults.length > 0 && (
                <div className="search-results">
                  {searchResults.map((result, idx) => (
                    <div
                      key={idx}
                      className="search-result-item"
                      onClick={result.action}
                    >
                      <div style={{ fontSize: 12, color: '#8b5cf6', fontWeight: 700, marginBottom: 4 }}>
                        {result.type}
                      </div>
                      <div style={{ fontSize: 14, color: 'white', fontWeight: 600, marginBottom: 2 }}>
                        {result.title}
                      </div>
                      <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)' }}>
                        {result.subtitle}
                      </div>
                    </div>
                  ))}
                </div>
              )}
              {state.recentSearches.length > 0 && searchQuery === '' && (
                <div className="search-results">
                  <div style={{ padding: '12px 16px', fontSize: 12, color: 'rgba(255,255,255,0.5)', fontWeight: 700 }}>
                    ìµœê·¼ ê²€ìƒ‰
                  </div>
                  {state.recentSearches.map((search, idx) => (
                    <div
                      key={idx}
                      className="search-result-item"
                      onClick={() => setSearchQuery(search)}
                    >
                      <div style={{ fontSize: 14, color: 'white' }}>
                        ğŸ•’ {search}
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}

          {/* í–„ë²„ê±° ë©”ë‰´ (ëª¨ë°”ì¼) */}
          <div className="hamburger-menu" onClick={() => setShowMobileMenu(true)}>
            <div className="hamburger-line"></div>
            <div className="hamburger-line"></div>
            <div className="hamburger-line"></div>
          </div>

          {/* ëª¨ë°”ì¼ ë©”ë‰´ ì˜¤ë²„ë ˆì´ */}
          {showMobileMenu && (
            <div className="mobile-nav-overlay">
              <div className="mobile-nav-close" onClick={() => setShowMobileMenu(false)}>âœ•</div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                {[
                  { key: 'dashboard', icon: 'ğŸ“Š', label: 'ëŒ€ì‹œë³´ë“œ' },
                  { key: 'tasks', icon: 'âœ…', label: 'ê³¼ì œ' },
                  { key: 'teaching', icon: 'ğŸ‘¨â€ğŸ«', label: 'ìˆ˜ì—…ê´€ë¦¬' },
                  { key: 'behavior', icon: 'ğŸ¯', label: 'PBS í–‰ë™ì§€ì›' },
                  { key: 'behaviorAnalytics', icon: 'ğŸ“ˆ', label: 'í–‰ë™ ê·¸ë˜í”„' },
                  { key: 'reports', icon: 'ğŸ“„', label: 'ë³´ê³ ì„œ' },
                  { key: 'focus', icon: 'â±ï¸', label: 'ì§‘ì¤‘' },
                  { key: 'schedule', icon: 'ğŸš—', label: 'ì¼ì •' },
                  { key: 'calendar', icon: 'ğŸ“…', label: 'ìº˜ë¦°ë”' },
                  { key: 'analytics', icon: 'ğŸ“ˆ', label: 'í†µê³„' },
                ].map(item => (
                  <button
                    key={item.key}
                    style={{
                      ...styles.navBtn,
                      padding: 20,
                      fontSize: 16,
                      background: view === item.key ? 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)' : styles.navBtn.background,
                      boxShadow: view === item.key ? '0 4px 12px rgba(99, 102, 241, 0.4)' : 'none',
                    }}
                    onClick={() => { setView(item.key); setShowMobileMenu(false); }}
                  >
                    {item.icon} {item.label}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* ë°ìŠ¤í¬í†± ë„¤ë¹„ê²Œì´ì…˜ */}
          <div style={styles.nav} className="desktop-nav">
            {[
              { key: 'dashboard', icon: 'ğŸ“Š', label: 'ëŒ€ì‹œë³´ë“œ' },
              { key: 'tasks', icon: 'âœ…', label: 'ê³¼ì œ' },
              { key: 'teaching', icon: 'ğŸ‘¨â€ğŸ«', label: 'ìˆ˜ì—…ê´€ë¦¬' },
              { key: 'behavior', icon: 'ğŸ¯', label: 'PBS í–‰ë™ì§€ì›' },
              { key: 'behaviorAnalytics', icon: 'ğŸ“ˆ', label: 'í–‰ë™ ê·¸ë˜í”„' },
              { key: 'reports', icon: 'ğŸ“„', label: 'ë³´ê³ ì„œ' },
              { key: 'focus', icon: 'â±ï¸', label: 'ì§‘ì¤‘' },
              { key: 'schedule', icon: 'ğŸš—', label: 'ì¼ì •' },
              { key: 'calendar', icon: 'ğŸ“…', label: 'ìº˜ë¦°ë”' },
            ].map(item => (
              <button
                key={item.key}
                style={{
                  ...styles.navBtn,
                  background: view === item.key ? 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)' : styles.navBtn.background,
                  boxShadow: view === item.key ? '0 4px 12px rgba(99, 102, 241, 0.4)' : 'none',
                  transform: view === item.key ? 'scale(1.05)' : 'scale(1)',
                }}
                onClick={() => setView(item.key)}
              >
                {item.icon} {item.label}
              </button>
            ))}
            <button
              style={{
                ...styles.navBtn,
                background: showSearch ? 'rgba(59, 130, 246, 0.3)' : styles.navBtn.background,
              }}
              onClick={() => setShowSearch(!showSearch)}
            >
              ğŸ” ê²€ìƒ‰ (Ctrl+K)
            </button>
          </div>

          {/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (ëª¨ë°”ì¼) */}
          <div className="bottom-nav">
            <div className="bottom-nav-grid">
              {[
                { key: 'dashboard', icon: 'ğŸ“Š', label: 'í™ˆ' },
                { key: 'tasks', icon: 'âœ…', label: 'ê³¼ì œ' },
                { key: 'behavior', icon: 'ğŸ¯', label: 'í–‰ë™' },
                { key: 'reports', icon: 'ğŸ“„', label: 'ë³´ê³ ì„œ' },
              ].map(item => (
                <button
                  key={item.key}
                  className={`bottom-nav-btn ${view === item.key ? 'active' : ''}`}
                  onClick={() => setView(item.key)}
                >
                  <span>{item.icon}</span>
                  <div>{item.label}</div>
                </button>
              ))}
            </div>
          </div>

          {/* ëŒ€ì‹œë³´ë“œ */}
          {view === 'dashboard' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2}>ğŸ“ˆ ì‹œìŠ¤í…œ ê°œìš”</h2>
              <p style={{ color: 'rgba(255,255,255,0.8)', marginBottom: 24, lineHeight: 1.8 }}>
                <strong>âœ¨ v2.0 ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ!</strong><br/>
                âœ“ ìë™ ì§„í–‰ë¥  ê³„ì‚° (ì„¸ë¶€ë‹¨ê³„ ê¸°ë°˜)<br/>
                âœ“ ì¶œë°œ ì‹œê°„ ì•ŒëŒ ì‹œìŠ¤í…œ (ì†Œë¦¬+ì§„ë™)<br/>
                âœ“ ì‹œê°„í‘œ ê¸°ë°˜ ìˆ˜ì—… ê´€ë¦¬<br/>
                âœ“ í•™ìƒ í‰ê°€ ë° ì‹œê°í™”<br/>
                âœ“ CSV ë™ê¸°í™” (êµ¬ê¸€ì‹œíŠ¸ ì—°ë™)<br/>
                âœ“ ì ‘ê¸°/í¼ì¹˜ê¸° ê¸°ëŠ¥
              </p>

              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: 16 }}>
                {[
                  { label: 'ì „ì²´ ê³¼ì œ', value: stats.total, icon: 'ğŸ“‹', color: '#6366f1', onClick: () => setView('tasks') },
                  { label: 'ì™„ë£Œ', value: stats.completed, icon: 'âœ…', color: '#10b981', onClick: () => setView('tasks') },
                  { label: 'ê¸´ê¸‰', value: stats.urgent, icon: 'ğŸ”´', color: '#ef4444', onClick: () => setView('tasks') },
                  { label: 'í‰ê· ì§„í–‰ë¥ ', value: `${Math.round(stats.avgProgress)}%`, icon: 'ğŸ“Š', color: '#8b5cf6', onClick: () => setView('analytics') },
                ].map((stat, i) => (
                  <div
                    key={i}
                    className="stat-card"
                    style={{
                      padding: 24,
                      borderRadius: 16,
                      background: `linear-gradient(135deg, ${stat.color}20 0%, ${stat.color}10 100%)`,
                      border: `1px solid ${stat.color}40`,
                      textAlign: 'center',
                    }}
                    onClick={stat.onClick}
                  >
                    <div style={{ fontSize: 40, marginBottom: 8 }}>{stat.icon}</div>
                    <div style={{ fontSize: 36, fontWeight: 900, color: stat.color, marginBottom: 4 }}>
                      {stat.value}
                    </div>
                    <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)' }}>
                      {stat.label}
                    </div>
                  </div>
                ))}
              </div>

              {state.schedules.length > 0 && (
                <div style={{ marginTop: 24 }}>
                  <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 12 }}>
                    â° ë‹¤ê°€ì˜¤ëŠ” ì¼ì •
                  </h3>
                  {state.schedules
                    .filter(s => s.arrivalTs - s.departBeforeMin * 60 * 1000 > nowMs())
                    .sort((a, b) => a.arrivalTs - b.arrivalTs)
                    .slice(0, 3)
                    .map(sch => (
                      <CountdownBar 
                        key={sch.id} 
                        schedule={sch} 
                        now={nowMs() + tick * 1000}
                        onAlert={handleScheduleAlert}
                      />
                    ))}
                </div>
              )}
            </div>
          )}

          {/* ê³¼ì œ ê´€ë¦¬ (ì ‘ê¸°/í¼ì¹˜ê¸° + ìë™ ì§„í–‰ë¥ ) */}
          {view === 'tasks' && (
            <div style={styles.card} className="animate-in">
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}>
                <h2 style={styles.h2}>âœ… ê³¼ì œ ê´€ë¦¬</h2>
                <button style={styles.btn} onClick={addTask}>
                  â• ìƒˆ ê³¼ì œ ì¶”ê°€
                </button>
              </div>

              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 16, padding: 12, background: 'rgba(16, 185, 129, 0.1)', borderRadius: 8, border: '1px solid rgba(16, 185, 129, 0.3)' }}>
                ğŸ’¡ <strong>ìë™ ì§„í–‰ë¥ :</strong> ì„¸ë¶€ ë‹¨ê³„ ì™„ë£Œìœ¨ì´ ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤!
              </p>

              {filteredTasks.length === 0 && (
                <div style={{ textAlign: 'center', padding: 40, color: 'rgba(255,255,255,0.5)' }}>
                  ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ê³¼ì œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!
                </div>
              )}

              {filteredTasks.map((task) => {
                const autoProgress = calculateAutoProgress(task);
                const isCollapsed = state.collapsedItems[task.id];

                return (
                  <div
                    key={task.id}
                    style={{
                      padding: 20,
                      borderRadius: 16,
                      background: 'rgba(255,255,255,0.05)',
                      border: '1px solid rgba(255,255,255,0.1)',
                      marginBottom: 16,
                      transition: 'all 0.3s',
                    }}
                  >
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: isCollapsed ? 0 : 16 }}>
                      <div style={{ flex: 1 }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 8 }}>
                          <span style={{ fontSize: 24 }}>{CATEGORIES[task.category]?.icon}</span>
                          <input
                            className="editable-input"
                            value={task.title}
                            onChange={(e) => updateTask(task.id, { title: e.target.value })}
                            style={{ fontSize: 18, fontWeight: 700 }}
                          />
                          <span className="auto-progress-badge">
                            ğŸ¤– ìë™: {autoProgress}%
                          </span>
                        </div>
                      </div>
                      <div style={{ display: 'flex', gap: 8 }}>
                        <button
                          className="collapse-toggle"
                          onClick={() => toggleCollapse(task.id)}
                        >
                          {isCollapsed ? 'â–¼ í¼ì¹˜ê¸°' : 'â–² ì ‘ê¸°'}
                        </button>
                        <button 
                          style={{ ...styles.btn2, padding: '8px 12px', background: 'rgba(59, 130, 246, 0.3)' }}
                          onClick={() => addStep(task.id)}
                        >
                          â• ë‹¨ê³„
                        </button>
                        <button 
                          style={{ ...styles.btn2, padding: '8px 12px', background: 'rgba(239, 68, 68, 0.3)' }}
                          onClick={() => deleteTask(task.id)}
                        >
                          ğŸ—‘ï¸
                        </button>
                      </div>
                    </div>

                    <div className={`collapsible ${isCollapsed ? 'collapsed' : ''}`} style={{ maxHeight: isCollapsed ? 0 : '2000px' }}>
                      <div style={{ marginBottom: 12 }}>
                        <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.7)', marginBottom: 6, fontWeight: 700 }}>
                          ì§„í–‰ë¥ : {autoProgress}% {task.steps?.length > 0 && `(${task.steps.filter(s => s.done).length}/${task.steps.length} ì™„ë£Œ)`}
                        </div>
                        <div style={{
                          height: 10,
                          background: 'rgba(0,0,0,0.3)',
                          borderRadius: 5,
                          overflow: 'hidden',
                          border: '1px solid rgba(255,255,255,0.1)',
                        }}>
                          <div style={{
                            height: '100%',
                            width: `${autoProgress}%`,
                            background: autoProgress === 100 ? 'linear-gradient(90deg, #10b981, #059669)' : 'linear-gradient(90deg, #3b82f6, #8b5cf6)',
                            transition: 'width 0.5s cubic-bezier(0.4, 0, 0.2, 1)',
                            boxShadow: autoProgress > 0 ? '0 0 10px rgba(59, 130, 246, 0.5)' : 'none',
                          }} />
                        </div>
                      </div>

                      <div style={{ display: 'flex', gap: 8, marginBottom: 12, flexWrap: 'wrap' }}>
                        <select
                          value={task.category}
                          onChange={(e) => updateTask(task.id, { category: e.target.value })}
                          style={{
                            padding: '8px 12px',
                            borderRadius: 8,
                            background: CATEGORIES[task.category]?.color,
                            color: 'white',
                            border: 'none',
                            fontSize: 13,
                            fontWeight: 700,
                            cursor: 'pointer',
                          }}
                        >
                          {Object.entries(CATEGORIES).map(([key, cat]) => (
                            <option key={key} value={key}>{cat.icon} {cat.label}</option>
                          ))}
                        </select>

                        <select
                          value={task.priority}
                          onChange={(e) => updateTask(task.id, { priority: e.target.value })}
                          style={{
                            padding: '8px 12px',
                            borderRadius: 8,
                            background: 'rgba(255,255,255,0.1)',
                            color: 'white',
                            border: '1px solid rgba(255,255,255,0.2)',
                            fontSize: 13,
                            fontWeight: 700,
                            cursor: 'pointer',
                          }}
                        >
                          {Object.entries(PRIORITIES).map(([key, pri]) => (
                            <option key={key} value={key}>{pri.icon} {pri.label}</option>
                          ))}
                        </select>
                      </div>

                      {task.steps && task.steps.length > 0 && (
                        <div>
                          <div style={{ fontSize: 14, fontWeight: 700, color: 'white', marginBottom: 8 }}>
                            ğŸ“ ì„¸ë¶€ ë‹¨ê³„ ({task.steps.filter(s => s.done).length}/{task.steps.length})
                          </div>
                          {task.steps.map(step => (
                            <div 
                              key={step.id} 
                              style={{ 
                                display: 'flex', 
                                alignItems: 'center', 
                                gap: 10, 
                                marginBottom: 8, 
                                padding: 12, 
                                background: step.done ? 'rgba(16, 185, 129, 0.1)' : 'rgba(0,0,0,0.2)', 
                                borderRadius: 8,
                                border: step.done ? '1px solid rgba(16, 185, 129, 0.3)' : '1px solid rgba(255,255,255,0.1)',
                                transition: 'all 0.3s',
                              }}
                            >
                              <input 
                                type="checkbox" 
                                checked={step.done} 
                                onChange={() => toggleStep(task.id, step.id)}
                                style={{ width: 20, height: 20, cursor: 'pointer' }}
                              />
                              <span style={{ 
                                flex: 1, 
                                textDecoration: step.done ? 'line-through' : 'none', 
                                opacity: step.done ? 0.6 : 1,
                                fontSize: 14,
                              }}>
                                {step.text}
                              </span>
                              {step.done && <span style={{ fontSize: 20 }}>âœ…</span>}
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          )}

          {/* ìˆ˜ì—… ê´€ë¦¬ ì‹œìŠ¤í…œ */}
          {view === 'teaching' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2}>ğŸ‘¨â€ğŸ« ìˆ˜ì—… ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 20 }}>
                ì‹œê°„í‘œ ê¸°ë°˜ ìˆ˜ì—… ì¤€ë¹„, í‰ê°€, í•™ìƒë³„ í”¼ë“œë°± ê´€ë¦¬
              </p>

              <div style={{ marginBottom: 20, display: 'flex', gap: 10, flexWrap: 'wrap' }}>
                <button 
                  style={styles.btn}
                  onClick={() => setEditingLesson({ dayOfWeek: 'ì›”', period: '1êµì‹œ' })}
                >
                  â• ìˆ˜ì—… ì¶”ê°€
                </button>
                <button 
                  style={{ ...styles.btn, background: 'linear-gradient(135deg, #10b981, #059669)' }}
                  onClick={exportLessonsCSV}
                >
                  ğŸ’¾ ìˆ˜ì—… CSV ì €ì¥
                </button>
                <button 
                  style={{ ...styles.btn, background: 'linear-gradient(135deg, #f59e0b, #d97706)' }}
                  onClick={exportEvalsCSV}
                >
                  ğŸ’¾ í‰ê°€ CSV ì €ì¥
                </button>
                <label className="file-input-label">
                  ğŸ“¥ CSV ë¶ˆëŸ¬ì˜¤ê¸°
                  <input type="file" accept=".csv" onChange={importLessonsCSV} />
                </label>
              </div>

              {/* ì‹œê°„í‘œ */}
              <div className="timetable">
                <div className="timetable-header">êµì‹œ</div>
                {DAYS_OF_WEEK.map(day => (
                  <div key={day} className="timetable-header">{day}ìš”ì¼</div>
                ))}

                {PERIODS.map((period, periodIdx) => (
                  <React.Fragment key={period}>
                    <div className="timetable-cell" style={{ fontWeight: 900, background: 'rgba(59, 130, 246, 0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      {period}
                    </div>
                    {DAYS_OF_WEEK.map((day, dayIdx) => {
                      const lessons = state.lessons.filter(l => l.dayOfWeek === day && l.period === period);
                      
                      return (
                        <div 
                          key={`${day}-${period}`} 
                          className="timetable-cell"
                          onClick={() => setEditingLesson({ dayOfWeek: day, period })}
                        >
                          {lessons.length === 0 ? (
                            <div style={{ textAlign: 'center', color: 'rgba(255,255,255,0.3)', fontSize: 11 }}>
                              + ìˆ˜ì—… ì¶”ê°€
                            </div>
                          ) : (
                            lessons.map(lesson => (
                              <div 
                                key={lesson.id} 
                                className="lesson-card"
                                onClick={(e) => {
                                  e.stopPropagation();
                                  setEditingLesson(lesson);
                                }}
                              >
                                <div className="lesson-card-title">{lesson.subject}</div>
                                <div className="lesson-card-subtitle">
                                  {lesson.topic || 'ì œì¬ ë¯¸ì…ë ¥'}
                                </div>
                                <div style={{ fontSize: 9, marginTop: 4, color: 'rgba(255,255,255,0.6)' }}>
                                  {lesson.goal ? `ëª©í‘œ: ${lesson.goal.slice(0, 20)}${lesson.goal.length > 20 ? '...' : ''}` : ''}
                                </div>
                              </div>
                            ))
                          )}
                        </div>
                      );
                    })}
                  </React.Fragment>
                ))}
              </div>

              {/* í•™ìƒë³„ í‰ê°€ í˜„í™© */}
              <div style={{ marginTop: 30 }}>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                  ğŸ“Š í•™ìƒë³„ í‰ê°€ í˜„í™©
                </h3>
                <p style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)', marginBottom: 12, padding: 10, background: 'rgba(59, 130, 246, 0.1)', borderRadius: 8 }}>
                  ğŸ’¡ í‰ê°€ ì²™ë„: <strong>0</strong>(ê²°ì„) / <strong>1</strong>(ë¯¸ì°¸ì—¬) / <strong>2</strong>(ë¯¸ë„ë‹¬) / <strong>3</strong>(ìµœëŒ€ì´‰êµ¬) / <strong>4</strong>(ì¼ë¶€ì´‰êµ¬) / <strong>5</strong>(ëª©í‘œë‹¬ì„±)
                </p>

                {state.lessons.slice(0, 5).map(lesson => (
                  <div key={lesson.id} style={{ marginBottom: 24, padding: 16, background: 'rgba(0,0,0,0.2)', borderRadius: 12, border: '1px solid rgba(255,255,255,0.1)' }}>
                    <div style={{ fontSize: 16, fontWeight: 700, color: '#a78bfa', marginBottom: 12 }}>
                      {lesson.subject} - {lesson.dayOfWeek}ìš”ì¼ {lesson.period}
                    </div>

                    <div className="student-eval-grid">
                      <div className="eval-cell" style={{ fontWeight: 900, background: 'rgba(139, 92, 246, 0.3)', color: '#c4b5fd' }}>í•™ìƒ</div>
                      {[0, 1, 2, 3, 4, 5].map(score => (
                        <div key={score} className="eval-cell" style={{ fontWeight: 900, background: 'rgba(139, 92, 246, 0.3)', color: '#c4b5fd' }}>
                          <div>{score}ì </div>
                          <div style={{ fontSize: 9, marginTop: 2 }}>{EVAL_SCORES[score].label}</div>
                        </div>
                      ))}

                      {[1, 2, 3, 4, 5, 6, 7].map(studentNum => {
                        const studentId = `í•™ìƒ${studentNum}`;
                        const evalKey = `${lesson.id}-${studentId}`;
                        const currentScore = state.studentEvals[evalKey]?.score;

                        return (
                          <React.Fragment key={studentNum}>
                            <div className="eval-cell" style={{ fontWeight: 700, background: 'rgba(59, 130, 246, 0.1)' }}>
                              {studentId}
                            </div>
                            {[0, 1, 2, 3, 4, 5].map(score => (
                              <div
                                key={score}
                                className={`eval-cell eval-score-${score} ${currentScore === score ? 'selected' : ''}`}
                                onClick={() => saveStudentEval(lesson.id, studentId, score)}
                                style={{ 
                                  cursor: 'pointer',
                                  fontWeight: currentScore === score ? 900 : 600,
                                }}
                              >
                                {currentScore === score ? 'âœ“' : '-'}
                              </div>
                            ))}
                          </React.Fragment>
                        );
                      })}
                    </div>
                  </div>
                ))}

                {state.lessons.length === 0 && (
                  <div style={{ textAlign: 'center', padding: 40, color: 'rgba(255,255,255,0.5)' }}>
                    ë“±ë¡ëœ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤. ì‹œê°„í‘œì—ì„œ ìˆ˜ì—…ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                  </div>
                )}
              </div>
            </div>
          )}

          {/* ì¼ì • ì•ŒëŒ */}
          {view === 'schedule' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2}>ğŸš— ì§€ê° ë°©ì§€ ì¶œë°œ ì•ŒëŒ</h2>
              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 16, padding: 12, background: 'rgba(239, 68, 68, 0.1)', borderRadius: 8, border: '1px solid rgba(239, 68, 68, 0.3)' }}>
                â° <strong>ì¶œë°œ ì‹œê°„ì— ìë™ìœ¼ë¡œ ì•Œë¦¼ì´ ìš¸ë¦½ë‹ˆë‹¤!</strong> (ì†Œë¦¬ + ì§„ë™ + í™”ë©´ ì•Œë¦¼)
              </p>

              {state.schedules.length === 0 && (
                <div style={{ textAlign: 'center', padding: 40, color: 'rgba(255,255,255,0.5)' }}>
                  ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
              )}

              {state.schedules.map(sch => (
                <div key={sch.id} style={{ marginBottom: 16 }}>
                  <CountdownBar 
                    schedule={sch} 
                    now={nowMs() + tick * 1000}
                    onAlert={handleScheduleAlert}
                  />
                </div>
              ))}
            </div>
          )}

          {/* ìº˜ë¦°ë” */}
          {view === 'calendar' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2}>ğŸ“… ì›”ë³„ ìº˜ë¦°ë”</h2>
              <Calendar tasks={state.tasks} schedules={state.schedules} lessons={state.lessons} />
            </div>
          )}

          {/* PBS í–‰ë™ì§€ì› (í–‰ë™ íŠ¸ë˜í‚¹) */}
          {view === 'behavior' && (
            <div style={styles.card} className="animate-in">
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20, flexWrap: 'wrap', gap: 10 }}>
                <h2 style={styles.h2}>ğŸ¯ PBS í–‰ë™ì§€ì› ì‹œìŠ¤í…œ</h2>
                <div style={{ display: 'flex', gap: 10, flexWrap: 'wrap' }}>
                  <button
                    style={styles.btn}
                    onClick={() => setEditingBehavior({ behaviorType: 'TARGET', frequency: 1, intensity: 1, duration: 0 })}
                  >
                    â• í–‰ë™ ê¸°ë¡ ì¶”ê°€
                  </button>
                  <button
                    style={{ ...styles.btn, background: 'linear-gradient(135deg, #10b981, #059669)' }}
                    onClick={() => exportBehaviorLogCSV(state.behaviorLog)}
                  >
                    ğŸ’¾ CSV ë‚´ë³´ë‚´ê¸°
                  </button>
                </div>
              </div>

              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 20, padding: 12, background: 'rgba(139, 92, 246, 0.1)', borderRadius: 8, border: '1px solid rgba(139, 92, 246, 0.3)' }}>
                ğŸ“Š <strong>ABC í˜•ì‹ í–‰ë™ ê¸°ë¡:</strong> ì„ í–‰ì‚¬ê±´(Antecedent) - í–‰ë™(Behavior) - í›„ì†ê²°ê³¼(Consequence)ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê¸°ë¡í•˜ì—¬ Be-Able í”Œë«í¼ê³¼ ì—°ë™ ê°€ëŠ¥
              </p>

              {state.behaviorLog.length === 0 && (
                <div style={{ textAlign: 'center', padding: 40, color: 'rgba(255,255,255,0.5)' }}>
                  ë“±ë¡ëœ í–‰ë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ í–‰ë™ ê¸°ë¡ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                </div>
              )}

              {state.behaviorLog.slice().reverse().map((log) => (
                <div
                  key={log.id}
                  style={{
                    padding: 20,
                    borderRadius: 16,
                    background: 'rgba(255,255,255,0.05)',
                    border: '1px solid rgba(255,255,255,0.1)',
                    marginBottom: 16,
                  }}
                >
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 12 }}>
                    <div>
                      <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 8 }}>
                        <span style={{
                          padding: '6px 12px',
                          borderRadius: 8,
                          background: BEHAVIOR_TYPES[log.behaviorType]?.color || '#6b7280',
                          fontSize: 13,
                          fontWeight: 700,
                        }}>
                          {BEHAVIOR_TYPES[log.behaviorType]?.icon} {BEHAVIOR_TYPES[log.behaviorType]?.label}
                        </span>
                        <span style={{ fontSize: 16, fontWeight: 700, color: 'white' }}>
                          {log.studentName}
                        </span>
                      </div>
                      <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.6)' }}>
                        {new Date(log.timestamp).toLocaleString('ko-KR')}
                      </div>
                    </div>
                    <div style={{ display: 'flex', gap: 8 }}>
                      <button
                        style={{ ...styles.btn2, padding: '8px 12px', background: 'rgba(59, 130, 246, 0.3)' }}
                        onClick={() => setEditingBehavior(log)}
                      >
                        âœï¸ ìˆ˜ì •
                      </button>
                      <button
                        style={{ ...styles.btn2, padding: '8px 12px', background: 'rgba(239, 68, 68, 0.3)' }}
                        onClick={() => deleteBehaviorLog(log.id)}
                      >
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  </div>

                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                    gap: 12,
                    marginBottom: 12,
                  }}>
                    <div>
                      <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginBottom: 4, fontWeight: 700 }}>
                        ì„ í–‰ì‚¬ê±´ (A)
                      </div>
                      <div style={{ fontSize: 14, color: 'white' }}>
                        {log.antecedent || '-'}
                      </div>
                    </div>
                    <div>
                      <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginBottom: 4, fontWeight: 700 }}>
                        í–‰ë™ (B)
                      </div>
                      <div style={{ fontSize: 14, color: 'white', fontWeight: 700 }}>
                        {log.behavior || '-'}
                      </div>
                    </div>
                    <div>
                      <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginBottom: 4, fontWeight: 700 }}>
                        í›„ì†ê²°ê³¼ (C)
                      </div>
                      <div style={{ fontSize: 14, color: 'white' }}>
                        {log.consequence || '-'}
                      </div>
                    </div>
                  </div>

                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(3, 1fr)',
                    gap: 12,
                    padding: 12,
                    background: 'rgba(0,0,0,0.2)',
                    borderRadius: 8,
                    marginBottom: 12,
                  }}>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.6)', marginBottom: 4 }}>ë¹ˆë„</div>
                      <div style={{ fontSize: 18, fontWeight: 900, color: '#3b82f6' }}>{log.frequency}íšŒ</div>
                    </div>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.6)', marginBottom: 4 }}>ê°•ë„</div>
                      <div style={{ fontSize: 18, fontWeight: 900, color: '#f59e0b' }}>
                        {'â­'.repeat(log.intensity || 1)}
                      </div>
                    </div>
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ fontSize: 11, color: 'rgba(255,255,255,0.6)', marginBottom: 4 }}>ì§€ì†ì‹œê°„</div>
                      <div style={{ fontSize: 18, fontWeight: 900, color: '#10b981' }}>{log.duration}ë¶„</div>
                    </div>
                  </div>

                  {log.interventionNote && (
                    <div style={{
                      padding: 12,
                      background: 'rgba(139, 92, 246, 0.1)',
                      borderRadius: 8,
                      border: '1px solid rgba(139, 92, 246, 0.3)',
                    }}>
                      <div style={{ fontSize: 12, color: '#a78bfa', marginBottom: 6, fontWeight: 700 }}>
                        ğŸ’¡ ì¤‘ì¬ ë…¸íŠ¸
                      </div>
                      <div style={{ fontSize: 14, color: 'white', lineHeight: 1.6 }}>
                        {log.interventionNote}
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}

          {/* í–‰ë™ ê·¸ë˜í”„ / ë¶„ì„ */}
          {view === 'behaviorAnalytics' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2}>ğŸ“ˆ í–‰ë™ ë°ì´í„° ë¶„ì„ ë° ì‹œê°í™”</h2>

              <div style={{ marginBottom: 20, display: 'flex', gap: 10, flexWrap: 'wrap' }}>
                <select
                  value={behaviorFilter.dateRange}
                  onChange={(e) => setBehaviorFilter({ ...behaviorFilter, dateRange: parseInt(e.target.value) })}
                  style={{
                    padding: '10px 16px',
                    borderRadius: 8,
                    background: 'rgba(255,255,255,0.1)',
                    border: '1px solid rgba(255,255,255,0.2)',
                    color: 'white',
                    fontSize: 13,
                    fontWeight: 700,
                  }}
                >
                  <option value={7}>ìµœê·¼ 7ì¼</option>
                  <option value={30}>ìµœê·¼ 30ì¼</option>
                  <option value={90}>ìµœê·¼ 90ì¼</option>
                </select>

                <button
                  style={{ ...styles.btn2, background: 'rgba(16, 185, 129, 0.3)' }}
                  onClick={() => exportChartAsPNG('behaviorLineChart', 'í–‰ë™ë¹ˆë„ì°¨íŠ¸.png')}
                >
                  ğŸ“Š ì°¨íŠ¸ PNG ì €ì¥
                </button>
              </div>

              {state.behaviorLog.length === 0 ? (
                <div style={{ textAlign: 'center', padding: 60, color: 'rgba(255,255,255,0.5)' }}>
                  ë¶„ì„í•  í–‰ë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. í–‰ë™ ê¸°ë¡ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.
                </div>
              ) : (
                <div>
                  {/* í†µê³„ ìš”ì•½ */}
                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',
                    gap: 16,
                    marginBottom: 30,
                  }}>
                    {(() => {
                      const now = Date.now();
                      const rangeMs = behaviorFilter.dateRange * 24 * 60 * 60 * 1000;
                      const filtered = state.behaviorLog.filter(b => b.timestamp >= (now - rangeMs));

                      const byType = {};
                      filtered.forEach(b => {
                        const type = BEHAVIOR_TYPES[b.behaviorType]?.label || b.behaviorType;
                        byType[type] = (byType[type] || 0) + 1;
                      });

                      const mostCommon = Object.entries(byType).sort((a, b) => b[1] - a[1])[0];

                      return (
                        <>
                          <div style={{
                            padding: 20,
                            borderRadius: 12,
                            background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(99, 102, 241, 0.3))',
                            border: '1px solid rgba(59, 130, 246, 0.4)',
                            textAlign: 'center',
                          }}>
                            <div style={{ fontSize: 32, fontWeight: 900, color: '#60a5fa' }}>{filtered.length}</div>
                            <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.8)' }}>ì´ ê¸°ë¡ ìˆ˜</div>
                          </div>
                          <div style={{
                            padding: 20,
                            borderRadius: 12,
                            background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.3))',
                            border: '1px solid rgba(16, 185, 129, 0.4)',
                            textAlign: 'center',
                          }}>
                            <div style={{ fontSize: 32, fontWeight: 900, color: '#10b981' }}>
                              {filtered.length > 0 ? (filtered.length / behaviorFilter.dateRange).toFixed(1) : 0}
                            </div>
                            <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.8)' }}>ì¼í‰ê·  ë°œìƒ</div>
                          </div>
                          <div style={{
                            padding: 20,
                            borderRadius: 12,
                            background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(124, 58, 237, 0.3))',
                            border: '1px solid rgba(139, 92, 246, 0.4)',
                            textAlign: 'center',
                          }}>
                            <div style={{ fontSize: 16, fontWeight: 900, color: '#a78bfa' }}>
                              {mostCommon ? mostCommon[0] : '-'}
                            </div>
                            <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.8)' }}>ìµœë‹¤ ë°œìƒ</div>
                          </div>
                        </>
                      );
                    })()}
                  </div>

                  {/* ì°¨íŠ¸: ì¼ë³„ í–‰ë™ ë¹ˆë„ */}
                  <div className="chart-container" style={{ marginBottom: 30 }}>
                    <h3 style={{ fontSize: 16, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                      ğŸ“Š ì¼ë³„ í–‰ë™ ë¹ˆë„
                    </h3>
                    <canvas id="behaviorLineChart"></canvas>
                  </div>

                  {/* ì°¨íŠ¸: í–‰ë™ ìœ í˜•ë³„ ë¶„í¬ */}
                  <div className="chart-container">
                    <h3 style={{ fontSize: 16, fontWeight: 700, color: 'white', marginBottom: 16 }}>
                      ğŸ“Š í–‰ë™ ìœ í˜•ë³„ ë¶„í¬
                    </h3>
                    <canvas id="behaviorBarChart"></canvas>
                  </div>

                  {/* Chart.js ì°¨íŠ¸ ë Œë”ë§ */}
                  {(() => {
                    setTimeout(() => {
                      const now = Date.now();
                      const rangeMs = behaviorFilter.dateRange * 24 * 60 * 60 * 1000;
                      const filtered = state.behaviorLog.filter(b => b.timestamp >= (now - rangeMs));

                      // ì¼ë³„ ë°ì´í„° ì§‘ê³„
                      const dailyData = {};
                      for (let i = 0; i < behaviorFilter.dateRange; i++) {
                        const date = new Date(now - i * 24 * 60 * 60 * 1000);
                        const dateStr = date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
                        dailyData[dateStr] = 0;
                      }

                      filtered.forEach(b => {
                        const dateStr = new Date(b.timestamp).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
                        if (dailyData[dateStr] !== undefined) {
                          dailyData[dateStr]++;
                        }
                      });

                      const labels = Object.keys(dailyData).reverse();
                      const data = Object.values(dailyData).reverse();

                      // ë¼ì¸ ì°¨íŠ¸
                      const lineCtx = document.getElementById('behaviorLineChart');
                      if (lineCtx && window.Chart) {
                        const existingLine = Chart.getChart('behaviorLineChart');
                        if (existingLine) existingLine.destroy();

                        new Chart(lineCtx, {
                          type: 'line',
                          data: {
                            labels: labels,
                            datasets: [{
                              label: 'í–‰ë™ ë°œìƒ íšŸìˆ˜',
                              data: data,
                              borderColor: '#3b82f6',
                              backgroundColor: 'rgba(59, 130, 246, 0.1)',
                              tension: 0.4,
                              fill: true,
                            }]
                          },
                          options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                              legend: { labels: { color: 'white' } }
                            },
                            scales: {
                              y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                              x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                            }
                          }
                        });
                      }

                      // í–‰ë™ ìœ í˜•ë³„ ë°ì´í„°
                      const typeData = {};
                      filtered.forEach(b => {
                        const type = BEHAVIOR_TYPES[b.behaviorType]?.label || b.behaviorType;
                        typeData[type] = (typeData[type] || 0) + 1;
                      });

                      // ë°” ì°¨íŠ¸
                      const barCtx = document.getElementById('behaviorBarChart');
                      if (barCtx && window.Chart) {
                        const existingBar = Chart.getChart('behaviorBarChart');
                        if (existingBar) existingBar.destroy();

                        new Chart(barCtx, {
                          type: 'bar',
                          data: {
                            labels: Object.keys(typeData),
                            datasets: [{
                              label: 'ë°œìƒ íšŸìˆ˜',
                              data: Object.values(typeData),
                              backgroundColor: Object.keys(typeData).map(type => {
                                const behaviorType = Object.values(BEHAVIOR_TYPES).find(t => t.label === type);
                                return behaviorType ? behaviorType.color : '#6b7280';
                              }),
                            }]
                          },
                          options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                              legend: { display: false }
                            },
                            scales: {
                              y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                              x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                            }
                          }
                        });
                      }
                    }, 100);

                    return null;
                  })()}
                </div>
              )}
            </div>
          )}

          {/* ë³´ê³ ì„œ ìƒì„± */}
          {view === 'reports' && (
            <div style={styles.card} className="animate-in">
              <h2 style={styles.h2}>ğŸ“„ ìë™ ë³´ê³ ì„œ ìƒì„±</h2>
              <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: 14, marginBottom: 30 }}>
                ì£¼ê°„/ì›”ê°„ ë³´ê³ ì„œë¥¼ PDF ë˜ëŠ” CSV í˜•ì‹ìœ¼ë¡œ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
              </p>

              {/* ì£¼ê°„ ìˆ˜ì—… ë³´ê³ ì„œ */}
              <div style={{
                padding: 24,
                borderRadius: 16,
                background: 'rgba(59, 130, 246, 0.1)',
                border: '1px solid rgba(59, 130, 246, 0.3)',
                marginBottom: 20,
              }}>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: '#60a5fa', marginBottom: 12 }}>
                  ğŸ“š ì£¼ê°„ ìˆ˜ì—… ë³´ê³ ì„œ
                </h3>
                <p style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)', marginBottom: 16, lineHeight: 1.6 }}>
                  ìµœê·¼ 7ì¼ê°„ì˜ ìˆ˜ì—… ë‚´ìš©, ì£¼ì œ, ëª©í‘œë¥¼ ìš”ì•½í•œ ë³´ê³ ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                </p>
                <div style={{ display: 'flex', gap: 10, flexWrap: 'wrap' }}>
                  <button
                    style={styles.btn}
                    onClick={generateWeeklyLessonReport}
                  >
                    ğŸ’¾ CSV ë‹¤ìš´ë¡œë“œ
                  </button>
                  <button
                    style={{ ...styles.btn, background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}
                    onClick={() => generatePDFReport('weekly')}
                  >
                    ğŸ“• PDF ë‹¤ìš´ë¡œë“œ
                  </button>
                </div>
              </div>

              {/* ì›”ê°„ í–‰ë™ ë³´ê³ ì„œ */}
              <div style={{
                padding: 24,
                borderRadius: 16,
                background: 'rgba(139, 92, 246, 0.1)',
                border: '1px solid rgba(139, 92, 246, 0.3)',
                marginBottom: 20,
              }}>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: '#a78bfa', marginBottom: 12 }}>
                  ğŸ¯ ì›”ê°„ í–‰ë™ ë³´ê³ ì„œ
                </h3>
                <p style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)', marginBottom: 16, lineHeight: 1.6 }}>
                  ìµœê·¼ 30ì¼ê°„ì˜ í–‰ë™ ê¸°ë¡, ìœ í˜•ë³„ ì§‘ê³„, ì¶”ì„¸ ë¶„ì„ì„ í¬í•¨í•œ ë³´ê³ ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                </p>
                <div style={{ display: 'flex', gap: 10, flexWrap: 'wrap' }}>
                  <button
                    style={styles.btn}
                    onClick={generateMonthlyBehaviorReport}
                  >
                    ğŸ’¾ CSV ë‹¤ìš´ë¡œë“œ
                  </button>
                  <button
                    style={{ ...styles.btn, background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}
                    onClick={() => generatePDFReport('monthly')}
                  >
                    ğŸ“• PDF ë‹¤ìš´ë¡œë“œ
                  </button>
                </div>
              </div>

              {/* ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸° */}
              <div style={{
                padding: 24,
                borderRadius: 16,
                background: 'rgba(16, 185, 129, 0.1)',
                border: '1px solid rgba(16, 185, 129, 0.3)',
              }}>
                <h3 style={{ fontSize: 18, fontWeight: 700, color: '#10b981', marginBottom: 12 }}>
                  ğŸ“Š ë°ì´í„° í˜„í™©
                </h3>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: 16 }}>
                  <div style={{ textAlign: 'center' }}>
                    <div style={{ fontSize: 32, fontWeight: 900, color: '#10b981' }}>{state.lessons.length}</div>
                    <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)' }}>ì´ ìˆ˜ì—… ìˆ˜</div>
                  </div>
                  <div style={{ textAlign: 'center' }}>
                    <div style={{ fontSize: 32, fontWeight: 900, color: '#8b5cf6' }}>{state.behaviorLog.length}</div>
                    <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)' }}>ì´ í–‰ë™ ê¸°ë¡</div>
                  </div>
                  <div style={{ textAlign: 'center' }}>
                    <div style={{ fontSize: 32, fontWeight: 900, color: '#3b82f6' }}>{Object.keys(state.studentEvals).length}</div>
                    <div style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)' }}>ì´ í‰ê°€ ìˆ˜</div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* ìˆ˜ì—… í¸ì§‘ ëª¨ë‹¬ */}
          {editingLesson && (
            <div className="modal-overlay" onClick={() => setEditingLesson(null)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <h2 style={{ fontSize: 22, fontWeight: 800, color: 'white', marginBottom: 20 }}>
                  {editingLesson.id ? 'âœï¸ ìˆ˜ì—… ìˆ˜ì •' : 'â• ìˆ˜ì—… ì¶”ê°€'}
                </h2>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>ìš”ì¼</label>
                  <select
                    value={editingLesson.dayOfWeek || 'ì›”'}
                    onChange={(e) => setEditingLesson({ ...editingLesson, dayOfWeek: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                  >
                    {DAYS_OF_WEEK.map(day => <option key={day} value={day}>{day}ìš”ì¼</option>)}
                  </select>
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>êµì‹œ</label>
                  <select
                    value={editingLesson.period || '1êµì‹œ'}
                    onChange={(e) => setEditingLesson({ ...editingLesson, period: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                  >
                    {PERIODS.map(period => <option key={period} value={period}>{period}</option>)}
                  </select>
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>ê³¼ëª©ëª… *</label>
                  <input
                    type="text"
                    placeholder="ì˜ˆ: ìˆ˜í•™, êµ­ì–´, ì‚¬íšŒì„± í›ˆë ¨"
                    value={editingLesson.subject || ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, subject: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                  />
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>ì œì¬/ë‹¨ì›</label>
                  <input
                    type="text"
                    placeholder="ì˜ˆ: ë§ì…ˆê³¼ ëº„ì…ˆ, ê°ì • í‘œí˜„í•˜ê¸°"
                    value={editingLesson.topic || ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, topic: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                  />
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>ëª©í‘œ</label>
                  <textarea
                    placeholder="ì˜ˆ: í•™ìƒì€ 10 ì´í•˜ì˜ ìˆ˜ë¥¼ ë”í•˜ê³  ëº„ ìˆ˜ ìˆë‹¤."
                    value={editingLesson.goal || ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, goal: e.target.value })}
                    rows={3}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14, resize: 'vertical' }}
                  />
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>í™œë™</label>
                  <textarea
                    placeholder="ì˜ˆ: 1. ìˆ«ì ì¹´ë“œë¡œ ê²Œì„í•˜ê¸° 2. ì›Œí¬ì‹œíŠ¸ í™œë™ 3. ë§ˆë¬´ë¦¬ í™œë™"
                    value={editingLesson.activity || ''}
                    onChange={(e) => setEditingLesson({ ...editingLesson, activity: e.target.value })}
                    rows={4}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14, resize: 'vertical' }}
                  />
                </div>

                <div style={{ display: 'flex', gap: 10, marginTop: 20 }}>
                  <button
                    style={{ ...styles.btn, flex: 1 }}
                    onClick={() => {
                      if (!editingLesson.subject) {
                        alert('ê³¼ëª©ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                        return;
                      }
                      saveLesson(editingLesson);
                    }}
                  >
                    ğŸ’¾ ì €ì¥
                  </button>
                  {editingLesson.id && (
                    <button
                      style={{ ...styles.btn, background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}
                      onClick={() => {
                        deleteLesson(editingLesson.id);
                        setEditingLesson(null);
                      }}
                    >
                      ğŸ—‘ï¸ ì‚­ì œ
                    </button>
                  )}
                  <button
                    style={{ ...styles.btn2, padding: '12px 20px' }}
                    onClick={() => setEditingLesson(null)}
                  >
                    ì·¨ì†Œ
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* í–‰ë™ ê¸°ë¡ í¸ì§‘ ëª¨ë‹¬ */}
          {editingBehavior && (
            <div className="modal-overlay" onClick={() => setEditingBehavior(null)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <h2 style={{ fontSize: 22, fontWeight: 800, color: 'white', marginBottom: 20 }}>
                  {editingBehavior.id ? 'âœï¸ í–‰ë™ ê¸°ë¡ ìˆ˜ì •' : 'â• í–‰ë™ ê¸°ë¡ ì¶”ê°€'}
                </h2>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    í•™ìƒ ì´ë¦„ *
                  </label>
                  <input
                    type="text"
                    placeholder="í•™ìƒ ì´ë¦„ ì…ë ¥"
                    value={editingBehavior.studentName || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, studentName: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                  />
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    í–‰ë™ ìœ í˜• *
                  </label>
                  <select
                    value={editingBehavior.behaviorType || 'TARGET'}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, behaviorType: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                  >
                    {Object.entries(BEHAVIOR_TYPES).map(([key, type]) => (
                      <option key={key} value={key}>{type.icon} {type.label}</option>
                    ))}
                  </select>
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    ì„ í–‰ì‚¬ê±´ (Antecedent) *
                  </label>
                  <input
                    type="text"
                    placeholder="í–‰ë™ ì „ ìƒí™© (ì˜ˆ: ê³¼ì œì œì‹œ, ë˜ë˜ìƒí˜¸ì‘ìš©)"
                    value={editingBehavior.antecedent || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, antecedent: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                    list="antecedents"
                  />
                  <datalist id="antecedents">
                    {COMMON_ANTECEDENTS.map(a => <option key={a} value={a} />)}
                  </datalist>
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    í–‰ë™ (Behavior) *
                  </label>
                  <input
                    type="text"
                    placeholder="ê´€ì°°ëœ í–‰ë™ (ì˜ˆ: ì†Œë¦¬ì§€ë¥´ê¸°, ìë¦¬ì´íƒˆ)"
                    value={editingBehavior.behavior || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, behavior: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                    list="behaviors"
                  />
                  <datalist id="behaviors">
                    {COMMON_BEHAVIORS.map(b => <option key={b} value={b} />)}
                  </datalist>
                  <div style={{ display: 'flex', gap: 6, flexWrap: 'wrap', marginTop: 8 }}>
                    {COMMON_BEHAVIORS.slice(0, 5).map(b => (
                      <button
                        key={b}
                        style={{ padding: '6px 12px', background: 'rgba(59, 130, 246, 0.2)', border: '1px solid rgba(59, 130, 246, 0.3)', borderRadius: 6, color: 'white', fontSize: 12, cursor: 'pointer' }}
                        onClick={() => setEditingBehavior({ ...editingBehavior, behavior: b })}
                      >
                        {b}
                      </button>
                    ))}
                  </div>
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    í›„ì†ê²°ê³¼ (Consequence) *
                  </label>
                  <input
                    type="text"
                    placeholder="í–‰ë™ í›„ ê²°ê³¼ (ì˜ˆ: ê´€ì‹¬ì œê³µ, í† í°ì œê³µ)"
                    value={editingBehavior.consequence || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, consequence: e.target.value })}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                    list="consequences"
                  />
                  <datalist id="consequences">
                    {COMMON_CONSEQUENCES.map(c => <option key={c} value={c} />)}
                  </datalist>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12, marginBottom: 16 }}>
                  <div>
                    <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                      ë¹ˆë„ (íšŒ)
                    </label>
                    <input
                      type="number"
                      min="1"
                      value={editingBehavior.frequency || 1}
                      onChange={(e) => setEditingBehavior({ ...editingBehavior, frequency: parseInt(e.target.value) || 1 })}
                      style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                    />
                  </div>
                  <div>
                    <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                      ê°•ë„ (1-5)
                    </label>
                    <input
                      type="number"
                      min="1"
                      max="5"
                      value={editingBehavior.intensity || 1}
                      onChange={(e) => setEditingBehavior({ ...editingBehavior, intensity: parseInt(e.target.value) || 1 })}
                      style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                    />
                  </div>
                  <div>
                    <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                      ì§€ì†ì‹œê°„ (ë¶„)
                    </label>
                    <input
                      type="number"
                      min="0"
                      value={editingBehavior.duration || 0}
                      onChange={(e) => setEditingBehavior({ ...editingBehavior, duration: parseInt(e.target.value) || 0 })}
                      style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14 }}
                    />
                  </div>
                </div>

                <div style={{ marginBottom: 16 }}>
                  <label style={{ display: 'block', color: 'rgba(255,255,255,0.8)', marginBottom: 6, fontWeight: 700 }}>
                    ì¤‘ì¬ ë…¸íŠ¸ (ì„ íƒì‚¬í•­)
                  </label>
                  <textarea
                    placeholder="ì‚¬ìš©í•œ ì¤‘ì¬ ì „ëµ, íš¨ê³¼, í–¥í›„ ê³„íš ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”"
                    value={editingBehavior.interventionNote || ''}
                    onChange={(e) => setEditingBehavior({ ...editingBehavior, interventionNote: e.target.value })}
                    rows={4}
                    style={{ width: '100%', padding: 12, borderRadius: 8, background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', color: 'white', fontSize: 14, resize: 'vertical' }}
                  />
                </div>

                <div style={{ display: 'flex', gap: 10, marginTop: 20 }}>
                  <button
                    style={{ ...styles.btn, flex: 1 }}
                    onClick={() => {
                      if (!editingBehavior.studentName || !editingBehavior.behavior || !editingBehavior.antecedent || !editingBehavior.consequence) {
                        alert('í•™ìƒ ì´ë¦„, ì„ í–‰ì‚¬ê±´, í–‰ë™, í›„ì†ê²°ê³¼ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                        return;
                      }
                      saveBehaviorLog(editingBehavior);
                    }}
                  >
                    ğŸ’¾ ì €ì¥
                  </button>
                  {editingBehavior.id && (
                    <button
                      style={{ ...styles.btn, background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}
                      onClick={() => {
                        deleteBehaviorLog(editingBehavior.id);
                        setEditingBehavior(null);
                      }}
                    >
                      ğŸ—‘ï¸ ì‚­ì œ
                    </button>
                  )}
                  <button
                    style={{ ...styles.btn2, padding: '12px 20px' }}
                    onClick={() => setEditingBehavior(null)}
                  >
                    ì·¨ì†Œ
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>